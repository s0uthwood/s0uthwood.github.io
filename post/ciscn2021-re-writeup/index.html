<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='glass 安卓逆向，使用jeb打开，发现在java层仅进行了简单的输入，然后进入so层判断
用ida打开so层，直接搜索java，进入判断函数
下面的字符串应该是密钥
qmemcpy(v6, &amp;#34;12345678&amp;#34;, sizeof(v6)); 然后调用了三个函数
sub_FFC(v7, v6, v4); sub_1088(v7, flag, 39); sub_10D4(flag, 39, v6, v4); 进入查看，第一个是RC4密钥初始化，第二个是RC4加密，第三个是对密文进行简单的运算
从字符串里拿密文，写脚本进行求解，先对简单运算进行反向运算，然后找个RC4密码的脚本，跑一下就可以找到flag
cipher = [0xA3, 0x1A, 0xE3, 0x69, 0x2F, 0xBB, 0x1A, 0x84, 0x65, 0xC2, 0xAD, 0xAD, 0x9E, 0x96, 5, 2, 0x1F, 0x8E, 0x36, 0x4F, 0xE1, 0xEB, 0xAF, 0xF0, 0xEA, 0xC4, 0xA8, 0x2D, 0x42, 0xC7, 0x6E, 0x3F, 0xB0, 0xD3, 0xCC, 0x78, 0xF9, 0x98, 0x3F, 0] key = [0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37, 0x38] def __rc4_init(key): keylength = len(key) S = list(range(256)) j = 0 for i in range(256): j = (j &#43; S[i] &#43; key[i % keylength]) % 256 S[i], S[j] = S[j], S[i] return S def rc4_crypt(key, data): S = __rc4_init(key) i = j = 0 result = b&amp;#39;&amp;#39; for a in data: i = (i &#43; 1) % 256 j = (j &#43; S[i]) % 256 S[i], S[j] = S[j], S[i] k = (a ^ S[(S[i] &#43; S[j]) % 256]).'><title>CISCN2021 RE writeup</title>

<link rel='canonical' href='/post/ciscn2021-re-writeup/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='CISCN2021 RE writeup'>
<meta property='og:description' content='glass 安卓逆向，使用jeb打开，发现在java层仅进行了简单的输入，然后进入so层判断
用ida打开so层，直接搜索java，进入判断函数
下面的字符串应该是密钥
qmemcpy(v6, &amp;#34;12345678&amp;#34;, sizeof(v6)); 然后调用了三个函数
sub_FFC(v7, v6, v4); sub_1088(v7, flag, 39); sub_10D4(flag, 39, v6, v4); 进入查看，第一个是RC4密钥初始化，第二个是RC4加密，第三个是对密文进行简单的运算
从字符串里拿密文，写脚本进行求解，先对简单运算进行反向运算，然后找个RC4密码的脚本，跑一下就可以找到flag
cipher = [0xA3, 0x1A, 0xE3, 0x69, 0x2F, 0xBB, 0x1A, 0x84, 0x65, 0xC2, 0xAD, 0xAD, 0x9E, 0x96, 5, 2, 0x1F, 0x8E, 0x36, 0x4F, 0xE1, 0xEB, 0xAF, 0xF0, 0xEA, 0xC4, 0xA8, 0x2D, 0x42, 0xC7, 0x6E, 0x3F, 0xB0, 0xD3, 0xCC, 0x78, 0xF9, 0x98, 0x3F, 0] key = [0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37, 0x38] def __rc4_init(key): keylength = len(key) S = list(range(256)) j = 0 for i in range(256): j = (j &#43; S[i] &#43; key[i % keylength]) % 256 S[i], S[j] = S[j], S[i] return S def rc4_crypt(key, data): S = __rc4_init(key) i = j = 0 result = b&amp;#39;&amp;#39; for a in data: i = (i &#43; 1) % 256 j = (j &#43; S[i]) % 256 S[i], S[j] = S[j], S[i] k = (a ^ S[(S[i] &#43; S[j]) % 256]).'>
<meta property='og:url' content='/post/ciscn2021-re-writeup/'>
<meta property='og:site_name' content='s0uthwood&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='CTF' /><meta property='article:tag' content='Reverse' /><meta property='article:tag' content='CISCN' /><meta property='article:published_time' content='2021-05-20T01:21:59&#43;00:00'/><meta property='article:modified_time' content='2021-05-20T01:21:59&#43;00:00'/>
<meta name="twitter:title" content="CISCN2021 RE writeup">
<meta name="twitter:description" content="glass 安卓逆向，使用jeb打开，发现在java层仅进行了简单的输入，然后进入so层判断
用ida打开so层，直接搜索java，进入判断函数
下面的字符串应该是密钥
qmemcpy(v6, &amp;#34;12345678&amp;#34;, sizeof(v6)); 然后调用了三个函数
sub_FFC(v7, v6, v4); sub_1088(v7, flag, 39); sub_10D4(flag, 39, v6, v4); 进入查看，第一个是RC4密钥初始化，第二个是RC4加密，第三个是对密文进行简单的运算
从字符串里拿密文，写脚本进行求解，先对简单运算进行反向运算，然后找个RC4密码的脚本，跑一下就可以找到flag
cipher = [0xA3, 0x1A, 0xE3, 0x69, 0x2F, 0xBB, 0x1A, 0x84, 0x65, 0xC2, 0xAD, 0xAD, 0x9E, 0x96, 5, 2, 0x1F, 0x8E, 0x36, 0x4F, 0xE1, 0xEB, 0xAF, 0xF0, 0xEA, 0xC4, 0xA8, 0x2D, 0x42, 0xC7, 0x6E, 0x3F, 0xB0, 0xD3, 0xCC, 0x78, 0xF9, 0x98, 0x3F, 0] key = [0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37, 0x38] def __rc4_init(key): keylength = len(key) S = list(range(256)) j = 0 for i in range(256): j = (j &#43; S[i] &#43; key[i % keylength]) % 256 S[i], S[j] = S[j], S[i] return S def rc4_crypt(key, data): S = __rc4_init(key) i = j = 0 result = b&amp;#39;&amp;#39; for a in data: i = (i &#43; 1) % 256 j = (j &#43; S[i]) % 256 S[i], S[j] = S[j], S[i] k = (a ^ S[(S[i] &#43; S[j]) % 256]).">
    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="/" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>Back</span>
            </a>
        </div>
    
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/ctf/" >
                CTF
            </a>
        
            <a href="/categories/reverse/" >
                Reverse
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/post/ciscn2021-re-writeup/">CISCN2021 RE writeup</a>
    </h2>

    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">May 20, 2021</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-pencil" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#9e9e9e" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <path d="M4 20h4L18.5 9.5a1.5 1.5.0 00-4-4L4 16v4"></path>
    <line x1="13.5" y1="6.5" x2="17.5" y2="10.5"></line>
</svg>
                <time class="article-words">
                    1938 words
                </time>
            </div>
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    10 minute read
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <h2 id="glass">glass</h2>
<p>安卓逆向，使用jeb打开，发现在java层仅进行了简单的输入，然后进入so层判断</p>
<p>用ida打开so层，直接搜索java，进入判断函数</p>
<p>下面的字符串应该是密钥</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>qmemcpy(v6, <span style="color:#e6db74">&#34;12345678&#34;</span>, <span style="color:#66d9ef">sizeof</span>(v6));
</span></span></code></pre></div><p>然后调用了三个函数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>sub_FFC(v7, v6, v4);
</span></span><span style="display:flex;"><span>sub_1088(v7, flag, <span style="color:#ae81ff">39</span>);
</span></span><span style="display:flex;"><span>sub_10D4(flag, <span style="color:#ae81ff">39</span>, v6, v4);
</span></span></code></pre></div><p>进入查看，第一个是RC4密钥初始化，第二个是RC4加密，第三个是对密文进行简单的运算</p>
<p>从字符串里拿密文，写脚本进行求解，先对简单运算进行反向运算，然后找个RC4密码的脚本，跑一下就可以找到flag</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>cipher <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0xA3</span>, <span style="color:#ae81ff">0x1A</span>, <span style="color:#ae81ff">0xE3</span>, <span style="color:#ae81ff">0x69</span>, <span style="color:#ae81ff">0x2F</span>, <span style="color:#ae81ff">0xBB</span>, <span style="color:#ae81ff">0x1A</span>, <span style="color:#ae81ff">0x84</span>, <span style="color:#ae81ff">0x65</span>, <span style="color:#ae81ff">0xC2</span>, <span style="color:#ae81ff">0xAD</span>, <span style="color:#ae81ff">0xAD</span>, <span style="color:#ae81ff">0x9E</span>, <span style="color:#ae81ff">0x96</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0x1F</span>, <span style="color:#ae81ff">0x8E</span>, <span style="color:#ae81ff">0x36</span>, <span style="color:#ae81ff">0x4F</span>, <span style="color:#ae81ff">0xE1</span>, <span style="color:#ae81ff">0xEB</span>, <span style="color:#ae81ff">0xAF</span>, <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0xEA</span>, <span style="color:#ae81ff">0xC4</span>, <span style="color:#ae81ff">0xA8</span>, <span style="color:#ae81ff">0x2D</span>, <span style="color:#ae81ff">0x42</span>, <span style="color:#ae81ff">0xC7</span>, <span style="color:#ae81ff">0x6E</span>, <span style="color:#ae81ff">0x3F</span>, <span style="color:#ae81ff">0xB0</span>, <span style="color:#ae81ff">0xD3</span>, <span style="color:#ae81ff">0xCC</span>, <span style="color:#ae81ff">0x78</span>, <span style="color:#ae81ff">0xF9</span>, <span style="color:#ae81ff">0x98</span>, <span style="color:#ae81ff">0x3F</span>, <span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0x31</span>, <span style="color:#ae81ff">0x32</span>, <span style="color:#ae81ff">0x33</span>, <span style="color:#ae81ff">0x34</span>, <span style="color:#ae81ff">0x35</span>, <span style="color:#ae81ff">0x36</span>, <span style="color:#ae81ff">0x37</span>, <span style="color:#ae81ff">0x38</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__rc4_init</span>(key):
</span></span><span style="display:flex;"><span>    keylength <span style="color:#f92672">=</span> len(key)
</span></span><span style="display:flex;"><span>    S <span style="color:#f92672">=</span> list(range(<span style="color:#ae81ff">256</span>))
</span></span><span style="display:flex;"><span>    j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">256</span>):
</span></span><span style="display:flex;"><span>        j <span style="color:#f92672">=</span> (j <span style="color:#f92672">+</span> S[i] <span style="color:#f92672">+</span> key[i <span style="color:#f92672">%</span> keylength]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>        S[i], S[j] <span style="color:#f92672">=</span> S[j], S[i]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> S
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">rc4_crypt</span>(key, data):
</span></span><span style="display:flex;"><span>    S <span style="color:#f92672">=</span> __rc4_init(key)
</span></span><span style="display:flex;"><span>    i <span style="color:#f92672">=</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> a <span style="color:#f92672">in</span> data:
</span></span><span style="display:flex;"><span>        i <span style="color:#f92672">=</span> (i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>        j <span style="color:#f92672">=</span> (j <span style="color:#f92672">+</span> S[i]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>        S[i], S[j] <span style="color:#f92672">=</span> S[j], S[i]
</span></span><span style="display:flex;"><span>        k <span style="color:#f92672">=</span> (a <span style="color:#f92672">^</span> S[(S[i] <span style="color:#f92672">+</span> S[j]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>])<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;big&#39;</span>)
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">+=</span> k
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> result
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">convert</span>(k):
</span></span><span style="display:flex;"><span>    ret <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> k <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        ret<span style="color:#f92672">.</span>append(k <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xff</span>)
</span></span><span style="display:flex;"><span>        k <span style="color:#f92672">&gt;&gt;=</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ret[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> libnum <span style="color:#f92672">import</span> n2s, s2n
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">39</span>):
</span></span><span style="display:flex;"><span>    cipher[j] <span style="color:#f92672">^=</span> key[j <span style="color:#f92672">%</span> <span style="color:#ae81ff">8</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">39</span>, <span style="color:#ae81ff">3</span>):
</span></span><span style="display:flex;"><span>    cipher[j], cipher[j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>], cipher[j <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> cipher[j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">^</span> cipher[j <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>], cipher[j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">^</span> cipher[j], cipher[j] <span style="color:#f92672">^</span> cipher[j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">^</span> cipher[j <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print (rc4_crypt(key, cipher))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># b&#39;CISCN{6654d84617f627c88846c172e0f4d46c}\xec&#39;</span>
</span></span></code></pre></div><h2 id="baby_bc">baby_bc</h2>
<p>不知道bc文件是什么，用 <code>file</code> 命令查看，发现是 <code>LLVM ir bitcode</code> 文件，上网搜索，使用 <code>clang -o baby_bc baby.bc</code> 搞成 <code>elf</code> 文件</p>
<p>拖入ida进行查看</p>
<p>首先对输入进行判断，分析输入的应该是长度是25的字符串，每个字符都在 <code>0-5</code> 之间</p>
<p>要拿到flag需要通过两个验证函数</p>
<p>第一个函数是将输入填入到map中，map中非零位输入应该为0，零位的输入不能为0</p>
<p>第二个函数是对map进行验证，分析后发现总共进行了如下验证：</p>
<ul>
<li>每行的数字不能相同</li>
<li>每列的数字不能相同</li>
<li>每行相邻两个数字的大小关系需要符合row矩阵的要求</li>
<li>每列相邻两个数字的大小关系需要符合col矩阵的要求</li>
</ul>
<p>知道要求后直接上z3约束求解器拿flag</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> z3 <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> Solver()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> [Int(<span style="color:#e6db74">&#34;flag_</span><span style="color:#e6db74">%i</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> i) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">25</span>)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">25</span>):
</span></span><span style="display:flex;"><span>    s<span style="color:#f92672">.</span>add(flag[i] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    s<span style="color:#f92672">.</span>add(flag[i] <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">6</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>add(flag[<span style="color:#ae81ff">12</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>add(flag[<span style="color:#ae81ff">18</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">5</span>):
</span></span><span style="display:flex;"><span>    add_row <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    add_col <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">5</span>):
</span></span><span style="display:flex;"><span>        add_row <span style="color:#f92672">+=</span> flag[i <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> j]
</span></span><span style="display:flex;"><span>        add_col <span style="color:#f92672">+=</span> flag[j <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> i]
</span></span><span style="display:flex;"><span>    s<span style="color:#f92672">.</span>add(add_row <span style="color:#f92672">==</span> <span style="color:#ae81ff">15</span>)
</span></span><span style="display:flex;"><span>    s<span style="color:#f92672">.</span>add(add_col <span style="color:#f92672">==</span> <span style="color:#ae81ff">15</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>add(flag[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">&gt;</span> flag[<span style="color:#ae81ff">6</span>])
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>add(flag[<span style="color:#ae81ff">20</span>] <span style="color:#f92672">&gt;</span> flag[<span style="color:#ae81ff">21</span>])
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>add(flag[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">&gt;</span> flag[<span style="color:#ae81ff">4</span>])
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>add(flag[<span style="color:#ae81ff">13</span>] <span style="color:#f92672">&gt;</span> flag[<span style="color:#ae81ff">14</span>])
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>add(flag[<span style="color:#ae81ff">22</span>] <span style="color:#f92672">&gt;</span> flag[<span style="color:#ae81ff">23</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>add(flag[<span style="color:#ae81ff">10</span>] <span style="color:#f92672">&lt;</span> flag[<span style="color:#ae81ff">11</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>add(flag[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">&gt;</span> flag[<span style="color:#ae81ff">7</span>])
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>add(flag[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">&gt;</span> flag[<span style="color:#ae81ff">9</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>add(flag[<span style="color:#ae81ff">13</span>] <span style="color:#f92672">&lt;</span> flag[<span style="color:#ae81ff">18</span>])
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>add(flag[<span style="color:#ae81ff">16</span>] <span style="color:#f92672">&lt;</span> flag[<span style="color:#ae81ff">21</span>])
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">.</span>add(flag[<span style="color:#ae81ff">19</span>] <span style="color:#f92672">&lt;</span> flag[<span style="color:#ae81ff">24</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">5</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">5</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">5</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> j <span style="color:#f92672">==</span> k:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>            s<span style="color:#f92672">.</span>add(flag[<span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> j] <span style="color:#f92672">!=</span> flag[<span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> k])
</span></span><span style="display:flex;"><span>            s<span style="color:#f92672">.</span>add(flag[<span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> j <span style="color:#f92672">+</span> i] <span style="color:#f92672">!=</span> flag[<span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> k <span style="color:#f92672">+</span> i])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> s<span style="color:#f92672">.</span>check() <span style="color:#f92672">==</span> sat:
</span></span><span style="display:flex;"><span>    model <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>model()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">25</span>):
</span></span><span style="display:flex;"><span>        print (model[flag[i]]<span style="color:#f92672">.</span>as_long()<span style="color:#f92672">.</span>real, end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print (<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">finish&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1425353142354212153442315</span>
</span></span></code></pre></div><p>最后把两个地方改成 0 就行了</p>
<h2 id="little_evil">little_evil</h2>
<h3 id="基本分析">基本分析</h3>
<p>直接用ida直接打开会看到一个叫做&quot;squashfs&quot;，而且和ruby有关，但比赛的时候没有多想，然后就走远了</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 230; 
			flex-basis: 552px"
	>
	<a href="/post/ciscn2021-re-writeup/%E7%8F%8D%E8%B4%B5%E6%88%AA%E5%9B%BE.png" data-size="1315x571">
		<img src="/post/ciscn2021-re-writeup/%E7%8F%8D%E8%B4%B5%E6%88%AA%E5%9B%BE.png"
			width="1315"
			height="571"
			srcset="/post/ciscn2021-re-writeup/%E7%8F%8D%E8%B4%B5%E6%88%AA%E5%9B%BE_hu30ea2b23d1fa00b41fb8c191982c9cbe_47250_480x0_resize_box_3.png 480w, /post/ciscn2021-re-writeup/%E7%8F%8D%E8%B4%B5%E6%88%AA%E5%9B%BE_hu30ea2b23d1fa00b41fb8c191982c9cbe_47250_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>放一张珍贵截图</p>
<p>后来得知正确方法需要先用binwalk分解一下，这里有个坑，需要自己手动装一个&quot;squashfs&quot;的插件</p>
<p>顺便补充一下什么是&quot;squashfs&quot;：基于Linux内核使用的压缩只读文件系统。难怪要用binwalk，沉思</p>
<h3 id="利用输出去混淆">利用输出去混淆</h3>
<p>分解后翻一下目录，可以找到一个 <code>out.rb</code> 的文件</p>
<p>打开后发现是一个被严重混淆的脚本，大概长下面这样</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>$l1Il<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>$l1lI<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">llIl</span>() $lI1lll<span style="color:#f92672">=</span>$lI1lll<span style="color:#f92672">|</span><span style="color:#ae81ff">7</span>; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">l1lll</span>() $lI1lll<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">llI1l</span>() $lI1lll<span style="color:#f92672">=</span>$lI1lll<span style="color:#f92672">|</span><span style="color:#ae81ff">4</span>; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lIlI</span>() $lI1lll<span style="color:#f92672">=</span>$lI1lll<span style="color:#f92672">+</span><span style="color:#ae81ff">3</span>; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">l111</span>() $lI1lll<span style="color:#f92672">=</span>$lI1lll<span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lI1IlI</span>() $lI1lll<span style="color:#f92672">=</span>$lI1lll<span style="color:#f92672">|</span><span style="color:#ae81ff">3</span>; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ll1l1</span>() $lI1lll<span style="color:#f92672">=</span>$lI1lll<span style="color:#f92672">*</span><span style="color:#ae81ff">8</span>; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">l1lI</span>() $lI1lll<span style="color:#f92672">=</span>$lI1lll<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lI1lII</span>() $lI1lll<span style="color:#f92672">=</span>$lI1lll<span style="color:#f92672">%</span><span style="color:#ae81ff">1</span>; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lIlIl</span>() $lI1lll<span style="color:#f92672">=</span>$lI1lll<span style="color:#f92672">&amp;</span><span style="color:#ae81ff">10</span>; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lIll</span>() $lI1lll<span style="color:#f92672">=</span>$lI1lll<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lII1</span>() $lI1lll<span style="color:#f92672">=</span>$lI1lll<span style="color:#f92672">%</span><span style="color:#ae81ff">2</span>; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">l1III</span>() $lI1lll<span style="color:#f92672">=</span>$lI1lll<span style="color:#f92672">|</span><span style="color:#ae81ff">1</span>; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">l1l111</span>() $lI1lll<span style="color:#f92672">=</span>$lI1lll<span style="color:#f92672">|</span><span style="color:#ae81ff">5</span>; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">l1IIII</span>() $lI1lll<span style="color:#f92672">=</span>$lI1lll<span style="color:#f92672">%</span><span style="color:#ae81ff">10</span>; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">l11I</span>() $l1Il<span style="color:#f92672">=</span>$l1Il<span style="color:#f92672">+</span>$lI1lll<span style="color:#f92672">.</span>chr; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lIlll</span>() $lI1lll<span style="color:#f92672">=</span>$lI1lll<span style="color:#f92672">*</span><span style="color:#ae81ff">9</span>; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">l11IlI</span>() $lI1lll<span style="color:#f92672">=</span>$lI1lll<span style="color:#f92672">-</span><span style="color:#ae81ff">8</span>; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lI1I1</span>() $lI1lll<span style="color:#f92672">=</span>$lI1lll<span style="color:#f92672">+</span><span style="color:#ae81ff">5</span>; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ll11lI</span>() $lI1lll<span style="color:#f92672">=</span>$lI1lll<span style="color:#f92672">&amp;</span><span style="color:#ae81ff">9</span>; <span style="color:#66d9ef">end</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lII1l1</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#send($l1Il[0,4], $l1Il[4,$l1Il.length]);</span>
</span></span><span style="display:flex;"><span>    aFile<span style="color:#f92672">=</span><span style="color:#66d9ef">File</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#34;out2.rb&#34;</span>, <span style="color:#e6db74">&#34;w&#34;</span>);
</span></span><span style="display:flex;"><span>    aFile<span style="color:#f92672">.</span>syswrite($l1Il);
</span></span><span style="display:flex;"><span>    aFile<span style="color:#f92672">.</span>close;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>;
</span></span></code></pre></div><p>最后一个函数里本来只有一个 <code>send</code> 方法，这个方法是执行第一个参数的函数，后面的参数都是这个函数的变量</p>
<p>这里跟着学长学习了一个针对解释性语言混淆的办法，就是直接输出这个send中的变量</p>
<p>输出之后还是一个相似的脚本，简单换一下行，长这样：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#75715e"># eval</span>
</span></span><span style="display:flex;"><span>$llll<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>$llII<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">l1llI</span>()$l1lI1l<span style="color:#f92672">=</span>$l1lI1l<span style="color:#f92672">|</span><span style="color:#ae81ff">7</span>; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ll1III</span>()$l1lI1l<span style="color:#f92672">=</span>$l1lI1l<span style="color:#f92672">%</span><span style="color:#ae81ff">7</span>; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lllI</span>()$l1lI1l<span style="color:#f92672">=</span>$l1lI1l<span style="color:#f92672">/</span><span style="color:#ae81ff">4</span>; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lIl1l</span>()$l1lI1l<span style="color:#f92672">=</span>$l1lI1l<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">l1lll</span>()$l1lI1l<span style="color:#f92672">=</span>$l1lI1l<span style="color:#f92672">|</span><span style="color:#ae81ff">10</span>; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">l11I1I</span>()$l1lI1l<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">l1l1</span>()$l1lI1l<span style="color:#f92672">=</span>$l1lI1l<span style="color:#f92672">&amp;</span><span style="color:#ae81ff">7</span>; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">l1II</span>()$l1lI1l<span style="color:#f92672">=</span>$l1lI1l<span style="color:#f92672">%</span><span style="color:#ae81ff">8</span>; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ll1I</span>()$l1lI1l<span style="color:#f92672">=</span>$l1lI1l<span style="color:#f92672">|</span><span style="color:#ae81ff">8</span>; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ll11</span>()$l1lI1l<span style="color:#f92672">=</span>$l1lI1l<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span>; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ll1l1I</span>()$l1lI1l<span style="color:#f92672">=</span>$l1lI1l<span style="color:#f92672">|</span><span style="color:#ae81ff">1</span>; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lI1Il</span>()$l1lI1l<span style="color:#f92672">=</span>$l1lI1l<span style="color:#f92672">|</span><span style="color:#ae81ff">3</span>; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">llI1I</span>()$l1lI1l<span style="color:#f92672">=</span>$l1lI1l<span style="color:#f92672">+</span><span style="color:#ae81ff">6</span>; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">llIl1</span>()$l1lI1l<span style="color:#f92672">=</span>$l1lI1l<span style="color:#f92672">*</span><span style="color:#ae81ff">4</span>; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lI1ll</span>()$l1lI1l<span style="color:#f92672">=</span>$l1lI1l<span style="color:#f92672">*</span><span style="color:#ae81ff">5</span>; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">l1111</span>()$l1lI1l<span style="color:#f92672">=</span>$l1lI1l<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span>; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">l1lII</span>()$l1lI1l<span style="color:#f92672">=</span>$l1lI1l<span style="color:#f92672">^</span><span style="color:#ae81ff">4</span>; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lIIl</span>()$l1lI1l<span style="color:#f92672">=</span>$l1lI1l<span style="color:#f92672">%</span><span style="color:#ae81ff">5</span>; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lII11</span>()$l1lI1l<span style="color:#f92672">=</span>$l1lI1l<span style="color:#f92672">+</span><span style="color:#ae81ff">9</span>; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lI11I</span>()$llll<span style="color:#f92672">=</span>$llll<span style="color:#f92672">+</span>$l1lI1l<span style="color:#f92672">.</span>chr; <span style="color:#66d9ef">end</span>; 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">l1IlI</span>()send($llll<span style="color:#f92672">[</span><span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">4</span><span style="color:#f92672">]</span>, $llll<span style="color:#f92672">[</span><span style="color:#ae81ff">4</span>,$llll<span style="color:#f92672">.</span>length<span style="color:#f92672">]</span>); <span style="color:#66d9ef">end</span>; 
</span></span></code></pre></div><p>一开始的 <code>eval</code> 就是 <code>send</code> 中调用的函数，可以分析出来后面的东西就是要用来执行的，因为这是解释性语言，直接输出就拿到源代码了</p>
<p>和刚才进行同样的操作，拿到第三份脚本</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">begin</span> $_<span style="color:#f92672">=</span>$$<span style="color:#f92672">/</span>$$;@_<span style="color:#f92672">=</span>$_<span style="color:#f92672">+</span>$_;$-_<span style="color:#f92672">=</span>$_<span style="color:#f92672">-</span>@_
</span></span><span style="display:flex;"><span>$__<span style="color:#f92672">=-&gt;</span>_{_<span style="color:#f92672">==[]||</span>_<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;&#39;</span><span style="color:#e6db74">?$</span><span style="color:#f92672">.</span>:$_<span style="color:#f92672">+</span>$__<span style="color:#f92672">[</span>_<span style="color:#f92672">[</span>$_<span style="color:#f92672">..</span>$-_<span style="color:#f92672">]]</span>}
</span></span><span style="display:flex;"><span>@__<span style="color:#f92672">=-&gt;</span>_,<span style="color:#f92672">&amp;</span>__{_<span style="color:#f92672">==[]</span><span style="color:#e6db74">?[</span><span style="color:#f92672">]</span>:<span style="color:#f92672">[</span>__<span style="color:#f92672">[</span>_<span style="color:#f92672">[</span>$.<span style="color:#f92672">]]]+</span>@__<span style="color:#f92672">[</span>_<span style="color:#f92672">[</span>$_<span style="color:#f92672">..</span>$-_<span style="color:#f92672">]</span>,<span style="color:#f92672">&amp;</span>__<span style="color:#f92672">]</span>}
</span></span><span style="display:flex;"><span>$_____<span style="color:#f92672">=-&gt;</span>_{@__<span style="color:#f92672">[[*</span>_<span style="color:#f92672">]</span>,<span style="color:#f92672">&amp;-&gt;</span>__{__<span style="color:#f92672">[</span>$.<span style="color:#f92672">]</span>}<span style="color:#f92672">]</span>}
</span></span><span style="display:flex;"><span>@_____<span style="color:#f92672">=-&gt;</span>_{@__<span style="color:#f92672">[[*</span>_<span style="color:#f92672">]</span>,<span style="color:#f92672">&amp;-&gt;</span>__{__<span style="color:#f92672">[</span>$-_<span style="color:#f92672">]</span>}<span style="color:#f92672">]</span>}
</span></span><span style="display:flex;"><span>$______<span style="color:#f92672">=-&gt;</span>_{___,______<span style="color:#f92672">=</span>$_____<span style="color:#f92672">[</span>_<span style="color:#f92672">]</span>,@_____<span style="color:#f92672">[</span>_<span style="color:#f92672">]</span>;_____<span style="color:#f92672">=</span>$__<span style="color:#f92672">[</span>___<span style="color:#f92672">]</span>;____<span style="color:#f92672">=</span>{};__<span style="color:#f92672">=</span>$.;(_<span style="color:#f92672">=-&gt;</span>{
</span></span><span style="display:flex;"><span>  ____<span style="color:#f92672">[</span>______<span style="color:#f92672">[</span>__<span style="color:#f92672">]]=</span>___<span style="color:#f92672">[</span>__<span style="color:#f92672">]</span>;(__<span style="color:#f92672">+=</span>$_)<span style="color:#f92672">==</span>_____ ?<span style="color:#e6db74">____</span>:_<span style="color:#f92672">[]</span>})<span style="color:#f92672">[]</span>}
</span></span><span style="display:flex;"><span>@______<span style="color:#f92672">=-&gt;</span>_,__{_<span style="color:#f92672">=[*</span>_<span style="color:#f92672">]+[*</span>__<span style="color:#f92672">]</span>;____<span style="color:#f92672">=</span>$__<span style="color:#f92672">[</span>_<span style="color:#f92672">]</span>;___<span style="color:#f92672">=</span>{};__<span style="color:#f92672">=</span>$.;(_____<span style="color:#f92672">=-&gt;</span>{
</span></span><span style="display:flex;"><span>  ___<span style="color:#f92672">[</span>_<span style="color:#f92672">[</span>__<span style="color:#f92672">][</span>$.<span style="color:#f92672">]]=</span>_<span style="color:#f92672">[</span>__<span style="color:#f92672">][</span>$_<span style="color:#f92672">]</span>;(__<span style="color:#f92672">+=</span>$_)<span style="color:#f92672">==</span>____ ?<span style="color:#e6db74">___</span>:_____<span style="color:#f92672">[]</span>})<span style="color:#f92672">[]</span>}
</span></span><span style="display:flex;"><span>$_______<span style="color:#f92672">=-&gt;</span>_{$___<span style="color:#f92672">=[]</span>;@___<span style="color:#f92672">=</span>$__<span style="color:#f92672">[</span>_<span style="color:#f92672">]</span>;__<span style="color:#f92672">=</span>___<span style="color:#f92672">=</span>____<span style="color:#f92672">=</span>$.;$____,@____<span style="color:#f92672">=</span>{},<span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>(_____<span style="color:#f92672">=-&gt;</span>{
</span></span><span style="display:flex;"><span>  _<span style="color:#f92672">[</span>____<span style="color:#f92672">]==</span><span style="color:#e6db74">&#39;5&#39;</span><span style="color:#e6db74">?(</span>@____<span style="color:#f92672">&lt;&lt;</span>____):$.
</span></span><span style="display:flex;"><span>  _<span style="color:#f92672">[</span>____<span style="color:#f92672">]==</span><span style="color:#e6db74">&#39;6&#39;</span><span style="color:#e6db74">?(</span>$____<span style="color:#f92672">[</span>@____<span style="color:#f92672">[</span>$-_<span style="color:#f92672">]]=</span>____;@____<span style="color:#f92672">=</span>@____<span style="color:#f92672">[</span>$.<span style="color:#f92672">..</span>$.<span style="color:#f92672">-</span>@_<span style="color:#f92672">]</span>):$.
</span></span><span style="display:flex;"><span>  (____<span style="color:#f92672">+=</span>$_)<span style="color:#f92672">==</span>@___<span style="color:#e6db74">?$</span><span style="color:#f92672">.</span><span style="color:#e6db74">:_____</span><span style="color:#f92672">[]</span>})<span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>$____<span style="color:#f92672">=</span>$____<span style="color:#f92672">==</span>{}<span style="color:#e6db74">?{</span>}<span style="color:#e6db74">:@______</span><span style="color:#f92672">[</span>$____,$______<span style="color:#f92672">[</span>$____<span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span>(______<span style="color:#f92672">=-&gt;</span>{_<span style="color:#f92672">[</span>__<span style="color:#f92672">]==</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;0&#39;</span><span style="color:#e6db74">?(</span>$___<span style="color:#f92672">[</span>___<span style="color:#f92672">]||=</span>$.;$___<span style="color:#f92672">[</span>___<span style="color:#f92672">]+=</span>$_)<span style="color:#e6db74">:_</span><span style="color:#f92672">[</span>__<span style="color:#f92672">]==</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;1&#39;</span><span style="color:#e6db74">?(</span>$___<span style="color:#f92672">[</span>___<span style="color:#f92672">]||=</span>$.;$___<span style="color:#f92672">[</span>___<span style="color:#f92672">]-=</span>$_)<span style="color:#e6db74">:_</span><span style="color:#f92672">[</span>__<span style="color:#f92672">]==</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;2&#39;</span><span style="color:#e6db74">?(</span>$___<span style="color:#f92672">[</span>___<span style="color:#f92672">]||=</span>$.;$___<span style="color:#f92672">[</span>___<span style="color:#f92672">]=</span><span style="color:#66d9ef">STDIN</span><span style="color:#f92672">.</span>getc<span style="color:#f92672">.</span>ord)<span style="color:#e6db74">:_</span><span style="color:#f92672">[</span>__<span style="color:#f92672">]==</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;3&#39;</span>?(___<span style="color:#f92672">+=</span>$_)<span style="color:#e6db74">:_</span><span style="color:#f92672">[</span>__<span style="color:#f92672">]==</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;4&#39;</span>?(___<span style="color:#f92672">-=</span>$_)<span style="color:#e6db74">:_</span><span style="color:#f92672">[</span>__<span style="color:#f92672">]==</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;5&#39;</span>?(__<span style="color:#f92672">=</span>($___<span style="color:#f92672">[</span>___<span style="color:#f92672">]||</span>$.)<span style="color:#f92672">==</span>$.?$____<span style="color:#f92672">[</span>__<span style="color:#f92672">]</span><span style="color:#e6db74">:__</span>)<span style="color:#e6db74">:_</span><span style="color:#f92672">[</span>__<span style="color:#f92672">]==</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;6&#39;</span>?(__<span style="color:#f92672">=</span>($___<span style="color:#f92672">[</span>___<span style="color:#f92672">]||</span>$.)<span style="color:#f92672">!=</span>$.?$____<span style="color:#f92672">[</span>__<span style="color:#f92672">]</span><span style="color:#e6db74">:__</span>)<span style="color:#e6db74">:_</span><span style="color:#f92672">[</span>__<span style="color:#f92672">]==</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;7&#39;</span><span style="color:#e6db74">?(</span>$&gt;<span style="color:#f92672">&lt;&lt;</span>(<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">&lt;&lt;</span>$___<span style="color:#f92672">[</span>___<span style="color:#f92672">]</span>)):$.
</span></span><span style="display:flex;"><span>(__<span style="color:#f92672">+=</span>$_)<span style="color:#f92672">==</span>@___<span style="color:#e6db74">?_</span><span style="color:#e6db74">:______</span><span style="color:#f92672">[]</span>})<span style="color:#f92672">[]</span>}
</span></span><span style="display:flex;"><span>$_______<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;33516351...44516644&#39;</span><span style="color:#f92672">]</span>;<span style="color:#66d9ef">rescue</span> <span style="color:#66d9ef">Exception</span>;<span style="color:#66d9ef">end</span> <span style="color:#75715e">#中间部分省略了</span>
</span></span></code></pre></div><p>这份脚本就很丑了，最后一长串的数字，让我自己来猜的话肯定会猜是一个虚拟机</p>
<p>然后一大堆 <code>?</code> 一看就是 <code>switch</code> 语句，后来细看才发现全是三元运算符，但也是 <code>switch</code> 的作用</p>
<p>于是将指令部分翻译成 python（只是熟悉一点而已）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> _[tmp_2] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;0&#39;</span>:
</span></span><span style="display:flex;"><span>    global_3[tmp_3] <span style="color:#f92672">||=</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>    global_3[tmp_3] <span style="color:#f92672">+=</span> global_1
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> _[tmp_2] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;1&#39;</span>:
</span></span><span style="display:flex;"><span>    global_3[tmp_3] <span style="color:#f92672">||=</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>    global_3[tmp_3] <span style="color:#f92672">-=</span> global_1
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> _[tmp_2] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;2&#39;</span>:
</span></span><span style="display:flex;"><span>    global_3[tmp_3] <span style="color:#f92672">||=</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>    global_3[tmp_3] <span style="color:#f92672">=</span> STDIN<span style="color:#f92672">.</span>getc<span style="color:#f92672">.</span>ord
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> _[tmp_2] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;3&#39;</span>:
</span></span><span style="display:flex;"><span>    tmp_3 <span style="color:#f92672">+=</span> global_1
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> _[tmp_2] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;4&#39;</span>:
</span></span><span style="display:flex;"><span>    tmp_3 <span style="color:#f92672">-=</span> global_1
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> _[tmp_2] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;5&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (global_3[tmp_3] <span style="color:#f92672">or</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#f92672">.</span>) <span style="color:#f92672">==</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#f92672">.</span>:
</span></span><span style="display:flex;"><span>        tmp_2 <span style="color:#f92672">=</span> global_4[tmp_2]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> _[tmp_2] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;6&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (global_3[tmp_3] <span style="color:#f92672">or</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#f92672">.</span>) <span style="color:#f92672">!=</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#f92672">.</span>:
</span></span><span style="display:flex;"><span>        tmp_2 <span style="color:#f92672">=</span> global_4[tmp_2]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> _[tmp_2] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;7&#39;</span>:
</span></span><span style="display:flex;"><span>    global_0<span style="color:#f92672">&lt;&lt;</span>(<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>append(global_3[tmp_3]))
</span></span></code></pre></div><p>因为是补题，所以提前知道是 brainfuck 语言，但还是尝试自己逆了一下</p>
<ul>
<li>tmp_3 是指针，操作3和4对应了指针+1 -1(&gt;和&lt;)</li>
<li>global_3 是指针指向的字节，操作0和1对应了字节的+1 -1(+和-)</li>
<li>操作2中含有获取输入，对应了获取输入操作(,)</li>
<li>操作7中含有&laquo;，怀疑是输出，对应了输出操作(.)</li>
<li>5和6对应了跳转，猜测5是[，6是]</li>
</ul>
<p>之后就可以找个脚本翻译 brainfuck 了</p>
<p>我先用 python 将其转为了正常的 brainfuck 语言</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>finalop <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>base <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;+-,&gt;&lt;[].&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> op: <span style="color:#75715e"># 那一串数字</span>
</span></span><span style="display:flex;"><span>    finalop <span style="color:#f92672">+=</span> (base[int(c)])
</span></span><span style="display:flex;"><span>print (finalop)
</span></span></code></pre></div><p>然后找了个脚本，这是核心部分：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> cur <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> ((c <span style="color:#f92672">=</span> getc(in)) <span style="color:#f92672">!=</span> EOF) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">switch</span> (c) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;&gt;&#39;</span><span style="color:#f92672">:</span> 
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// fprintf(out, &#34;\t\t++c;\n&#34;); 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                cur<span style="color:#f92672">++</span>; 
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;&lt;&#39;</span><span style="color:#f92672">:</span> 
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// fprintf(out, &#34;\t\t--c;\n&#34;); 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                cur<span style="color:#f92672">--</span>; <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;+&#39;</span><span style="color:#f92672">:</span> fprintf(out, <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t\t</span><span style="color:#e6db74">++a[%d];</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, cur); <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;-&#39;</span><span style="color:#f92672">:</span> fprintf(out, <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t\t</span><span style="color:#e6db74">--a[%d];</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, cur); <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;.&#39;</span><span style="color:#f92672">:</span> fprintf(out, <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t\t</span><span style="color:#e6db74">putchar(a[%d]);</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, cur); <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;,&#39;</span><span style="color:#f92672">:</span> fprintf(out, <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t\t</span><span style="color:#e6db74">a[%d] = getchar();</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, cur); <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;[&#39;</span><span style="color:#f92672">:</span> fprintf(out, <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">while (a[%d]) {</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, cur); <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;]&#39;</span><span style="color:#f92672">:</span> fprintf(out, <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>); <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>一开始随便找了个脚本就运行，然后尝试去看，但后来发现很多指针位置的变化，看着很累，于是让指针的变化在内部运行，对具体数做变化的时候直接打印指针的值就可以了</p>
<h3 id="brainfuck-代码阅读">Brainfuck 代码阅读</h3>
<p>接下来就是痛苦的 Brainfuck 代码阅读环节了，虽然代码已经有了最简单的美化，但看起来还是像混淆过的汇编。</p>
<p>自己做的时候是一点一点美化代码，然后阅读的。但最后找到验证函数才搞明白。</p>
<p>所以先去最下面找到验证函数，看到最下面有两个<code>putchar</code>，猜测就是通过验证了，于是找进入的条件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>		a[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> getchar();
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// several code
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">while</span> (a[<span style="color:#ae81ff">2</span>]) {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// several code
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		a[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// several code
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	}
</span></span><span style="display:flex;"><span>		a[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>		a[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> (a[<span style="color:#ae81ff">1</span>]) {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">--</span>a[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	    <span style="color:#75715e">// several code
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">while</span> (a[<span style="color:#ae81ff">2</span>]) {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// several code
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		putchar(a[<span style="color:#ae81ff">4</span>]);
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// several code
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		putchar(a[<span style="color:#ae81ff">4</span>]);
</span></span><span style="display:flex;"><span>		a[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></div><p>进入的条件是要 <code>a[2] &gt; 0</code>，网上看就知道需要让 <code>a[1] &gt; 0</code>，所以在编辑器里选中一下，就能找到所有 <code>a[1]</code> 出现的地方（这就体现出这种输出方法的优势了）</p>
<p>然后发现 <code>a[1]</code> 会在一开始赋值为 <code>1</code>，但一旦进入 <code>while(a[2])</code> 这种大循环，就会出现 <code>a[1]=0</code> 的赋值，所以我们的目标就是在进入循环前让 <code>a[2]==0</code></p>
<p>查看一下从 <code>getchar</code> 到 <code>while</code> 之间的代码，把重复出现的 <code>++</code> 都合并一下</p>
<p>这里以第一次 <code>getchar</code> 的代码为例，（剩下几次形式几乎完全一致，就是参数有点小变化而已）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>		a[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> getchar();
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> (a[<span style="color:#ae81ff">3</span>]) {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">--</span>a[<span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> (a[<span style="color:#ae81ff">4</span>]) {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">--</span>a[<span style="color:#ae81ff">4</span>];
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">4</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">4</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">4</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">4</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">4</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">4</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">4</span>];
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> (a[<span style="color:#ae81ff">4</span>]) {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">--</span>a[<span style="color:#ae81ff">4</span>];
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> (a[<span style="color:#ae81ff">3</span>]) {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">--</span>a[<span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">--</span>a[<span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> (a[<span style="color:#ae81ff">2</span>]) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> (a[<span style="color:#ae81ff">4</span>]) {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">--</span>a[<span style="color:#ae81ff">4</span>];
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> (a[<span style="color:#ae81ff">5</span>]) {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">--</span>a[<span style="color:#ae81ff">5</span>];
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> (a[<span style="color:#ae81ff">1</span>]) {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">--</span>a[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> (a[<span style="color:#ae81ff">4</span>]) {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">5</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">--</span>a[<span style="color:#ae81ff">4</span>];
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> (a[<span style="color:#ae81ff">5</span>]) {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">++</span>a[<span style="color:#ae81ff">4</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">--</span>a[<span style="color:#ae81ff">5</span>];
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> (a[<span style="color:#ae81ff">2</span>]) {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">--</span>a[<span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> (a[<span style="color:#ae81ff">2</span>]) {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">--</span>a[<span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></div><p>美化一下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>		a[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> getchar();
</span></span><span style="display:flex;"><span>		a[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>		a[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> (a[<span style="color:#ae81ff">4</span>]) {
</span></span><span style="display:flex;"><span>		a[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">11</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">--</span>a[<span style="color:#ae81ff">4</span>];
</span></span><span style="display:flex;"><span>	} <span style="color:#75715e">// a[3] = a[4] * 11 = 77
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        a[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">-=</span> a[<span style="color:#ae81ff">3</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> (a[<span style="color:#ae81ff">2</span>]) {
</span></span><span style="display:flex;"><span>        a[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        a[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        a[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        a[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>    	a[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span></code></pre></div><p>简单地说就是会生成一个数字，然后用 <code>a[2]</code> 去减，如果结果为 <code>0</code>，就通过验证了，对所有的输入都搞一次，就能拿到五个输入字符 <code>M5Ya7</code></p>
<h3 id="总结">总结</h3>
<p>做这道题的时候，最大的问题就是没有搜索足够的资料，如果第一步想出来的话的，以比赛的时间，应该还是有机会做出来这道题的，毕竟后续的工作都是体力活，一点一点做下去应该就差不多能出来了</p>
<p>不过不管怎么说，补题的过程还是学到了很多东西的，比如“病毒式”混淆可以直接用输出来解，brainfuck的小型解释器怎么看，以及最后直接输出索引地址，做题经验++</p>
<h2 id="hmi">HMI</h2>
<p>先说结论：屑题</p>
<p>参考了这篇博客：https://myts2.cn/2021/05/16/ciscn2021/</p>
<h3 id="逆向分析">逆向分析</h3>
<p>用 file 命令看一眼，发现全是 .NET，直接上 dnSpy</p>
<p>先搜索 <code>CISCN</code> 字符串，找到最后的验证和输出</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#66d9ef">checked</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> (!<span style="color:#66d9ef">string</span>.IsNullOrEmpty(AnalogValueDisplay.combined[num4]))
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		num4++;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (num4 &gt; <span style="color:#ae81ff">7</span>)
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			IL_1B9:
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> (num3 == <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>			{
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">string</span> hash = AnalogValueDisplay.GetHash(<span style="color:#66d9ef">string</span>.Join(<span style="color:#e6db74">&#34;,&#34;</span>, AnalogValueDisplay.combined));
</span></span><span style="display:flex;"><span>				Console.WriteLine(<span style="color:#e6db74">&#34;Booooooooooooooooom!&#34;</span>);
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">if</span> (Operators.CompareString(hash.Substring(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">10</span>), <span style="color:#e6db74">&#34;F0B278CCB9&#34;</span>, <span style="color:#66d9ef">false</span>) == <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>				{
</span></span><span style="display:flex;"><span>							Console.WriteLine(<span style="color:#e6db74">&#34;CISCN{&#34;</span> + hash + <span style="color:#e6db74">&#34;}&#34;</span>);
</span></span><span style="display:flex;"><span>						}
</span></span><span style="display:flex;"><span>					}
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	num3 = <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">goto</span> IL_1B9;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>所以最后需要通过一个md5验证，然后往回找 <code>combined</code> 是什么，发现是从 <code>text</code> 赋值的</p>
<p>而具体赋值到哪里，则是由 <code>num2</code> 决定的， <code>num2</code> 是一串 <code>41047</code> - <code>41054</code> 的字符串</p>
<p>比赛的时候只知道这个是一个端口，但具体是什么没搞出来，疯狂往回找引用发现找不到东西，怀疑还是需要远程往里面打数据，因此尝试搭建GRFICS的平台（队内大佬找到的），最后熬不动放弃了</p>
<p>参考别人的wp之后发现需要使用 Modbus Slave 往里面打数据，开始补题</p>
<h3 id="modbus-slave调试">Modbus Slave调试</h3>
<p>之前找到的 <code>401**</code> 原来就是 Modbus 的端口，所以只需要用 Modbus Slave 往相应端口添加数据就行</p>
<p>先直接运行找到粗略的范围（调试修改数据太慢了），目标就是让数字都变成白色</p>
<p>在粗查的时候就能发现小数点后有一些位置在 exe 界面是看不到的</p>
<p>明确范围后进 dnSpy 调试，总结出一个表格</p>
<table>
<thead>
<tr>
<th></th>
<th>min</th>
<th></th>
<th>max</th>
<th></th>
<th>dif</th>
<th>combined</th>
<th>i</th>
</tr>
</thead>
<tbody>
<tr>
<td>$41046$</td>
<td>$52.8016$</td>
<td>$17312$</td>
<td>$52.8992$</td>
<td>$17344$</td>
<td>$0.00305$</td>
<td>$0.00305$</td>
<td>$2$</td>
</tr>
<tr>
<td>$41047$</td>
<td>$25.0002$</td>
<td>$1634$</td>
<td>$25.092$</td>
<td>$1640$</td>
<td>$0.0153$</td>
<td>$0.0153$</td>
<td>$1$</td>
</tr>
<tr>
<td>$41048$</td>
<td>$62.10105$</td>
<td>$20361$</td>
<td>$62.19865$</td>
<td>$20393$</td>
<td>$0.00305$</td>
<td>$0.00305$</td>
<td>$0$</td>
</tr>
<tr>
<td>$41049$</td>
<td>$406.6128$</td>
<td>$26576$</td>
<td>$406.6893$</td>
<td>$26581$</td>
<td>$0.0153$</td>
<td>$0.0153$</td>
<td>$3$</td>
</tr>
<tr>
<td>$41050$</td>
<td>$54.00025$</td>
<td>$17705$</td>
<td>$54.09785$</td>
<td>$17737$</td>
<td>$0.00305$</td>
<td>$0.00305$</td>
<td>$7$</td>
</tr>
<tr>
<td>$41051$</td>
<td>$158.0031$</td>
<td>$10327$</td>
<td>$158.0949$</td>
<td>$10333$</td>
<td>$0.0153$</td>
<td>$0.0153$</td>
<td>$6$</td>
</tr>
<tr>
<td>$41052$</td>
<td>$22.0027$</td>
<td>$7214$</td>
<td>$22.09725$</td>
<td>$7245$</td>
<td>$0.00305$</td>
<td>$0.00305$</td>
<td>$4$</td>
</tr>
<tr>
<td>$41053$</td>
<td>$13.1121$</td>
<td>$857$</td>
<td>$13.1886$</td>
<td>$862$</td>
<td>$0.0153$</td>
<td>$0.0153$</td>
<td>$5$</td>
</tr>
</tbody>
</table>
<p>接下来在这一范围内进行爆破就好了</p>
<p>对范围做了个计算，我搞出来的是 2028571776，不知道为什么参考比我这个小一点</p>
<h3 id="爆破">爆破</h3>
<p>因为最后要算 md5，所以精度不能有问题，又因为爆破范围大概在 20 亿左右，所以速度也不能慢</p>
<p>于是决定先用python的Decimal来算小数，再用cpp求解</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> decimal <span style="color:#f92672">import</span> Decimal
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>min <span style="color:#f92672">=</span> [<span style="color:#ae81ff">52.8016</span>, <span style="color:#ae81ff">25.0002</span>, <span style="color:#ae81ff">62.10105</span>, <span style="color:#ae81ff">406.6128</span>, <span style="color:#ae81ff">54.00025</span>, <span style="color:#ae81ff">158.0031</span>, <span style="color:#ae81ff">22.0027</span>, <span style="color:#ae81ff">13.1121</span>]
</span></span><span style="display:flex;"><span>max <span style="color:#f92672">=</span> [<span style="color:#ae81ff">52.8992</span>, <span style="color:#ae81ff">25.092</span>, <span style="color:#ae81ff">62.19865</span>, <span style="color:#ae81ff">406.6893</span>, <span style="color:#ae81ff">54.09785</span>, <span style="color:#ae81ff">158.0949</span>, <span style="color:#ae81ff">22.09725</span>, <span style="color:#ae81ff">13.1886</span>]
</span></span><span style="display:flex;"><span>dif <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0.00305</span>, <span style="color:#ae81ff">0.0153</span>, <span style="color:#ae81ff">0.00305</span>, <span style="color:#ae81ff">0.0153</span>, <span style="color:#ae81ff">0.00305</span>, <span style="color:#ae81ff">0.0153</span>, <span style="color:#ae81ff">0.00305</span>, <span style="color:#ae81ff">0.0153</span>]
</span></span><span style="display:flex;"><span>round <span style="color:#f92672">=</span> [<span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">6</span>]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8</span>):
</span></span><span style="display:flex;"><span>    min[i] <span style="color:#f92672">=</span> str(min[i])
</span></span><span style="display:flex;"><span>    max[i] <span style="color:#f92672">=</span> str(max[i])
</span></span><span style="display:flex;"><span>    dif[i] <span style="color:#f92672">=</span> str(dif[i])
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> min[i]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(round[i]):
</span></span><span style="display:flex;"><span>        print (res, end <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;, &#39;</span>)
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">=</span> Decimal(res) <span style="color:#f92672">+</span> Decimal(dif[i])
</span></span><span style="display:flex;"><span>    print ()
</span></span></code></pre></div><p>最后算出来的结尾会有0，手动去除一下就行</p>
<p>然后用cpp进行爆破，这里写的比较懒</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#pragma GCC optimize(3)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;bits/stdc++.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;openssl/md5.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>string combine[<span style="color:#ae81ff">8</span>][<span style="color:#ae81ff">40</span>] <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    {<span style="color:#e6db74">&#34;62.10105&#34;</span>, <span style="color:#e6db74">&#34;62.1041&#34;</span>, <span style="color:#e6db74">&#34;62.10715&#34;</span>, <span style="color:#e6db74">&#34;62.1102&#34;</span>, <span style="color:#e6db74">&#34;62.11325&#34;</span>, <span style="color:#e6db74">&#34;62.1163&#34;</span>, <span style="color:#e6db74">&#34;62.11935&#34;</span>, <span style="color:#e6db74">&#34;62.1224&#34;</span>, <span style="color:#e6db74">&#34;62.12545&#34;</span>, <span style="color:#e6db74">&#34;62.1285&#34;</span>, <span style="color:#e6db74">&#34;62.13155&#34;</span>, <span style="color:#e6db74">&#34;62.1346&#34;</span>, <span style="color:#e6db74">&#34;62.13765&#34;</span>, <span style="color:#e6db74">&#34;62.1407&#34;</span>, <span style="color:#e6db74">&#34;62.14375&#34;</span>, <span style="color:#e6db74">&#34;62.1468&#34;</span>, <span style="color:#e6db74">&#34;62.14985&#34;</span>, <span style="color:#e6db74">&#34;62.1529&#34;</span>, <span style="color:#e6db74">&#34;62.15595&#34;</span>, <span style="color:#e6db74">&#34;62.1590&#34;</span>, <span style="color:#e6db74">&#34;62.16205&#34;</span>, <span style="color:#e6db74">&#34;62.1651&#34;</span>, <span style="color:#e6db74">&#34;62.16815&#34;</span>, <span style="color:#e6db74">&#34;62.1712&#34;</span>, <span style="color:#e6db74">&#34;62.17425&#34;</span>, <span style="color:#e6db74">&#34;62.1773&#34;</span>, <span style="color:#e6db74">&#34;62.18035&#34;</span>, <span style="color:#e6db74">&#34;62.1834&#34;</span>, <span style="color:#e6db74">&#34;62.18645&#34;</span>, <span style="color:#e6db74">&#34;62.1895&#34;</span>, <span style="color:#e6db74">&#34;62.19255&#34;</span>, <span style="color:#e6db74">&#34;62.1956&#34;</span>, <span style="color:#e6db74">&#34;62.19865&#34;</span>},
</span></span><span style="display:flex;"><span>    {<span style="color:#e6db74">&#34;25.0002&#34;</span>, <span style="color:#e6db74">&#34;25.0155&#34;</span>, <span style="color:#e6db74">&#34;25.0308&#34;</span>, <span style="color:#e6db74">&#34;25.0461&#34;</span>, <span style="color:#e6db74">&#34;25.0614&#34;</span>, <span style="color:#e6db74">&#34;25.0767&#34;</span>, <span style="color:#e6db74">&#34;25.092&#34;</span>},
</span></span><span style="display:flex;"><span>    {<span style="color:#e6db74">&#34;52.8016&#34;</span>, <span style="color:#e6db74">&#34;52.80465&#34;</span>, <span style="color:#e6db74">&#34;52.8077&#34;</span>, <span style="color:#e6db74">&#34;52.81075&#34;</span>, <span style="color:#e6db74">&#34;52.8138&#34;</span>, <span style="color:#e6db74">&#34;52.81685&#34;</span>, <span style="color:#e6db74">&#34;52.8199&#34;</span>, <span style="color:#e6db74">&#34;52.82295&#34;</span>, <span style="color:#e6db74">&#34;52.8260&#34;</span>, <span style="color:#e6db74">&#34;52.82905&#34;</span>, <span style="color:#e6db74">&#34;52.8321&#34;</span>, <span style="color:#e6db74">&#34;52.83515&#34;</span>, <span style="color:#e6db74">&#34;52.8382&#34;</span>, <span style="color:#e6db74">&#34;52.84125&#34;</span>, <span style="color:#e6db74">&#34;52.8443&#34;</span>, <span style="color:#e6db74">&#34;52.84735&#34;</span>, <span style="color:#e6db74">&#34;52.8504&#34;</span>, <span style="color:#e6db74">&#34;52.85345&#34;</span>, <span style="color:#e6db74">&#34;52.8565&#34;</span>, <span style="color:#e6db74">&#34;52.85955&#34;</span>, <span style="color:#e6db74">&#34;52.8626&#34;</span>, <span style="color:#e6db74">&#34;52.86565&#34;</span>, <span style="color:#e6db74">&#34;52.8687&#34;</span>, <span style="color:#e6db74">&#34;52.87175&#34;</span>, <span style="color:#e6db74">&#34;52.8748&#34;</span>, <span style="color:#e6db74">&#34;52.87785&#34;</span>, <span style="color:#e6db74">&#34;52.8809&#34;</span>, <span style="color:#e6db74">&#34;52.88395&#34;</span>, <span style="color:#e6db74">&#34;52.8870&#34;</span>, <span style="color:#e6db74">&#34;52.89005&#34;</span>, <span style="color:#e6db74">&#34;52.8931&#34;</span>, <span style="color:#e6db74">&#34;52.89615&#34;</span>, <span style="color:#e6db74">&#34;52.8992&#34;</span>},
</span></span><span style="display:flex;"><span>    {<span style="color:#e6db74">&#34;406.6128&#34;</span>, <span style="color:#e6db74">&#34;406.6281&#34;</span>, <span style="color:#e6db74">&#34;406.6434&#34;</span>, <span style="color:#e6db74">&#34;406.6587&#34;</span>, <span style="color:#e6db74">&#34;406.674&#34;</span>, <span style="color:#e6db74">&#34;406.6893&#34;</span>},
</span></span><span style="display:flex;"><span>    {<span style="color:#e6db74">&#34;22.0027&#34;</span>, <span style="color:#e6db74">&#34;22.00575&#34;</span>, <span style="color:#e6db74">&#34;22.0088&#34;</span>, <span style="color:#e6db74">&#34;22.01185&#34;</span>, <span style="color:#e6db74">&#34;22.0149&#34;</span>, <span style="color:#e6db74">&#34;22.01795&#34;</span>, <span style="color:#e6db74">&#34;22.0210&#34;</span>, <span style="color:#e6db74">&#34;22.02405&#34;</span>, <span style="color:#e6db74">&#34;22.0271&#34;</span>, <span style="color:#e6db74">&#34;22.03015&#34;</span>, <span style="color:#e6db74">&#34;22.0332&#34;</span>, <span style="color:#e6db74">&#34;22.03625&#34;</span>, <span style="color:#e6db74">&#34;22.0393&#34;</span>, <span style="color:#e6db74">&#34;22.04235&#34;</span>, <span style="color:#e6db74">&#34;22.0454&#34;</span>, <span style="color:#e6db74">&#34;22.04845&#34;</span>, <span style="color:#e6db74">&#34;22.0515&#34;</span>, <span style="color:#e6db74">&#34;22.05455&#34;</span>, <span style="color:#e6db74">&#34;22.0576&#34;</span>, <span style="color:#e6db74">&#34;22.06065&#34;</span>, <span style="color:#e6db74">&#34;22.0637&#34;</span>, <span style="color:#e6db74">&#34;22.06675&#34;</span>, <span style="color:#e6db74">&#34;22.0698&#34;</span>, <span style="color:#e6db74">&#34;22.07285&#34;</span>, <span style="color:#e6db74">&#34;22.0759&#34;</span>, <span style="color:#e6db74">&#34;22.07895&#34;</span>, <span style="color:#e6db74">&#34;22.0820&#34;</span>, <span style="color:#e6db74">&#34;22.08505&#34;</span>, <span style="color:#e6db74">&#34;22.0881&#34;</span>, <span style="color:#e6db74">&#34;22.09115&#34;</span>, <span style="color:#e6db74">&#34;22.0942&#34;</span>, <span style="color:#e6db74">&#34;22.09725&#34;</span>},
</span></span><span style="display:flex;"><span>    {<span style="color:#e6db74">&#34;13.1121&#34;</span>, <span style="color:#e6db74">&#34;13.1274&#34;</span>, <span style="color:#e6db74">&#34;13.1427&#34;</span>, <span style="color:#e6db74">&#34;13.158&#34;</span>, <span style="color:#e6db74">&#34;13.1733&#34;</span>, <span style="color:#e6db74">&#34;13.1886&#34;</span>},
</span></span><span style="display:flex;"><span>    {<span style="color:#e6db74">&#34;158.0031&#34;</span>, <span style="color:#e6db74">&#34;158.0184&#34;</span>, <span style="color:#e6db74">&#34;158.0337&#34;</span>, <span style="color:#e6db74">&#34;158.049&#34;</span>, <span style="color:#e6db74">&#34;158.0643&#34;</span>, <span style="color:#e6db74">&#34;158.0796&#34;</span>, <span style="color:#e6db74">&#34;158.0949&#34;</span>},
</span></span><span style="display:flex;"><span>    {<span style="color:#e6db74">&#34;54.00025&#34;</span>, <span style="color:#e6db74">&#34;54.0033&#34;</span>, <span style="color:#e6db74">&#34;54.00635&#34;</span>, <span style="color:#e6db74">&#34;54.0094&#34;</span>, <span style="color:#e6db74">&#34;54.01245&#34;</span>, <span style="color:#e6db74">&#34;54.0155&#34;</span>, <span style="color:#e6db74">&#34;54.01855&#34;</span>, <span style="color:#e6db74">&#34;54.0216&#34;</span>, <span style="color:#e6db74">&#34;54.02465&#34;</span>, <span style="color:#e6db74">&#34;54.0277&#34;</span>, <span style="color:#e6db74">&#34;54.03075&#34;</span>, <span style="color:#e6db74">&#34;54.0338&#34;</span>, <span style="color:#e6db74">&#34;54.03685&#34;</span>, <span style="color:#e6db74">&#34;54.0399&#34;</span>, <span style="color:#e6db74">&#34;54.04295&#34;</span>, <span style="color:#e6db74">&#34;54.0460&#34;</span>, <span style="color:#e6db74">&#34;54.04905&#34;</span>, <span style="color:#e6db74">&#34;54.0521&#34;</span>, <span style="color:#e6db74">&#34;54.05515&#34;</span>, <span style="color:#e6db74">&#34;54.0582&#34;</span>, <span style="color:#e6db74">&#34;54.06125&#34;</span>, <span style="color:#e6db74">&#34;54.0643&#34;</span>, <span style="color:#e6db74">&#34;54.06735&#34;</span>, <span style="color:#e6db74">&#34;54.0704&#34;</span>, <span style="color:#e6db74">&#34;54.07345&#34;</span>, <span style="color:#e6db74">&#34;54.0765&#34;</span>, <span style="color:#e6db74">&#34;54.07955&#34;</span>, <span style="color:#e6db74">&#34;54.0826&#34;</span>, <span style="color:#e6db74">&#34;54.08565&#34;</span>, <span style="color:#e6db74">&#34;54.0887&#34;</span>, <span style="color:#e6db74">&#34;54.09175&#34;</span>, <span style="color:#e6db74">&#34;54.0948&#34;</span>, <span style="color:#e6db74">&#34;54.09785&#34;</span>},
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> size[<span style="color:#ae81ff">8</span>] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">33</span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>string <span style="color:#a6e22e">MD5</span>(<span style="color:#66d9ef">const</span> string<span style="color:#f92672">&amp;</span> src )
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    MD5_CTX ctx;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    string md5_string;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> md[<span style="color:#ae81ff">16</span>] <span style="color:#f92672">=</span> { <span style="color:#ae81ff">0</span> };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> tmp[<span style="color:#ae81ff">33</span>] <span style="color:#f92672">=</span> { <span style="color:#ae81ff">0</span> };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    MD5_Init( <span style="color:#f92672">&amp;</span>ctx );
</span></span><span style="display:flex;"><span>    MD5_Update( <span style="color:#f92672">&amp;</span>ctx, src.c_str(), src.size() );
</span></span><span style="display:flex;"><span>    MD5_Final( md, <span style="color:#f92672">&amp;</span>ctx );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">16</span>; <span style="color:#f92672">++</span>i )
</span></span><span style="display:flex;"><span>    {   
</span></span><span style="display:flex;"><span>        memset( tmp, <span style="color:#ae81ff">0x00</span>, <span style="color:#66d9ef">sizeof</span>( tmp ) );
</span></span><span style="display:flex;"><span>        sprintf( tmp, <span style="color:#e6db74">&#34;%02X&#34;</span>, md[i] );
</span></span><span style="display:flex;"><span>        md5_string <span style="color:#f92672">+=</span> tmp;
</span></span><span style="display:flex;"><span>    }   
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> md5_string;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(){
</span></span><span style="display:flex;"><span>    cout <span style="color:#f92672">&lt;&lt;</span> MD5(<span style="color:#e6db74">&#34;62.10105,25.0002,52.8016,406.6128,22.0027,13.1121,158.0031,54.00025,&#34;</span>) <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> cur[<span style="color:#ae81ff">8</span>] <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>    time_t start <span style="color:#f92672">=</span> clock();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">long</span> <span style="color:#66d9ef">long</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2028571776</span>; <span style="color:#f92672">++</span>i){
</span></span><span style="display:flex;"><span>        string in <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">8</span>; <span style="color:#f92672">++</span>j){
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (cur[j] <span style="color:#f92672">&gt;=</span> size[j]){
</span></span><span style="display:flex;"><span>                cur[j] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">++</span>cur[j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            in <span style="color:#f92672">+=</span> combine[j][cur[j]];
</span></span><span style="display:flex;"><span>            in <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;,&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        string out <span style="color:#f92672">=</span> MD5(in);
</span></span><span style="display:flex;"><span>        cur[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// cout &lt;&lt; in &lt;&lt; endl;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (out[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;F&#39;</span> <span style="color:#f92672">&amp;&amp;</span> out[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#f92672">&amp;&amp;</span> out[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;B&#39;</span> <span style="color:#f92672">&amp;&amp;</span> out[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;2&#39;</span> <span style="color:#f92672">&amp;&amp;</span> out[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;7&#39;</span> <span style="color:#f92672">&amp;&amp;</span> out[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;8&#39;</span> <span style="color:#f92672">&amp;&amp;</span> out[<span style="color:#ae81ff">6</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;C&#39;</span> <span style="color:#f92672">&amp;&amp;</span> out[<span style="color:#ae81ff">7</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;C&#39;</span> <span style="color:#f92672">&amp;&amp;</span> out[<span style="color:#ae81ff">8</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;B&#39;</span> <span style="color:#f92672">&amp;&amp;</span> out[<span style="color:#ae81ff">9</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;9&#39;</span>){
</span></span><span style="display:flex;"><span>            cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;in:&#34;</span> <span style="color:#f92672">&lt;&lt;</span> in <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>            cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;out:&#34;</span> <span style="color:#f92672">&lt;&lt;</span> out <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">%</span> <span style="color:#ae81ff">5000000</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">100.0</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">/</span> <span style="color:#ae81ff">2028571776</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;%&#34;</span> <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    time_t end <span style="color:#f92672">=</span> clock();
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;time=%fs</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, (<span style="color:#66d9ef">double</span>)(end <span style="color:#f92672">-</span> start)<span style="color:#f92672">/</span>CLOCKS_PER_SEC);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>md5是直接上网抄的，来源：https://blog.csdn.net/u012063703/article/details/49178349</p>
<p>最后的结果</p>
<pre tabindex="0"><code>...
60.8803%
in:62.1834,25.0002,52.84735,406.6893,22.01795,13.1886,158.0031,54.06125,
out:F0B278CCB982F6132DD6A834C4827D0D
61.1268%
...
time=2639.569345s
</code></pre><p>爆破出答案大概花了 $60% \times 2640=26.4\min$</p>
<h3 id="结论">结论</h3>
<p>这题难度不在于逆向，前期的基本分析以及后面需要打数据动调这些和逆向有关的操作，比赛的时候其实都想到了，但问题在于不知道还有 Modbus Slave 这种东西</p>
<p>所以全程都很迷茫，完全不知道该怎么做，官方的提示早上才放出来，那会都收工准备补觉了（一个小时的时间，找数据范围+写脚本+爆破，根本来不及好吧）</p>
<p>以及过程中的调数据就是无限二分，累的一批，这题说是 Misc 我都信</p>
<p>最后的爆破数据量也太大了，参考的博客用go跑了两小时，我这边用c++跑了半个小时，不过队友用c的多线程只跑了半分钟，看截图只爆破了 $2%$ 就出结果了，应该是划分的位置正好在答案边上，有时间学习一下多线程</p>
<p>综上：屑题</p>
<h2 id="gift">gift</h2>
<p>新版本的GO对magic number以及一些结构上都做了修改，所以老版本的符号表修复脚本就不能用了，好在免费的ida7.6正好支持GO的符号表恢复，可以直接做了。</p>
<p>主函数主要部分如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>  main_CISCN6666666();
</span></span><span style="display:flex;"><span>  main_CISCN66666666();
</span></span><span style="display:flex;"><span>  main_CISCN6666666666();
</span></span><span style="display:flex;"><span>  max_len_v2 <span style="color:#f92672">=</span> qword_928238; <span style="color:#75715e">// 0x20
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  index_v3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0LL</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> ( (<span style="color:#66d9ef">__int64</span>)index_v3 <span style="color:#f92672">&lt;</span> max_len_v2 )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    qword_9720E8 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0LL</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( qword_928238 <span style="color:#f92672">&lt;=</span> index_v3 )
</span></span><span style="display:flex;"><span>      runtime_panicIndex();
</span></span><span style="display:flex;"><span>    v14 <span style="color:#f92672">=</span> off_928230[index_v3];
</span></span><span style="display:flex;"><span>    runtime_makeslice((<span style="color:#66d9ef">__int64</span>)<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\b</span><span style="color:#e6db74">&#34;</span>, v14, v14, v10);
</span></span><span style="display:flex;"><span>    v5 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">__int64</span> <span style="color:#f92672">*</span>)v11;
</span></span><span style="display:flex;"><span>    v19 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">__int64</span> <span style="color:#f92672">*</span>)v11;
</span></span><span style="display:flex;"><span>    v4 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1LL</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> ( v4 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">4</span> )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      v12 <span style="color:#f92672">=</span> v4;
</span></span><span style="display:flex;"><span>      main_wtf(<span style="color:#ae81ff">0LL</span>, v4, v5, v14, v14);
</span></span><span style="display:flex;"><span>      v4 <span style="color:#f92672">=</span> v12 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>      v5 <span style="color:#f92672">=</span> v19;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span>)qword_9720E8 <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0x11</span> )
</span></span><span style="display:flex;"><span>      runtime_panicIndex();
</span></span><span style="display:flex;"><span>    v6 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>((_BYTE <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v16 <span style="color:#f92672">+</span> qword_9720E8);
</span></span><span style="display:flex;"><span>    v22[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>unk_8765E0;                       <span style="color:#75715e">// output_length
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    v22[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>qword_9239C0[v6 <span style="color:#f92672">^</span> <span style="color:#ae81ff">0x66u</span>];         <span style="color:#75715e">// output
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    v8 <span style="color:#f92672">=</span> qword_92EAB0;
</span></span><span style="display:flex;"><span>    v10 <span style="color:#f92672">=</span> <span style="color:#ae81ff">2LL</span>;
</span></span><span style="display:flex;"><span>    v1 <span style="color:#f92672">=</span> v22;
</span></span><span style="display:flex;"><span>    fmt_Fprintf(v0, (<span style="color:#66d9ef">__int64</span>)v22, (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)qword_9239C0);
</span></span><span style="display:flex;"><span>    index_v3 <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>开头的三个CISCN函数是简单的输出，中间生成空的slice然后扔到了wtf函数中，输出是根据索引，从<code>qword_9239C0</code>中选择一个字符。</p>
<p>尝试运行的时候发现运行时间很长，但在程序中没有看到延时的操作，那么这道题应该是一个耗时的算法。</p>
<p>观察发现 <code>wtf</code> 函数是一个递归函数，而 <code>off_928230</code> 中存的就是递归的深度。</p>
<p>尝试找规律，直接将深度patch成 <code>1</code> 到 <code>0x20</code>，运行一下。</p>
<p>得到如下结果</p>
<pre tabindex="0"><code>Welcome to CISCN 2021!
Here is our free flag for you as a gift:
CISCN{45b3247c45b3247c4
</code></pre><p>猜测最后的输出是有规律的</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>cur_time <span style="color:#f92672">=</span> [ 
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">0x0A</span>, <span style="color:#ae81ff">0x0B</span>, <span style="color:#ae81ff">0x0C</span>, <span style="color:#ae81ff">0x0D</span>, <span style="color:#ae81ff">0x0E</span>, <span style="color:#ae81ff">0x0F</span>, <span style="color:#ae81ff">0x10</span>, <span style="color:#ae81ff">0x11</span>, <span style="color:#ae81ff">0x12</span>, <span style="color:#ae81ff">0x14</span>, <span style="color:#ae81ff">0x19</span>, <span style="color:#ae81ff">0x1E</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0x28</span>, <span style="color:#ae81ff">0x42</span>, <span style="color:#ae81ff">0x66</span>, <span style="color:#ae81ff">0x0A0</span>, <span style="color:#ae81ff">0x936</span>, <span style="color:#ae81ff">0x3D21</span>, <span style="color:#ae81ff">0x149A7</span>, <span style="color:#ae81ff">0x243AC</span>, <span style="color:#ae81ff">0x0CB5BE</span>, <span style="color:#ae81ff">0x47DC61</span>, <span style="color:#ae81ff">0x16C0F46</span>, 
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0x262C432</span>, <span style="color:#ae81ff">0x4ACE299</span>, <span style="color:#ae81ff">0x10FBC92A</span>, <span style="color:#ae81ff">0x329ECDFD</span>, <span style="color:#ae81ff">0x370D7470</span>
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>res <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#e6db74">&#39;4&#39;</span>, <span style="color:#e6db74">&#39;5&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;3&#39;</span>, <span style="color:#e6db74">&#39;2&#39;</span>, <span style="color:#e6db74">&#39;4&#39;</span>, <span style="color:#e6db74">&#39;7&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print (<span style="color:#e6db74">&#39;CISCN{&#39;</span>, end <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> cur_time:
</span></span><span style="display:flex;"><span>    print (res[c <span style="color:#f92672">%</span> len(res)], end <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>print (<span style="color:#e6db74">&#39;}&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print (<span style="color:#e6db74">&#39;CISCN</span><span style="color:#e6db74">{4b445b3247c45344c54c44734445452c}</span><span style="color:#e6db74">&#39;</span>)
</span></span></code></pre></div><p>和最后的正确结果做个对比，发现一样。</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/ctf/">CTF</a>
        
            <a href="/tags/reverse/">Reverse</a>
        
            <a href="/tags/ciscn/">CISCN</a>
        
    </section>


    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css"integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8"crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"integrity="sha384-vZTG03m&#43;2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"crossorigin="anonymous"
                defer="true"
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">Related contents</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="">
    <a href="/post/jinmen-cup-goodre-writeup/">
        
        

        <div class="article-details">
            <h2 class="article-title">津门杯 GoodRE writeup</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/post/buuoj-flareon-challenge/">
        
        

        <div class="article-details">
            <h2 class="article-title">BUUOJ FlareOn Challenge</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/post/gwctf2019-re3-writeup/">
        
        

        <div class="article-details">
            <h2 class="article-title">GWCTF2019 re3 writeup</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/post/gxzy-re-writeups/">
        
        

        <div class="article-details">
            <h2 class="article-title">高校战役 re writeups</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/post/vnctf2021-filpgame-and-notsudoku/">
        
        

        <div class="article-details">
            <h2 class="article-title">VNCTF2021 FilpGame and notsudoku</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy;
        
        2023 s0uthwood&#39;s Blog
    
        
            <br />
            已运行 <i class="fas fa-bell"></i> <a id="days">0</a> 天
        
    
        
            &nbsp;&nbsp;
            
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
            
            ⌨&nbsp;
            86.35k&nbsp;
            字
            &nbsp;&nbsp;
            🧠&nbsp;
            38&nbsp;
            篇文章
        
    </section>

    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.5.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>

    
        <script>
            var s1 = "2020-11-15";
            s1 = new Date(s1.replace(/-/g, "/"));
            s2 = new Date();
            var days = s2.getTime() - s1.getTime();
            var number_of_days = parseInt(days / (1000 * 60 * 60 * 24));
            document.getElementById('days').innerHTML = number_of_days;
        </script>
    
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">Table of contents</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#glass">glass</a></li>
    <li><a href="#baby_bc">baby_bc</a></li>
    <li><a href="#little_evil">little_evil</a>
      <ul>
        <li><a href="#基本分析">基本分析</a></li>
        <li><a href="#利用输出去混淆">利用输出去混淆</a></li>
        <li><a href="#brainfuck-代码阅读">Brainfuck 代码阅读</a></li>
        <li><a href="#总结">总结</a></li>
      </ul>
    </li>
    <li><a href="#hmi">HMI</a>
      <ul>
        <li><a href="#逆向分析">逆向分析</a></li>
        <li><a href="#modbus-slave调试">Modbus Slave调试</a></li>
        <li><a href="#爆破">爆破</a></li>
        <li><a href="#结论">结论</a></li>
      </ul>
    </li>
    <li><a href="#gift">gift</a></li>
  </ul>
</nav>
                </div>
            </section>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
