<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='NepCTF2021 reverse 前四题，不过比赛哪儿有吃瓜好玩，属于是315打假晚会了'><title>NepCTF2021 re writeups</title>

<link rel='canonical' href='/post/nepctf2021-re-writeups/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='NepCTF2021 re writeups'>
<meta property='og:description' content='NepCTF2021 reverse 前四题，不过比赛哪儿有吃瓜好玩，属于是315打假晚会了'>
<meta property='og:url' content='/post/nepctf2021-re-writeups/'>
<meta property='og:site_name' content='s0uthwood&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='CTF' /><meta property='article:tag' content='Reverse' /><meta property='article:published_time' content='2021-03-22T18:30:03&#43;00:00'/><meta property='article:modified_time' content='2021-03-22T18:30:03&#43;00:00'/>
<meta name="twitter:title" content="NepCTF2021 re writeups">
<meta name="twitter:description" content="NepCTF2021 reverse 前四题，不过比赛哪儿有吃瓜好玩，属于是315打假晚会了">
    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="/" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>Back</span>
            </a>
        </div>
    
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/ctf/" >
                CTF
            </a>
        
            <a href="/categories/reverse/" >
                Reverse
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/post/nepctf2021-re-writeups/">NepCTF2021 re writeups</a>
    </h2>

    
    <h3 class="article-subtitle">
        NepCTF2021 reverse 前四题，不过比赛哪儿有吃瓜好玩，属于是315打假晚会了
    </h3>
    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Mar 22, 2021</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-pencil" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#9e9e9e" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <path d="M4 20h4L18.5 9.5a1.5 1.5.0 00-4-4L4 16v4"></path>
    <line x1="13.5" y1="6.5" x2="17.5" y2="10.5"></line>
</svg>
                <time class="article-words">
                    2512 words
                </time>
            </div>
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    12 minute read
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <h2 id="hardsharp-net-逆向">hardsharp (.NET 逆向)</h2>
<p>使用exeinfo发现是 C# .NET文件</p>
<p>直接用 dnSpy 打开</p>
<p>找到主函数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> Main(<span style="color:#66d9ef">string</span>[] args)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	AesClass aesClass = <span style="color:#66d9ef">new</span> AesClass();
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">string</span> text = <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">string</span> strB = <span style="color:#e6db74">&#34;1Umgm5LG6lNPyRCd0LktJhJtyBN7ivpq+EKGmTAcXUM+0ikYZL4h4QTHGqH/3Wh0&#34;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">byte</span>[] array = <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span>[]
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">81</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">82</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">87</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">81</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">82</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">87</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">68</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">92</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">94</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">86</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">93</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">18</span>
</span></span><span style="display:flex;"><span>	};
</span></span><span style="display:flex;"><span>	Console.WriteLine(<span style="color:#e6db74">&#34;Welcome to nepnep csharp test! plz input the magical code:&#34;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">string</span> text2 = Console.ReadLine();
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (text2.Length != <span style="color:#ae81ff">37</span>)
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		Console.WriteLine(<span style="color:#e6db74">&#34;Nope!&#34;</span>);
</span></span><span style="display:flex;"><span>		Console.ReadKey();
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (text2.Substring(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">4</span>) != <span style="color:#e6db74">&#34;Nep{&#34;</span> || text2[<span style="color:#ae81ff">36</span>] != <span style="color:#e6db74">&#39;}&#39;</span>)
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		Console.WriteLine(<span style="color:#e6db74">&#34;Nope!&#34;</span>);
</span></span><span style="display:flex;"><span>		Console.ReadKey();
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i = <span style="color:#ae81ff">0</span>; i &lt; <span style="color:#ae81ff">32</span>; i++)
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		text += Convert.ToChar((<span style="color:#66d9ef">int</span>)(array[i] ^ <span style="color:#ae81ff">51</span>)).ToString();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">string</span>.Compare(aesClass.AesEncrypt(text2, text), strB) == <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		Console.WriteLine(<span style="color:#e6db74">&#34;wow, you pass it!&#34;</span>);
</span></span><span style="display:flex;"><span>		Console.ReadKey();
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	Console.WriteLine(<span style="color:#e6db74">&#34;Nope!&#34;</span>);
</span></span><span style="display:flex;"><span>	Console.ReadKey();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这才是真正的签到题吧&hellip;</p>
<p>发现是 AES 加密</p>
<p>进入 AesEncrypt 函数看一眼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> AesEncrypt(<span style="color:#66d9ef">string</span> str, <span style="color:#66d9ef">string</span> key)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">string</span>.IsNullOrEmpty(str))
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">byte</span>[] bytes = Encoding.UTF8.GetBytes(str);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">byte</span>[] array = <span style="color:#66d9ef">new</span> RijndaelManaged
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		Key = Encoding.UTF8.GetBytes(key),
</span></span><span style="display:flex;"><span>		Mode = CipherMode.ECB,
</span></span><span style="display:flex;"><span>		Padding = PaddingMode.PKCS7
</span></span><span style="display:flex;"><span>	}.CreateEncryptor().TransformFinalBlock(bytes, <span style="color:#ae81ff">0</span>, bytes.Length);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> Convert.ToBase64String(array, <span style="color:#ae81ff">0</span>, array.Length);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>发现使用了 ECB 模式，那么直接上网找个 python 脚本计算就行</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>array <span style="color:#f92672">=</span> [<span style="color:#ae81ff">81</span>, <span style="color:#ae81ff">82</span>, <span style="color:#ae81ff">87</span>, <span style="color:#ae81ff">81</span>, <span style="color:#ae81ff">82</span>, <span style="color:#ae81ff">87</span>, <span style="color:#ae81ff">68</span>, <span style="color:#ae81ff">92</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">86</span>, <span style="color:#ae81ff">93</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">18</span>]
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> array:
</span></span><span style="display:flex;"><span>    key <span style="color:#f92672">+=</span> chr(i <span style="color:#f92672">^</span> <span style="color:#ae81ff">51</span>)
</span></span><span style="display:flex;"><span>print (<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;key: </span><span style="color:#e6db74">{</span>key<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>print (<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;key length: </span><span style="color:#e6db74">{</span>len(key)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Cipher <span style="color:#f92672">import</span> AES
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;1Umgm5LG6lNPyRCd0LktJhJtyBN7ivpq+EKGmTAcXUM+0ikYZL4h4QTHGqH/3Wh0&#39;</span>
</span></span><span style="display:flex;"><span>encrypt_data <span style="color:#f92672">=</span> message
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cipher <span style="color:#f92672">=</span> AES<span style="color:#f92672">.</span>new(key)
</span></span><span style="display:flex;"><span>result2 <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64decode(encrypt_data)
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> cipher<span style="color:#f92672">.</span>decrypt(result2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> a<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>,<span style="color:#e6db74">&#39;ignore&#39;</span>)
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> a<span style="color:#f92672">.</span>rstrip(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> a<span style="color:#f92672">.</span>rstrip(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> a<span style="color:#f92672">.</span>rstrip(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\r</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> a<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x06</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74">&#39;data:&#39;</span>,a)
</span></span></code></pre></div><p>得到结果：</p>
<pre tabindex="0"><code>key: badbadwomen!!!!!!!!!!!!!!!!!!!!!
key length: 32

 data: Nep{up_up_down_down_B_a_b_A_Nep_nep~}
</code></pre><h2 id="二十六进制-c--c-逆向">二十六进制 （c / c++ 逆向）</h2>
<p>先用exeinfo打开，发现是无壳32位c++代码。</p>
<p>用ida打开，找到有用的字符串，定位关键代码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> __noreturn <span style="color:#a6e22e">sub_4010A0</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">__int64</span> v0; <span style="color:#75715e">// rax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">char</span> Dst; <span style="color:#75715e">// [esp+0h] [ebp-108h]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  memset(<span style="color:#f92672">&amp;</span>Dst, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0xFFu</span>);
</span></span><span style="display:flex;"><span>  dword_403378 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">int</span>)malloc(<span style="color:#ae81ff">8u</span>);
</span></span><span style="display:flex;"><span>  Memory <span style="color:#f92672">=</span> (<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>)dword_403378;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span>(_DWORD <span style="color:#f92672">*</span>)(dword_403378 <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  sub_401020(<span style="color:#e6db74">&#34;plz input right num:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, Dst);
</span></span><span style="display:flex;"><span>  sub_401060(<span style="color:#e6db74">&#34;%s&#34;</span>, <span style="color:#f92672">&amp;</span>Dst, <span style="color:#ae81ff">32</span>);
</span></span><span style="display:flex;"><span>  v0 <span style="color:#f92672">=</span> atoi64(<span style="color:#f92672">&amp;</span>Dst);
</span></span><span style="display:flex;"><span>  sub_401120(v0);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>输入一个数字，将其传入 <code>sub_401120</code> 函数。</p>
<p>进入这个函数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#66d9ef">__cdecl</span> __noreturn <span style="color:#a6e22e">sub_401120</span>(<span style="color:#66d9ef">__int64</span> a1)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">signed</span> <span style="color:#66d9ef">__int64</span> v1; <span style="color:#75715e">// rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v2; <span style="color:#75715e">// eax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v3; <span style="color:#75715e">// edx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">char</span> v4; <span style="color:#75715e">// cl
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  v1 <span style="color:#f92672">=</span> __PAIR__(a1, HIDWORD(a1));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( a1 )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      v2 <span style="color:#f92672">=</span> sub_401F00(__PAIR__(v1, HIDWORD(v1)), <span style="color:#ae81ff">0x1Au</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      LODWORD(v1) <span style="color:#f92672">=</span> v3;
</span></span><span style="display:flex;"><span>      v4 <span style="color:#f92672">=</span> byte_402194[HIDWORD(v1) <span style="color:#f92672">-</span> <span style="color:#ae81ff">26</span> <span style="color:#f92672">*</span> v2];  <span style="color:#75715e">// 2163qwe)(*&amp;^%489$!057@#&gt;&lt;A
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      HIDWORD(v1) <span style="color:#f92672">=</span> v2;
</span></span><span style="display:flex;"><span>      sub_401160(v4 <span style="color:#f92672">^</span> <span style="color:#ae81ff">7</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> ( v1 );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  sub_401190();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>根据题目信息的提示，这是把输入数字转换成为26进制，随后进行一个异或运算，然后存到一个地址里。</p>
<p>进入 <code>sub_401190</code> 函数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> __noreturn <span style="color:#a6e22e">sub_401190</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  _DWORD <span style="color:#f92672">*</span>v0; <span style="color:#75715e">// esi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v1; <span style="color:#75715e">// ecx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  _DWORD <span style="color:#f92672">*</span>v2; <span style="color:#75715e">// ebx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> v3; <span style="color:#75715e">// edi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> v4; <span style="color:#75715e">// esi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>v5; <span style="color:#75715e">// ecx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">char</span> v6; <span style="color:#75715e">// dl
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v7; <span style="color:#75715e">// eax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v8; <span style="color:#75715e">// edi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>v9; <span style="color:#75715e">// eax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v10; <span style="color:#75715e">// [esp+10h] [ebp-4h]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  v0 <span style="color:#f92672">=</span> Memory;
</span></span><span style="display:flex;"><span>  v1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  v10 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  v2 <span style="color:#f92672">=</span> Memory;
</span></span><span style="display:flex;"><span>  v3 <span style="color:#f92672">=</span> strlen(aFb726);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( v3 )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    v4 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span>v2 )
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>      v5 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>aFb726[v4];
</span></span><span style="display:flex;"><span>      v6 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>(_BYTE <span style="color:#f92672">*</span>)v2;
</span></span><span style="display:flex;"><span>      v7 <span style="color:#f92672">=</span> v10 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>      v2 <span style="color:#f92672">=</span> (_DWORD <span style="color:#f92672">*</span>)v2[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">++</span>v4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( v6 <span style="color:#f92672">!=</span> <span style="color:#f92672">*</span>v5 )
</span></span><span style="display:flex;"><span>        v7 <span style="color:#f92672">=</span> v10;
</span></span><span style="display:flex;"><span>      v1 <span style="color:#f92672">=</span> v7;
</span></span><span style="display:flex;"><span>      v10 <span style="color:#f92672">=</span> v7; <span style="color:#75715e">// 判断某内存种对应位置是否与 aFb726 字符串相同，相同就在长度上加 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> ( v4 <span style="color:#f92672">&lt;</span> v3 );
</span></span><span style="display:flex;"><span>    v0 <span style="color:#f92672">=</span> Memory;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( v0 ) 
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    v8 <span style="color:#f92672">=</span> v1;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      v9 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>)v0[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>      dword_403378 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">int</span>)v0;
</span></span><span style="display:flex;"><span>      Memory <span style="color:#f92672">=</span> v9;
</span></span><span style="display:flex;"><span>      free(v0);
</span></span><span style="display:flex;"><span>      v0 <span style="color:#f92672">=</span> Memory;
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">--</span>v8;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> ( Memory ); <span style="color:#75715e">// 释放内存
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    v8 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( v10 <span style="color:#f92672">!=</span> strlen(aFb726) ) <span style="color:#75715e">// 根据之间计算的相同字母数量，判断两个字符串是否相同
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  {
</span></span><span style="display:flex;"><span>    puts(<span style="color:#e6db74">&#34;flag is Error!!!&#34;</span>);
</span></span><span style="display:flex;"><span>    exit(v8);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  puts(<span style="color:#e6db74">&#34;flag is Right!!!, please md5(&#39;Nep{you_input_num}&#39;) submit th4 flag&#34;</span>);
</span></span><span style="display:flex;"><span>  system(<span style="color:#e6db74">&#34;pause&#34;</span>);
</span></span><span style="display:flex;"><span>  exit(v8);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>所以只需要将 aFb726 字符串进行反向计算即可</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Fb72&gt;&amp;6&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;2163qwe)(*&amp;^%489$!057@#&gt;&lt;A&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> num <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> flag:
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>     num<span style="color:#f92672">.</span>append(str<span style="color:#f92672">.</span>index(chr(ord(c) <span style="color:#f92672">^</span> <span style="color:#ae81ff">7</span>)))
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> num
</span></span><span style="display:flex;"><span>[<span style="color:#ae81ff">25</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">19</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> sum <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> num[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]:
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>     sum <span style="color:#f92672">*=</span> <span style="color:#ae81ff">26</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>     sum <span style="color:#f92672">+=</span> i
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> sum
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">518100101</span>
</span></span></code></pre></div><p>运行程序进行测试，得到</p>
<pre tabindex="0"><code>plz input right num:
518100101
flag is Right!!!, please md5(&#39;Nep{you_input_num}&#39;) submit th4 flag
请按任意键继续. . .
</code></pre><p>根据题目信息，计算一下数字的32位小写md5（一开始算的是 Nep{51&hellip;01} 这个字符串的md5，发现不对，所以算数字的试了一下）</p>
<p>得到flag</p>
<pre tabindex="0"><code>Nep{967fa25cbea166ded43127f141cff31a}
</code></pre><h2 id="password-安卓逆向">password （安卓逆向）</h2>
<p>这道题做了好久都没做出来，结果发现是把base64的 &lsquo;+/&rsquo; 记反了&hellip;</p>
<hr>
<p>首先用 <code>jeb</code> 打开，找到 <code>com.nepnep.app</code> 中的 <code>MainActivity</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MainActivity</span> <span style="color:#66d9ef">extends</span> AppCompatActivity <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Encrypt en<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">loadLibrary</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;native-lib&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">MainActivity</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">en</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Encrypt<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onCreate</span><span style="color:#f92672">(</span>Bundle arg4<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">onCreate</span><span style="color:#f92672">(</span>arg4<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setContentView</span><span style="color:#f92672">(</span>0x7F0B001C<span style="color:#f92672">);</span>  <span style="color:#75715e">// activity_main
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">findViewById</span><span style="color:#f92672">(</span>0x7F080057<span style="color:#f92672">).</span><span style="color:#a6e22e">setOnClickListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> View$OnClickListener<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">findViewById</span><span style="color:#f92672">(</span>0x7F0800B7<span style="color:#f92672">),</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">findViewById</span><span style="color:#f92672">(</span>0x7F0800F2<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>  <span style="color:#75715e">// btn, key, password
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onClick</span><span style="color:#f92672">(</span>View arg4<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>MainActivity<span style="color:#f92672">.</span><span style="color:#a6e22e">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">verify</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">val$key</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">())</span> <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">val$key</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>                    Toast<span style="color:#f92672">.</span><span style="color:#a6e22e">makeText</span><span style="color:#f92672">(</span>MainActivity<span style="color:#f92672">.</span><span style="color:#a6e22e">this</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;key错误！&#34;</span><span style="color:#f92672">,</span> 0<span style="color:#f92672">).</span><span style="color:#a6e22e">show</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>MainActivity<span style="color:#f92672">.</span><span style="color:#a6e22e">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">en</span><span style="color:#f92672">.</span><span style="color:#a6e22e">file</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">val$passwd</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">(),</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">val$key</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">()))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    Toast<span style="color:#f92672">.</span><span style="color:#a6e22e">makeText</span><span style="color:#f92672">(</span>MainActivity<span style="color:#f92672">.</span><span style="color:#a6e22e">this</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;明文正确，快去解压缩包获取flag吧！&#34;</span><span style="color:#f92672">,</span> 0<span style="color:#f92672">).</span><span style="color:#a6e22e">show</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    Toast<span style="color:#f92672">.</span><span style="color:#a6e22e">makeText</span><span style="color:#f92672">(</span>MainActivity<span style="color:#f92672">.</span><span style="color:#a6e22e">this</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;明文错误！&#34;</span><span style="color:#f92672">,</span> 0<span style="color:#f92672">).</span><span style="color:#a6e22e">show</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">});</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">native</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">verify</span><span style="color:#f92672">(</span>String arg1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>这段代码是读入 <code>key</code> 和 <code>password</code>，然后先判断 <code>key</code> 是否正确，如果正确的话判断 <code>password</code> 是否正确</p>
<p>那么肯定先破解 <code>key</code>，发现 <code>verify</code> 是外部函数</p>
<p>找到 <code>native-lib.so</code> 文件，拖入ida，找到函数名里搜索 <code>java</code> 或 <code>verify</code> 之类的，找到这个判断函数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>  v4 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)(<span style="color:#f92672">*</span>(<span style="color:#66d9ef">__int64</span> (<span style="color:#66d9ef">__fastcall</span> <span style="color:#f92672">**</span>)(<span style="color:#66d9ef">__int64</span>, <span style="color:#66d9ef">__int64</span>, _QWORD))(<span style="color:#f92672">*</span>(_QWORD <span style="color:#f92672">*</span>)a1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1352LL</span>))(a1, a3, <span style="color:#ae81ff">0LL</span>);
</span></span><span style="display:flex;"><span>  v5 <span style="color:#f92672">=</span> (<span style="color:#f92672">*</span>(<span style="color:#66d9ef">__int64</span> (<span style="color:#66d9ef">__fastcall</span> <span style="color:#f92672">**</span>)(<span style="color:#66d9ef">__int64</span>, <span style="color:#66d9ef">__int64</span>))(<span style="color:#f92672">*</span>(_QWORD <span style="color:#f92672">*</span>)a1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1344LL</span>))(a1, v3);
</span></span><span style="display:flex;"><span>  memset(<span style="color:#f92672">&amp;</span>s, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0x3E8uLL</span>);
</span></span><span style="display:flex;"><span>  sub_710(v4, (<span style="color:#66d9ef">__int64</span>)<span style="color:#f92672">&amp;</span>s, v5 <span style="color:#f92672">-</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> (((<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span>)(<span style="color:#960050;background-color:#1e0010">&#39;</span>UUUV<span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#f92672">*</span> v5) <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">63</span>) <span style="color:#f92672">+</span> ((<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span>)(<span style="color:#960050;background-color:#1e0010">&#39;</span>UUUV<span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#f92672">*</span> v5) <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">32</span>)));
</span></span><span style="display:flex;"><span>  sub_820(<span style="color:#f92672">&amp;</span>s, (<span style="color:#66d9ef">__int64</span>)<span style="color:#f92672">&amp;</span>v22);                   <span style="color:#75715e">// s=&#39;th1s_1s_k3ya!!!!&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> ( v5 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">goto</span> LABEL_10;
</span></span><span style="display:flex;"><span>  v6 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> ( <span style="color:#ae81ff">1</span> )                                   <span style="color:#75715e">// base64
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  {
</span></span><span style="display:flex;"><span>    v11 <span style="color:#f92672">=</span> v6;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( v5 <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">3</span> )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">*</span>((_BYTE <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v15 <span style="color:#f92672">+</span> v6) <span style="color:#f92672">=</span> aAbcdefghijklmn[<span style="color:#f92672">*</span>((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v22 <span style="color:#f92672">+</span> v6)];<span style="color:#75715e">// abcdefghijklmnopqrstuvwxyz0123456789+/ABCDEFGHIJKLMNOPQRSTUVWXYZ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#f92672">*</span>((_BYTE <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v15 <span style="color:#f92672">+</span> v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span> aAbcdefghijklmn[<span style="color:#f92672">*</span>((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v22 <span style="color:#f92672">+</span> v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)];
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">*</span>((_BYTE <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v15 <span style="color:#f92672">+</span> v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">=</span> aAbcdefghijklmn[<span style="color:#f92672">*</span>((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v22 <span style="color:#f92672">+</span> v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>)];
</span></span><span style="display:flex;"><span>      v7 <span style="color:#f92672">=</span> aAbcdefghijklmn[<span style="color:#f92672">*</span>((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v22 <span style="color:#f92672">+</span> v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">3</span>)];
</span></span><span style="display:flex;"><span>      v6 <span style="color:#f92672">+=</span> <span style="color:#ae81ff">4</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">*</span>((_BYTE <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v15 <span style="color:#f92672">+</span> v11 <span style="color:#f92672">+</span> <span style="color:#ae81ff">3</span>) <span style="color:#f92672">=</span> v7;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">goto</span> LABEL_4;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( v5 <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> )
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( v5 <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span> )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">*</span>((_BYTE <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v15 <span style="color:#f92672">+</span> v6) <span style="color:#f92672">=</span> aAbcdefghijklmn[<span style="color:#f92672">*</span>((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v22 <span style="color:#f92672">+</span> v6)];
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">*</span>((_BYTE <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v15 <span style="color:#f92672">+</span> v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span> aAbcdefghijklmn[<span style="color:#f92672">*</span>((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v22 <span style="color:#f92672">+</span> v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)];
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">*</span>((_BYTE <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v15 <span style="color:#f92672">+</span> v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">=</span> aAbcdefghijklmn[<span style="color:#f92672">*</span>((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v22 <span style="color:#f92672">+</span> v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>)];
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">*</span>((_BYTE <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v15 <span style="color:#f92672">+</span> v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">3</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;=&#39;</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">goto</span> LABEL_10;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>LABEL_4:
</span></span><span style="display:flex;"><span>    v10 <span style="color:#f92672">=</span> __OFADD__(<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>, v5);
</span></span><span style="display:flex;"><span>    v8 <span style="color:#f92672">=</span> v5 <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>    v9 <span style="color:#f92672">=</span> v5 <span style="color:#f92672">-</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    v5 <span style="color:#f92672">-=</span> <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)(v9 <span style="color:#f92672">^</span> v10) <span style="color:#f92672">|</span> v8 )
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">goto</span> LABEL_10;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span>((_BYTE <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v15 <span style="color:#f92672">+</span> v6) <span style="color:#f92672">=</span> aAbcdefghijklmn[<span style="color:#f92672">*</span>((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v22 <span style="color:#f92672">+</span> v6)];
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span>((_BYTE <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v15 <span style="color:#f92672">+</span> v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span> aAbcdefghijklmn[<span style="color:#f92672">*</span>((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v22 <span style="color:#f92672">+</span> v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)];
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span>(_WORD <span style="color:#f92672">*</span>)((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v15 <span style="color:#f92672">+</span> v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">==</span><span style="color:#960050;background-color:#1e0010">&#39;</span>;
</span></span><span style="display:flex;"><span>LABEL_10:
</span></span><span style="display:flex;"><span>  (<span style="color:#f92672">*</span>(<span style="color:#66d9ef">void</span> (<span style="color:#66d9ef">__fastcall</span> <span style="color:#f92672">**</span>)(<span style="color:#66d9ef">__int64</span>, <span style="color:#66d9ef">__int64</span>, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>))(<span style="color:#f92672">*</span>(_QWORD <span style="color:#f92672">*</span>)a1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1360LL</span>))(a1, v3, v4);
</span></span><span style="display:flex;"><span>  v12 <span style="color:#f92672">=</span> _mm_movemask_epi8(
</span></span><span style="display:flex;"><span>          _mm_and_si128(
</span></span><span style="display:flex;"><span>            _mm_cmpeq_epi8(_mm_load_si128((<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">__m128i</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v15), (<span style="color:#66d9ef">__m128i</span>)xmmword_BE0),
</span></span><span style="display:flex;"><span>            _mm_cmpeq_epi8(_mm_loadu_si128((<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">__m128i</span> <span style="color:#f92672">*</span>)((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v15 <span style="color:#f92672">+</span> <span style="color:#ae81ff">9</span>)), (<span style="color:#66d9ef">__m128i</span>)xmmword_BD0)));<span style="color:#75715e">// 3g6L2PWL2PXFmR+7ise7iq==
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  __android_log_print(<span style="color:#ae81ff">4LL</span>, <span style="color:#e6db74">&#34;nepnep&#34;</span>, <span style="color:#e6db74">&#34;%s&#34;</span>, <span style="color:#f92672">&amp;</span>v15);
</span></span><span style="display:flex;"><span>  result <span style="color:#f92672">=</span> <span style="color:#ae81ff">0LL</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( v12 <span style="color:#f92672">==</span> <span style="color:#ae81ff">0xFFFF</span> )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    __android_log_print(<span style="color:#ae81ff">4LL</span>, <span style="color:#e6db74">&#34;nepnep&#34;</span>, <span style="color:#e6db74">&#34;key is true!&#34;</span>, v13);
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> <span style="color:#ae81ff">1LL</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> result;
</span></span></code></pre></div><p>我们的目的肯定是让 <code>v12 = 0FFFF</code></p>
<p>虽然对于 mm 之类的指令不太清楚，但大概的意思应该还是两个字符串相等的，那么就让 <code>(const __m128i *)&amp;v15), (__m128i)xmmword_BE0)</code> 和 <code>((char *)&amp;v15 + 9)), (__m128i)xmmword_BD0))</code> 两两相等即可</p>
<p>在字符串中找到这两个，就能得到 <code>3g6L2PWL2PXFmR+7ise7iq==</code>，这个看起来是一个 base64，但解出来是乱码，所以还是得往前看。上面一大段从 <code>while</code> 开始的代码，显然就是 base64 的最后一步，点开字符串，发现这个不是标准的 base64。那么根据这个字符串反向求解 base64 就可以了。</p>
<p>实际操作时，继续阅读了 <code>sub_820</code> 和 <code>sub_710</code> 两个函数。只看 <code>sub_820</code> 的话看不太懂，建议先看 <code>sub_710</code>，发现 <code>sub_710</code> 中，将一个字符串的每个字符根据 ascii 数值直接拆开到了八个 char 上，每个 char 存 <code>'0'</code> 或 <code>'1'</code> （ <code>0x30</code> 和 <code>0x31</code> ）。到了 <code>sub_820</code> 函数，则每六个进行合并，每一位运算看起来很奇怪，但如果用 <code>0x30</code> 和 <code>0x31</code> 带入会发现就是很简单的将 0 和1 重新组合起来。就是做了一个 base64 运算。</p>
<p>于是写个代码反向求解就可以了</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> string
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> libnum <span style="color:#f92672">import</span> s2n
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>en_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;7+RmFXP2LWP2L6g3&#39;</span>[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;==qi7esi&#39;</span>[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>true_base <span style="color:#f92672">=</span> string<span style="color:#f92672">.</span>ascii_uppercase <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>ascii_lowercase <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>digits <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;+/&#39;</span>
</span></span><span style="display:flex;"><span>fake_base <span style="color:#f92672">=</span> string<span style="color:#f92672">.</span>ascii_lowercase <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>digits <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;+/&#39;</span> <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>ascii_uppercase
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> en_key:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> c <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;=&#39;</span>:
</span></span><span style="display:flex;"><span>        key <span style="color:#f92672">+=</span> c
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>    key <span style="color:#f92672">+=</span> true_base[fake_base<span style="color:#f92672">.</span>index(c)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64decode(key)
</span></span><span style="display:flex;"><span>print(key)
</span></span></code></pre></div><p>得到 key: <code>th1s_1s_k3y!!!!!</code></p>
<blockquote>
<p>这里我因为打错了base的字符串，卡了整整一天（</p>
</blockquote>
<p>接下来就可以去求明文密码了</p>
<p>继续阅读 java 代码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Encrypt</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Encrypt</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">en1</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> arg6<span style="color:#f92672">,</span> String arg7<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> arg8<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> v0 <span style="color:#f92672">=</span> 0x100<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> v1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span>v0<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> v7 <span style="color:#f92672">=</span> arg7<span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> v2 <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> v3<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>v3 <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> v3 <span style="color:#f92672">&lt;</span> v0<span style="color:#f92672">;</span> <span style="color:#f92672">++</span>v3<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            arg6<span style="color:#f92672">[</span>v3<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> 0x100 <span style="color:#f92672">-</span> v3<span style="color:#f92672">;</span>  <span style="color:#75715e">// 256-1降序
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            v1<span style="color:#f92672">[</span>v3<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> v7<span style="color:#f92672">[</span>v3 <span style="color:#f92672">%</span> arg8<span style="color:#f92672">];</span>  <span style="color:#75715e">// 用密钥填满v1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> v7_1 <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span>v2 <span style="color:#f92672">&lt;</span> v0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            v7_1 <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>arg6<span style="color:#f92672">[</span>v2<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> v7_1 <span style="color:#f92672">+</span> v1<span style="color:#f92672">[</span>v2<span style="color:#f92672">])</span> <span style="color:#f92672">%</span> 0x100<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            arg8 <span style="color:#f92672">=</span> arg6<span style="color:#f92672">[</span>v2<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>            arg6<span style="color:#f92672">[</span>v2<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> arg6<span style="color:#f92672">[</span>v7_1<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>            arg6<span style="color:#f92672">[</span>v7_1<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> arg8<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">++</span>v2<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">en2</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> arg7<span style="color:#f92672">,</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> arg8<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> arg9<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> v0 <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> v1 <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> v2 <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span>v0 <span style="color:#f92672">&lt;</span> arg9<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            v1 <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>v1 <span style="color:#f92672">+</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">%</span> 0x100<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            v2 <span style="color:#f92672">=</span> <span style="color:#f92672">((</span>arg7<span style="color:#f92672">[</span>v1<span style="color:#f92672">]</span> <span style="color:#f92672">&amp;</span> 0xFF<span style="color:#f92672">)</span> <span style="color:#f92672">+</span> v2<span style="color:#f92672">)</span> <span style="color:#f92672">%</span> 0x100<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> v3 <span style="color:#f92672">=</span> arg7<span style="color:#f92672">[</span>v1<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>            arg7<span style="color:#f92672">[</span>v1<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> arg7<span style="color:#f92672">[</span>v2<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>            arg7<span style="color:#f92672">[</span>v2<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> v3<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            arg8<span style="color:#f92672">[</span>v0<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#f92672">((</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">)(</span>arg8<span style="color:#f92672">[</span>v0<span style="color:#f92672">]</span> <span style="color:#f92672">^</span> arg7<span style="color:#f92672">[((</span>arg7<span style="color:#f92672">[</span>v1<span style="color:#f92672">]</span> <span style="color:#f92672">&amp;</span> 0xFF<span style="color:#f92672">)</span> <span style="color:#f92672">+</span> <span style="color:#f92672">(</span>arg7<span style="color:#f92672">[</span>v2<span style="color:#f92672">]</span> <span style="color:#f92672">&amp;</span> 0xFF<span style="color:#f92672">))</span> <span style="color:#f92672">%</span> 0x100<span style="color:#f92672">]));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">++</span>v0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">file</span><span style="color:#f92672">(</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> arg6<span style="color:#f92672">,</span> String arg7<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>  <span style="color:#75715e">// passwd, key = &#39;th1s_1s_k3ya!!!!&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> v0 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>0x100<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> v1 <span style="color:#f92672">=</span> 17<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> v2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[]{</span>0x8B<span style="color:#f92672">,</span> 0xD2<span style="color:#f92672">,</span> 0xD9<span style="color:#f92672">,</span> 0x5D<span style="color:#f92672">,</span> 0x95<span style="color:#f92672">,</span> 0xFF<span style="color:#f92672">,</span> 0x7E<span style="color:#f92672">,</span> 0x5F<span style="color:#f92672">,</span> 0x29<span style="color:#f92672">,</span> 0x56<span style="color:#f92672">,</span> 0x12<span style="color:#f92672">,</span> 0xB9<span style="color:#f92672">,</span> 0xEF<span style="color:#f92672">,</span> 0xEC<span style="color:#f92672">,</span> 0x8B<span style="color:#f92672">,</span> 0xD0<span style="color:#f92672">,</span> 0x45<span style="color:#f92672">};</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">en1</span><span style="color:#f92672">(</span>v0<span style="color:#f92672">,</span> arg7<span style="color:#f92672">,</span> arg7<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">en2</span><span style="color:#f92672">(</span>v0<span style="color:#f92672">,</span> arg6<span style="color:#f92672">,</span> arg6<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>arg6<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">!=</span> v1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> v7<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>v7 <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> v7 <span style="color:#f92672">&lt;</span> v1<span style="color:#f92672">;</span> <span style="color:#f92672">++</span>v7<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span><span style="color:#f92672">((</span>arg6<span style="color:#f92672">[</span>v7<span style="color:#f92672">]</span> <span style="color:#f92672">&amp;</span> 0xFF<span style="color:#f92672">)</span> <span style="color:#f92672">!=</span> v2<span style="color:#f92672">[</span>v7<span style="color:#f92672">])</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> 1<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>懂的话就会发现这个就是一个s盒从 <code>0-255</code> 变成 <code>256-1</code> 的 <code>RC4</code> 密码</p>
<p>不懂的话直接把代码复制出来，把 <code>file</code> 函数改写成 <code>main</code> 函数，反向求解一下就行（因为仔细观察就可以发现 <code>en2</code> 只对明文做了个异或运算，且异或的对象和明文本身没有关系），这里当密码学的题来做其实就好了。</p>
<p>这是我复制后改写的 java 代码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Main</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">en1</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> arg6<span style="color:#f92672">,</span> String arg7<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> arg8<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> v0 <span style="color:#f92672">=</span> 0x100<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> v1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span>v0<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> v7 <span style="color:#f92672">=</span> arg7<span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> v2 <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> v3<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>v3 <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> v3 <span style="color:#f92672">&lt;</span> v0<span style="color:#f92672">;</span> <span style="color:#f92672">++</span>v3<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            arg6<span style="color:#f92672">[</span>v3<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> 0x100 <span style="color:#f92672">-</span> v3<span style="color:#f92672">;</span>  <span style="color:#75715e">// 256-1降序
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            v1<span style="color:#f92672">[</span>v3<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> v7<span style="color:#f92672">[</span>v3 <span style="color:#f92672">%</span> arg8<span style="color:#f92672">];</span>  <span style="color:#75715e">// 用密钥填满v1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> v7_1 <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span>v2 <span style="color:#f92672">&lt;</span> v0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            v7_1 <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>arg6<span style="color:#f92672">[</span>v2<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> v7_1 <span style="color:#f92672">+</span> v1<span style="color:#f92672">[</span>v2<span style="color:#f92672">])</span> <span style="color:#f92672">%</span> 0x100<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            arg8 <span style="color:#f92672">=</span> arg6<span style="color:#f92672">[</span>v2<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>            arg6<span style="color:#f92672">[</span>v2<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> arg6<span style="color:#f92672">[</span>v7_1<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>            arg6<span style="color:#f92672">[</span>v7_1<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> arg8<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">++</span>v2<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">en2</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> arg7<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> arg8<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> arg9<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> v0 <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> v1 <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> v2 <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span>v0 <span style="color:#f92672">&lt;</span> arg9<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            v1 <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>v1 <span style="color:#f92672">+</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">%</span> 0x100<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            v2 <span style="color:#f92672">=</span> <span style="color:#f92672">((</span>arg7<span style="color:#f92672">[</span>v1<span style="color:#f92672">]</span> <span style="color:#f92672">&amp;</span> 0xFF<span style="color:#f92672">)</span> <span style="color:#f92672">+</span> v2<span style="color:#f92672">)</span> <span style="color:#f92672">%</span> 0x100<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> v3 <span style="color:#f92672">=</span> arg7<span style="color:#f92672">[</span>v1<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>            arg7<span style="color:#f92672">[</span>v1<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> arg7<span style="color:#f92672">[</span>v2<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>            arg7<span style="color:#f92672">[</span>v2<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> v3<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            arg8<span style="color:#f92672">[</span>v0<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#f92672">((</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">)(</span>arg8<span style="color:#f92672">[</span>v0<span style="color:#f92672">]</span> <span style="color:#f92672">^</span> arg7<span style="color:#f92672">[((</span>arg7<span style="color:#f92672">[</span>v1<span style="color:#f92672">]</span> <span style="color:#f92672">&amp;</span> 0xFF<span style="color:#f92672">)</span> <span style="color:#f92672">+</span> <span style="color:#f92672">(</span>arg7<span style="color:#f92672">[</span>v2<span style="color:#f92672">]</span> <span style="color:#f92672">&amp;</span> 0xFF<span style="color:#f92672">))</span> <span style="color:#f92672">%</span> 0x100<span style="color:#f92672">]));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">++</span>v0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        String arg7 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;th1s_1s_k3y!!!!!&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> arg6 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[]{</span>0x8B<span style="color:#f92672">,</span> 0xD2<span style="color:#f92672">,</span> 0xD9<span style="color:#f92672">,</span> 0x5D<span style="color:#f92672">,</span> 0x95<span style="color:#f92672">,</span> 0xFF<span style="color:#f92672">,</span> 0x7E<span style="color:#f92672">,</span> 0x5F<span style="color:#f92672">,</span> 0x29<span style="color:#f92672">,</span> 0x56<span style="color:#f92672">,</span> 0x12<span style="color:#f92672">,</span> 0xB9<span style="color:#f92672">,</span> 0xEF<span style="color:#f92672">,</span> 0xEC<span style="color:#f92672">,</span> 0x8B<span style="color:#f92672">,</span> 0xD0<span style="color:#f92672">,</span> 0x45<span style="color:#f92672">};</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> v0 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>0x100<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> v1 <span style="color:#f92672">=</span> 17<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> v2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[]{};</span>
</span></span><span style="display:flex;"><span>        en1<span style="color:#f92672">(</span>v0<span style="color:#f92672">,</span> arg7<span style="color:#f92672">,</span> arg7<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        en2<span style="color:#f92672">(</span>v0<span style="color:#f92672">,</span> arg6<span style="color:#f92672">,</span> arg6<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> arg6<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">print</span><span style="color:#f92672">((</span><span style="color:#66d9ef">char</span><span style="color:#f92672">)(</span>arg6<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">&amp;</span> 0xff<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>当然也可以跟在第一段 python 后面继续写</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> string
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> libnum <span style="color:#f92672">import</span> s2n
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>en_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;7+RmFXP2LWP2L6g3&#39;</span>[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;==qi7esi&#39;</span>[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>true_base <span style="color:#f92672">=</span> string<span style="color:#f92672">.</span>ascii_uppercase <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>ascii_lowercase <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>digits <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;+/&#39;</span>
</span></span><span style="display:flex;"><span>fake_base <span style="color:#f92672">=</span> string<span style="color:#f92672">.</span>ascii_lowercase <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>digits <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;+/&#39;</span> <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>ascii_uppercase
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> en_key:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> c <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;=&#39;</span>:
</span></span><span style="display:flex;"><span>        key <span style="color:#f92672">+=</span> c
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>    key <span style="color:#f92672">+=</span> true_base[fake_base<span style="color:#f92672">.</span>index(c)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64decode(key)
</span></span><span style="display:flex;"><span>print(key)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># th1s_1s_k3y!!!!!</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ciphertext <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0x8B</span>, <span style="color:#ae81ff">0xD2</span>, <span style="color:#ae81ff">0xD9</span>, <span style="color:#ae81ff">0x5D</span>, <span style="color:#ae81ff">0x95</span>, <span style="color:#ae81ff">0xFF</span>, <span style="color:#ae81ff">0x7E</span>, <span style="color:#ae81ff">0x5F</span>, <span style="color:#ae81ff">0x29</span>, <span style="color:#ae81ff">0x56</span>, <span style="color:#ae81ff">0x12</span>, <span style="color:#ae81ff">0xB9</span>, <span style="color:#ae81ff">0xEF</span>, <span style="color:#ae81ff">0xEC</span>, <span style="color:#ae81ff">0x8B</span>, <span style="color:#ae81ff">0xD0</span>, <span style="color:#ae81ff">0x45</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">en1</span>(key, len_key):
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    v0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x100</span>
</span></span><span style="display:flex;"><span>    v1 <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> v0
</span></span><span style="display:flex;"><span>    v7 <span style="color:#f92672">=</span> [c <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> key]
</span></span><span style="display:flex;"><span>    v2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> v3 <span style="color:#f92672">in</span> range(v0):
</span></span><span style="display:flex;"><span>        res<span style="color:#f92672">.</span>append(<span style="color:#ae81ff">0x100</span> <span style="color:#f92672">-</span> v3)
</span></span><span style="display:flex;"><span>        v1[v3] <span style="color:#f92672">=</span> v7[v3 <span style="color:#f92672">%</span> len_key]
</span></span><span style="display:flex;"><span>    v7_1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> v2 <span style="color:#f92672">&lt;</span> v0:
</span></span><span style="display:flex;"><span>        v7_1 <span style="color:#f92672">=</span> (res[v2] <span style="color:#f92672">+</span> v7_1 <span style="color:#f92672">+</span> v1[v2]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">0x100</span>
</span></span><span style="display:flex;"><span>        len_key <span style="color:#f92672">=</span> res[v2]
</span></span><span style="display:flex;"><span>        res[v2] <span style="color:#f92672">=</span> res[v7_1]
</span></span><span style="display:flex;"><span>        res[v7_1] <span style="color:#f92672">=</span> len_key
</span></span><span style="display:flex;"><span>        v2 <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">en2</span>(res_key, text, len_text):
</span></span><span style="display:flex;"><span>    v0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    v1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    v2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># text = bytes(text)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> v0 <span style="color:#f92672">&lt;</span> len_text:
</span></span><span style="display:flex;"><span>        v1 <span style="color:#f92672">=</span> (v1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> <span style="color:#ae81ff">0x100</span>
</span></span><span style="display:flex;"><span>        v2 <span style="color:#f92672">=</span> ((res_key[v1] <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>) <span style="color:#f92672">+</span> v2) <span style="color:#f92672">%</span> <span style="color:#ae81ff">0x100</span>
</span></span><span style="display:flex;"><span>        v3 <span style="color:#f92672">=</span> res_key[v1]
</span></span><span style="display:flex;"><span>        res_key[v1] <span style="color:#f92672">=</span> res_key[v2]
</span></span><span style="display:flex;"><span>        res_key[v2] <span style="color:#f92672">=</span> v3
</span></span><span style="display:flex;"><span>        text[v0] <span style="color:#f92672">=</span> ((text[v0] <span style="color:#f92672">^</span> res_key[((res_key[v1] <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>) <span style="color:#f92672">+</span> (res_key[v2] <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span>)) <span style="color:#f92672">%</span> <span style="color:#ae81ff">0x100</span>]))
</span></span><span style="display:flex;"><span>        v0 <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> text
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>list_key <span style="color:#f92672">=</span> en1(key[:], len(key))
</span></span><span style="display:flex;"><span>plaintext <span style="color:#f92672">=</span> en2(list_key[:], ciphertext[:], len(ciphertext))
</span></span><span style="display:flex;"><span>print (plaintext)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> plaintext:
</span></span><span style="display:flex;"><span>    flag <span style="color:#f92672">+=</span> chr(c)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print (flag)
</span></span></code></pre></div><p>这样就拿到密码了 <code>Y0uG3tTheP4ssw0rd</code></p>
<p>然后将 apk 解压一下（用的 bandizip，可以直接解压），在目录下面可以找到 <code>\assets\flag.zip</code></p>
<p>解压即可拿到 flag</p>
<h2 id="easy_mips-mips-逆向">easy_mips （mips 逆向）</h2>
<p>这是一道mips的题，用ida无法反汇编，<del>爬了</del></p>
<p>先用ida的字符串搜索找到了关键代码在 <code>tty_write</code> 函数里，并且调用了 <code>encry</code> 函数和 <code>init</code> 函数，但因为没学过mips，也就没法继续分析了</p>
<p>于是第一次尝试使用 Ghidra</p>
<p>用 Ghidra 打开二进制文件</p>
<p>找到关键函数 <code>tty_write</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">tty_write</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>param_1,<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>param_2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> __fd;
</span></span><span style="display:flex;"><span>  size_t __n;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> iVar1;
</span></span><span style="display:flex;"><span>  EVP_PKEY_CTX aEStack56 [<span style="color:#ae81ff">20</span>];
</span></span><span style="display:flex;"><span>  undefined4 local_24;
</span></span><span style="display:flex;"><span>  undefined4 local_20;
</span></span><span style="display:flex;"><span>  undefined4 local_1c;
</span></span><span style="display:flex;"><span>  undefined4 local_18;
</span></span><span style="display:flex;"><span>  undefined4 local_14;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> local_10;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> local_c;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  local_c <span style="color:#f92672">=</span> __stack_chk_guard;
</span></span><span style="display:flex;"><span>  local_24 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x666c6167</span>;
</span></span><span style="display:flex;"><span>  local_20 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x7b69745f</span>;
</span></span><span style="display:flex;"><span>  local_1c <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x69735f5f</span>;
</span></span><span style="display:flex;"><span>  local_18 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x5f5f6661</span>;
</span></span><span style="display:flex;"><span>  local_14 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x6b657d0a</span>;
</span></span><span style="display:flex;"><span>  local_10 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;\0&#39;</span>;
</span></span><span style="display:flex;"><span>  __fd <span style="color:#f92672">=</span> open(param_1,<span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (__fd <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;cannot open&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>    exit(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  __n <span style="color:#f92672">=</span> strlen(param_2);
</span></span><span style="display:flex;"><span>  write(__fd,param_2,__n);
</span></span><span style="display:flex;"><span>  read(__fd,aEStack56,<span style="color:#ae81ff">0x13</span>);
</span></span><span style="display:flex;"><span>  encry(aEStack56);
</span></span><span style="display:flex;"><span>  iVar1 <span style="color:#f92672">=</span> strcmp((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)aEStack56,(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>local_24);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (iVar1 <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    write(__fd,<span style="color:#e6db74">&#34;you get the fake flag</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,<span style="color:#ae81ff">0x16</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    iVar1 <span style="color:#f92672">=</span> strcmp((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)aEStack56,<span style="color:#e6db74">&#34;3_isjA0UeQZcNa</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">`</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">Vf&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (iVar1 <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      puts(<span style="color:#e6db74">&#34;you_don</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">t_get_the_flag&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">goto</span> LAB_00400b48;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    write(__fd,<span style="color:#e6db74">&#34;good_job!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,<span style="color:#ae81ff">10</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  close(__fd);
</span></span><span style="display:flex;"><span>LAB_00400b48:
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (local_c <span style="color:#f92672">!=</span> __stack_chk_guard) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>    __stack_chk_fail();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>之前在 ida 中发现 <code>local_24</code> 是一个fake flag，就不管了</p>
<p>发现调用了一个 <code>encry</code> 函数，进入这个函数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">encry</span>(EVP_PKEY_CTX <span style="color:#f92672">*</span>param_1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> cVar1;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> local_10;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  init(param_1);
</span></span><span style="display:flex;"><span>  cVar1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;\x05&#39;</span>;
</span></span><span style="display:flex;"><span>  local_10 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> (local_10 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0x13</span>) {
</span></span><span style="display:flex;"><span>    param_1[local_10] <span style="color:#f92672">=</span> (EVP_PKEY_CTX)((<span style="color:#66d9ef">char</span>)param_1[local_10] <span style="color:#f92672">-</span> cVar1);
</span></span><span style="display:flex;"><span>    cVar1 <span style="color:#f92672">=</span> cVar1 <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\x01&#39;</span>;
</span></span><span style="display:flex;"><span>    local_10 <span style="color:#f92672">=</span> local_10 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>发现先调用了 <code>init</code> 函数，然后对每一位做了个减法</p>
<p>查看 <code>init</code> 函数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">init</span>(EVP_PKEY_CTX <span style="color:#f92672">*</span>ctx)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> iVar1;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> extraout_var;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> extraout_var_00;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> extraout_var_01;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> local_20;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  iVar1 <span style="color:#f92672">=</span> __stack_chk_guard;
</span></span><span style="display:flex;"><span>  srand(<span style="color:#ae81ff">0x1c5e</span>);
</span></span><span style="display:flex;"><span>  rand();
</span></span><span style="display:flex;"><span>  rand();
</span></span><span style="display:flex;"><span>  rand();
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span>ctx <span style="color:#f92672">=</span> (EVP_PKEY_CTX)((byte)<span style="color:#f92672">*</span>ctx <span style="color:#f92672">^</span> extraout_var <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x32U</span>);
</span></span><span style="display:flex;"><span>  ctx[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">=</span> (EVP_PKEY_CTX)((byte)ctx[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">^</span> extraout_var_00 <span style="color:#f92672">-</span> <span style="color:#ae81ff">0x39U</span>);
</span></span><span style="display:flex;"><span>  ctx[<span style="color:#ae81ff">6</span>] <span style="color:#f92672">=</span> (EVP_PKEY_CTX)((byte)ctx[<span style="color:#ae81ff">6</span>] <span style="color:#f92672">^</span> extraout_var_01 <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x30U</span>);
</span></span><span style="display:flex;"><span>  local_20 <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> (local_20 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0xd</span>) {
</span></span><span style="display:flex;"><span>    local_20 <span style="color:#f92672">=</span> local_20 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (iVar1 <span style="color:#f92672">!=</span> __stack_chk_guard) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">/* WARNING: Subroutine does not return */</span>
</span></span><span style="display:flex;"><span>    __stack_chk_fail();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> __stack_chk_guard;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这里自动分析出现了问题，不知道 <code>extraout_var</code> 和 <code>rand</code> 有什么关系</p>
<p>于是只能去找对应的汇编慢慢读</p>
<p>根据 Ghidra 里代码与汇编的映射关系，找到了 <code>extraout_var</code> 的位置</p>
<pre tabindex="0"><code class="language-assembly" data-lang="assembly">        00400d00 80  43  00  00    lb         v1,0x0 (v0)
        00400d04 8f  c2  00  24    lw         v0,local_1c (s8)
        00400d08 30  42  00  ff    andi       v0,v0,0xff
        00400d0c 24  42  00  32    addiu      v0,v0,0x32
        00400d10 30  42  00  ff    andi       v0,v0,0xff
        00400d14 7c  02  14  20    seb        v0,v0
        00400d18 00  62  10  26    xor        v0,v1,v0
        00400d1c 7c  02  1c  20    seb        v1,v0
        00400d20 8f  c2  00  1c    lw         v0,local_24 (s8)
        00400d24 a0  43  00  00    sb         v1,0x0 (v0)
</code></pre><p>找到 <code>addiu</code> 说明 <code>v0</code> 对应的就是 <code>extraout_var</code>，发现是从 <code>local_1c</code> 处取出的</p>
<p>往上找 <code>local_1c</code></p>
<pre tabindex="0"><code class="language-assembly" data-lang="assembly">        00400c80 8f  dc  00  10    lw         gp,local_30 (s8)
        00400c84 8f  82  80  44    lw         v0,-0x7fbc (gp)=&gt;-&gt;rand                          = 004010e0
        00400c88 00  40  c8  25    or         t9,v0,zero
        00400c8c 03  20  f8  09    jalr       t9=&gt;rand                                         int rand(void)
        00400c90 00  00  00  00    _nop
        00400c94 8f  dc  00  10    lw         gp,local_30 (s8)
        00400c98 00  40  18  25    or         v1,v0,zero
        00400c9c 83  c2  00  31    lb         v0,local_10 +0x1 (s8)
        00400ca0 00  62  10  26    xor        v0,v1,v0
        00400ca4 00  02  16  03    sra        v0,v0,0x18
        00400ca8 af  c2  00  24    sw         v0,local_1c (s8)
</code></pre><p>从后往前看，最后是将 v0 存到 local_1c 中，倒数第二步是将 v0 右移 0x18 位（这里问了一下会mips的大佬&hellip;），虽然没法完美分析出 rand 的结果存到了哪里，但是可以猜测最后右移了 0x18 位并存到了 <code>local_1c</code> 中。</p>
<p>于是就可以尝试编写代码，破解flag了。</p>
<p>首先计算几个 <code>rand</code> 的结果</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(){
</span></span><span style="display:flex;"><span>    srand(<span style="color:#ae81ff">0x1c5e</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> a[<span style="color:#ae81ff">20</span>];
</span></span><span style="display:flex;"><span>    a[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;8&#39;</span>;
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;%x</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, rand());
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;%x</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, rand());
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;%x</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, rand());
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>运行得到</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>./test_rand
</span></span><span style="display:flex;"><span>446aef60
</span></span><span style="display:flex;"><span>5de30bb4
</span></span><span style="display:flex;"><span>27445d71
</span></span></code></pre></div><p>随后写个反向的算法</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>encry <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;3_isjA0UeQZcNa</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">`</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">Vf&#39;</span>
</span></span><span style="display:flex;"><span>flag_1 <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>t <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> encry:
</span></span><span style="display:flex;"><span>    flag_1<span style="color:#f92672">.</span>append(i <span style="color:#f92672">+</span> t)
</span></span><span style="display:flex;"><span>    t <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>print (flag_1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rand <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0x44</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x32</span>, <span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0x5d</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">0x39</span>, <span style="color:#ae81ff">0x27</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x30</span>] <span style="color:#f92672">+</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">15</span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(flag_1)):
</span></span><span style="display:flex;"><span>    flag <span style="color:#f92672">+=</span> chr(flag_1[i] <span style="color:#f92672">^</span> (rand[i] <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xff</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print (flag)
</span></span></code></pre></div><p>得到最终的flag</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>[<span style="color:#ae81ff">56</span>, <span style="color:#ae81ff">101</span>, <span style="color:#ae81ff">112</span>, <span style="color:#ae81ff">123</span>, <span style="color:#ae81ff">115</span>, <span style="color:#ae81ff">75</span>, <span style="color:#ae81ff">59</span>, <span style="color:#ae81ff">97</span>, <span style="color:#ae81ff">114</span>, <span style="color:#ae81ff">95</span>, <span style="color:#ae81ff">105</span>, <span style="color:#ae81ff">115</span>, <span style="color:#ae81ff">95</span>, <span style="color:#ae81ff">115</span>, <span style="color:#ae81ff">111</span>, <span style="color:#ae81ff">116</span>, <span style="color:#ae81ff">113</span>, <span style="color:#ae81ff">108</span>, <span style="color:#ae81ff">125</span>]
</span></span><span style="display:flex;"><span>Nep{solar_is_sotql}
</span></span></code></pre></div><h2 id="worrrrms-go语言逆向">worrrrms （go语言逆向）</h2>
<p>只知道用了SM4算法加密，不会go语言，具体的看不懂，爬了。</p>
<h2 id="总结">总结</h2>
<p>这个比赛的前五道题其实就是各个方向的入门题目，有相应的工具并且能够看懂伪代码就可以做了，只需要进行静态分析。做go语言的时候发现go的函数调用太奇怪了，而且有各种指针，不愧是最安全的语言。</p>
<p>至于后面的几道题，由于解的人太少，也就没有去看，看完wp再补。</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/ctf/">CTF</a>
        
            <a href="/tags/reverse/">Reverse</a>
        
    </section>


    </footer>


    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">Related contents</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="has-image">
    <a href="/post/reverse-from-0-to-1/">
        
        
            <div class="article-image">
                <img src="/post/reverse-from-0-to-1/cover.07d6ebb72bedbf8e45896cc7b1df8077_hu1385a0e9a9a82b1c72526aa43682148d_1249114_250x150_fill_q75_box_smart1.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Reverse from 0 to 1"
                        
                        data-hash="md5-B9brtyvtv45FiWzHsd&#43;Adw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Reverse from 0 to 1</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/post/hgame2021-vernam-and-fake/">
        
        

        <div class="article-details">
            <h2 class="article-title">HGAME2021 Vernam and FAKE</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy;
        
        2023 s0uthwood&#39;s Blog
    
        
            <br />
            已运行 <i class="fas fa-bell"></i> <a id="days">0</a> 天
        
    
        
            &nbsp;&nbsp;
            
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
            
            ⌨&nbsp;
            85.58k&nbsp;
            字
            &nbsp;&nbsp;
            🧠&nbsp;
            37&nbsp;
            篇文章
        
    </section>

    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.5.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>

    
        <script>
            var s1 = "2020-11-15";
            s1 = new Date(s1.replace(/-/g, "/"));
            s2 = new Date();
            var days = s2.getTime() - s1.getTime();
            var number_of_days = parseInt(days / (1000 * 60 * 60 * 24));
            document.getElementById('days').innerHTML = number_of_days;
        </script>
    
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">Table of contents</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#hardsharp-net-逆向">hardsharp (.NET 逆向)</a></li>
    <li><a href="#二十六进制-c--c-逆向">二十六进制 （c / c++ 逆向）</a></li>
    <li><a href="#password-安卓逆向">password （安卓逆向）</a></li>
    <li><a href="#easy_mips-mips-逆向">easy_mips （mips 逆向）</a></li>
    <li><a href="#worrrrms-go语言逆向">worrrrms （go语言逆向）</a></li>
    <li><a href="#总结">总结</a></li>
  </ul>
</nav>
                </div>
            </section>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
