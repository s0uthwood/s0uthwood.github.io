<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='这个周末遇到好多新奇的东西，其实有几道题值得单独写一篇，但是懒了，就统一记录一下吧。包括美团CTF和SECCON的部分题目。'><title>All Solves During a Weekend</title>

<link rel='canonical' href='/post/all-solves-during-a-weekend/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='All Solves During a Weekend'>
<meta property='og:description' content='这个周末遇到好多新奇的东西，其实有几道题值得单独写一篇，但是懒了，就统一记录一下吧。包括美团CTF和SECCON的部分题目。'>
<meta property='og:url' content='/post/all-solves-during-a-weekend/'>
<meta property='og:site_name' content='s0uthwood&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='CTF' /><meta property='article:tag' content='Reverse' /><meta property='article:tag' content='Writeup' /><meta property='article:tag' content='MTCTF' /><meta property='article:tag' content='SECCONCTF' /><meta property='article:tag' content='idek' /><meta property='article:tag' content='wasm' /><meta property='article:tag' content='Pintool' /><meta property='article:tag' content='HeavensGate' /><meta property='article:tag' content='movfuscator' /><meta property='article:tag' content='Python' /><meta property='article:published_time' content='2021-12-13T19:37:54&#43;08:00'/><meta property='article:modified_time' content='2021-12-13T19:37:54&#43;08:00'/><meta property='og:image' content='/post/all-solves-during-a-weekend/cover.jpg' />
<meta name="twitter:title" content="All Solves During a Weekend">
<meta name="twitter:description" content="这个周末遇到好多新奇的东西，其实有几道题值得单独写一篇，但是懒了，就统一记录一下吧。包括美团CTF和SECCON的部分题目。"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='/post/all-solves-during-a-weekend/cover.jpg' />
    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="/" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>Back</span>
            </a>
        </div>
    
<main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/post/all-solves-during-a-weekend/">
                <img src="/post/all-solves-during-a-weekend/cover_hu9fbd6f3e94fcae560a952561592fc022_254866_800x0_resize_q75_box.jpg"
                        srcset="/post/all-solves-during-a-weekend/cover_hu9fbd6f3e94fcae560a952561592fc022_254866_800x0_resize_q75_box.jpg 800w, /post/all-solves-during-a-weekend/cover_hu9fbd6f3e94fcae560a952561592fc022_254866_1600x0_resize_q75_box.jpg 1600w"
                        width="800" 
                        height="450" 
                        loading="lazy"
                        alt="Featured image of post All Solves During a Weekend" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/ctf/" >
                CTF
            </a>
        
            <a href="/categories/reverse/" >
                Reverse
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/post/all-solves-during-a-weekend/">All Solves During a Weekend</a>
    </h2>

    
    <h3 class="article-subtitle">
        这个周末遇到好多新奇的东西，其实有几道题值得单独写一篇，但是懒了，就统一记录一下吧。包括美团CTF和SECCON的部分题目。
    </h3>
    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Dec 13, 2021</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-pencil" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#9e9e9e" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <path d="M4 20h4L18.5 9.5a1.5 1.5.0 00-4-4L4 16v4"></path>
    <line x1="13.5" y1="6.5" x2="17.5" y2="10.5"></line>
</svg>
                <time class="article-words">
                    3071 words
                </time>
            </div>
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    15 minute read
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <blockquote>
<p>打美团 CTF 的时候才意识到，有一种坐牢叫AK</p>
</blockquote>
<h2 id="mtctf-4thwow">[MTCTF 4th]wow</h2>
<p>先进行脱壳，因为脱壳后用的是绝对地址，而加载的时候是动态加载，所有没有办法调试，那就直接静态看吧</p>
<p><code>JUMPOUT</code> 那里看一下汇编，发现有一个天堂之门</p>
<pre tabindex="0"><code class="language-assembly" data-lang="assembly">push 0x33
call $+5
add [esp+84h+var_84], 5
retf
</code></pre><p>直接把后面的数据全 dump 出来，然后用 ida64 打开</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#66d9ef">__fastcall</span> <span style="color:#a6e22e">sub_0</span>(<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>a1)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> v1; <span style="color:#75715e">// er9
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v2; <span style="color:#75715e">// ebp
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> v3; <span style="color:#75715e">// esi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>v4; <span style="color:#75715e">// rdi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>v5; <span style="color:#75715e">// r10
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> v6; <span style="color:#75715e">// ebx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> i; <span style="color:#75715e">// er11
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> v8; <span style="color:#75715e">// er8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v9; <span style="color:#75715e">// edx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> v10; <span style="color:#75715e">// eax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> v11; <span style="color:#75715e">// er9
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> v12; <span style="color:#75715e">// er8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v13; <span style="color:#75715e">// ebx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v14; <span style="color:#75715e">// ebx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v15; <span style="color:#75715e">// ebx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v16; <span style="color:#75715e">// edx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> v17; <span style="color:#75715e">// eax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> v18; <span style="color:#75715e">// er9
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  v1 <span style="color:#f92672">=</span> a1[<span style="color:#ae81ff">8</span>];
</span></span><span style="display:flex;"><span>  v2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>;
</span></span><span style="display:flex;"><span>  v3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> ( <span style="color:#ae81ff">1</span> )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    v3 <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1732584193</span>;
</span></span><span style="display:flex;"><span>    v4 <span style="color:#f92672">=</span> a1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    v5 <span style="color:#f92672">=</span> a1;
</span></span><span style="display:flex;"><span>    v6 <span style="color:#f92672">=</span> v3 <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> ( i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">8</span>; <span style="color:#f92672">++</span>i )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      v8 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>v4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( (((<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)i <span style="color:#f92672">^</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)v6) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">3</span>) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> )
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">switch</span> ( ((<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)i <span style="color:#f92672">^</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)v6) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">3</span> )
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>            v9 <span style="color:#f92672">=</span> (v1 <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">^</span> (<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> v8);
</span></span><span style="display:flex;"><span>            v10 <span style="color:#f92672">=</span> v1;
</span></span><span style="display:flex;"><span>            v11 <span style="color:#f92672">=</span> v1 <span style="color:#f92672">^</span> <span style="color:#ae81ff">0x10325476</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>            v9 <span style="color:#f92672">=</span> (v1 <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">^</span> (<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> v8);
</span></span><span style="display:flex;"><span>            v10 <span style="color:#f92672">=</span> v1;
</span></span><span style="display:flex;"><span>            v11 <span style="color:#f92672">=</span> v1 <span style="color:#f92672">^</span> <span style="color:#ae81ff">0x98BADCFE</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>            v9 <span style="color:#f92672">=</span> (v1 <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">^</span> (<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> v8);
</span></span><span style="display:flex;"><span>            v10 <span style="color:#f92672">=</span> v1;
</span></span><span style="display:flex;"><span>            v11 <span style="color:#f92672">=</span> v1 <span style="color:#f92672">^</span> <span style="color:#ae81ff">0xC3D2E1F0</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">goto</span> LABEL_12;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        v9 <span style="color:#f92672">=</span> (v1 <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">^</span> (<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> v8);
</span></span><span style="display:flex;"><span>        v10 <span style="color:#f92672">=</span> v1;
</span></span><span style="display:flex;"><span>        v11 <span style="color:#f92672">=</span> v1 <span style="color:#f92672">^</span> <span style="color:#ae81ff">0xEFCDAB89</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">*</span>v5 <span style="color:#f92672">+=</span> (v11 <span style="color:#f92672">+</span> (v3 <span style="color:#f92672">^</span> v8)) <span style="color:#f92672">^</span> (((<span style="color:#ae81ff">16</span> <span style="color:#f92672">*</span> v10) <span style="color:#f92672">^</span> (v8 <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">3</span>)) <span style="color:#f92672">+</span> v9);
</span></span><span style="display:flex;"><span>      v1 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>v5;
</span></span><span style="display:flex;"><span>LABEL_12:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">++</span>v4;
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">++</span>v5;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    v12 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>a1;
</span></span><span style="display:flex;"><span>    v13 <span style="color:#f92672">=</span> ((<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)i <span style="color:#f92672">^</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)v6) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span>v13 )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      v16 <span style="color:#f92672">=</span> (v1 <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">^</span> (<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> v12);
</span></span><span style="display:flex;"><span>      v17 <span style="color:#f92672">=</span> v1;
</span></span><span style="display:flex;"><span>      v18 <span style="color:#f92672">=</span> v1 <span style="color:#f92672">^</span> <span style="color:#ae81ff">0xEFCDAB89</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">goto</span> LABEL_21;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    v14 <span style="color:#f92672">=</span> v13 <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span>v14 )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      v16 <span style="color:#f92672">=</span> (v1 <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">^</span> (<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> v12);
</span></span><span style="display:flex;"><span>      v17 <span style="color:#f92672">=</span> v1;
</span></span><span style="display:flex;"><span>      v18 <span style="color:#f92672">=</span> v1 <span style="color:#f92672">^</span> <span style="color:#ae81ff">0x10325476</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">goto</span> LABEL_21;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    v15 <span style="color:#f92672">=</span> v14 <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span>v15 )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      v16 <span style="color:#f92672">=</span> (v1 <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">^</span> (<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> v12);
</span></span><span style="display:flex;"><span>      v17 <span style="color:#f92672">=</span> v1;
</span></span><span style="display:flex;"><span>      v18 <span style="color:#f92672">=</span> v1 <span style="color:#f92672">^</span> <span style="color:#ae81ff">0x98BADCFE</span>;
</span></span><span style="display:flex;"><span>LABEL_21:
</span></span><span style="display:flex;"><span>      a1[<span style="color:#ae81ff">8</span>] <span style="color:#f92672">+=</span> (v18 <span style="color:#f92672">+</span> (v3 <span style="color:#f92672">^</span> v12)) <span style="color:#f92672">^</span> (((<span style="color:#ae81ff">16</span> <span style="color:#f92672">*</span> v17) <span style="color:#f92672">^</span> (v12 <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">3</span>)) <span style="color:#f92672">+</span> v16);
</span></span><span style="display:flex;"><span>      v1 <span style="color:#f92672">=</span> a1[<span style="color:#ae81ff">8</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">goto</span> LABEL_22;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( v15 <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      v16 <span style="color:#f92672">=</span> (v1 <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">^</span> (<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> v12);
</span></span><span style="display:flex;"><span>      v17 <span style="color:#f92672">=</span> v1;
</span></span><span style="display:flex;"><span>      v18 <span style="color:#f92672">=</span> v1 <span style="color:#f92672">^</span> <span style="color:#ae81ff">0xC3D2E1F0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">goto</span> LABEL_21;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>LABEL_22:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!--</span>v2 )
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">__asm</span> { retfq }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>是一个 xxtea，用 switch 来判断使用哪个 key，round 是 12，所以直接用脚本解密就行</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;  </span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdint.h&gt;  </span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DELTA 0x67452301  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define MX (((z&gt;&gt;5^y&lt;&lt;2) + (y&gt;&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">btea</span>(<span style="color:#66d9ef">uint32_t</span> <span style="color:#f92672">*</span>v, <span style="color:#66d9ef">int</span> n, <span style="color:#66d9ef">uint32_t</span> <span style="color:#66d9ef">const</span> key[<span style="color:#ae81ff">4</span>])  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint32_t</span> y, z, sum;  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">unsigned</span> p, rounds, e;  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>)            <span style="color:#75715e">/* Coding Part */</span>  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        printf(<span style="color:#e6db74">&#34;No use&#34;</span>);
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">&lt;</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)      <span style="color:#75715e">/* Decoding Part */</span>  
</span></span><span style="display:flex;"><span>    {  
</span></span><span style="display:flex;"><span>        n <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>n;  
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// rounds = 6 + 52/n; 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        rounds <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>; 
</span></span><span style="display:flex;"><span>        sum <span style="color:#f92672">=</span> rounds<span style="color:#f92672">*</span>DELTA;  
</span></span><span style="display:flex;"><span>        y <span style="color:#f92672">=</span> v[<span style="color:#ae81ff">0</span>];  
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">do</span>  
</span></span><span style="display:flex;"><span>        {  
</span></span><span style="display:flex;"><span>            e <span style="color:#f92672">=</span> (sum <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">3</span>;  
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (p<span style="color:#f92672">=</span>n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>; p<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">0</span>; p<span style="color:#f92672">--</span>)  
</span></span><span style="display:flex;"><span>            {  
</span></span><span style="display:flex;"><span>                z <span style="color:#f92672">=</span> v[p<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];  
</span></span><span style="display:flex;"><span>                y <span style="color:#f92672">=</span> v[p] <span style="color:#f92672">-=</span> MX;  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>            z <span style="color:#f92672">=</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];  
</span></span><span style="display:flex;"><span>            y <span style="color:#f92672">=</span> v[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-=</span> MX;  
</span></span><span style="display:flex;"><span>            sum <span style="color:#f92672">-=</span> DELTA;  
</span></span><span style="display:flex;"><span>        }  
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#f92672">--</span>rounds);  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> v[<span style="color:#ae81ff">10</span>] <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">3640088821u</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">1382566363u</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">3805750627u</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">1214181292u</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">1620003782u</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">1482291050u</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">2956289443u</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">1044419009u</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">3554368410u</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0u</span>
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint32_t</span> <span style="color:#66d9ef">const</span> k[<span style="color:#ae81ff">4</span>]<span style="color:#f92672">=</span> {<span style="color:#ae81ff">0xEFCDAB89u</span>, <span style="color:#ae81ff">0x10325476u</span>, <span style="color:#ae81ff">0x98BADCFEu</span>, <span style="color:#ae81ff">0xC3D2E1F0u</span>};  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> n<span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>; <span style="color:#75715e">//n的绝对值表示v的长度，取正表示加密，取负表示解密  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// v为要加密的数据是两个32位无符号整数  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// k为加密解密密钥，为4个32位无符号整数，即密钥长度为128位  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    btea(v, n, k);   
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, v);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span></code></pre></div><h2 id="mtctf-4thsuperflat">[MTCTF 4th]Superflat</h2>
<p>这个题用了 movfuscator，正好前段时间有人在群里提过，一下就想起来了</p>
<p>但要解混淆需要装一个 demov 的工具，配置环境有点复杂</p>
<p>考虑到这个程序中没有任何的动态链接过程，而且能看到两个函数名 <code>getchar</code> 和 <code>putchar</code>，那大胆猜测是按照每一位来判断的，可以考虑上 pintools</p>
<p>先手动测试了一下，发现对于同样的输入，执行的指令数字完全相同，并且每正确一位会增加 4888 条指令，于是根据 pintools 这个工具自己写个爆破脚本</p>
<p>在爆破前看了一下 output 文件，发现总长度是42位，于是直接猜测 flag 格式为 <code>flag{xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx}</code> 其中 x 为 [0-9a-f] （小写字母是手动爆破了第一位确定的）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> subprocess
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>password <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;flag{d06f0bcc-xxxxxxxxxxxxxxxxxxxxxxxxxxx}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cur_pos <span style="color:#f92672">=</span> <span style="color:#ae81ff">14</span>
</span></span><span style="display:flex;"><span>last_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">693225</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> cur_pos <span style="color:#f92672">&lt;</span> len(password) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> <span style="color:#e6db74">&#34;0123456789abcdef-&#34;</span>:
</span></span><span style="display:flex;"><span>        command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;echo &#34;</span> <span style="color:#f92672">+</span> password[:cur_pos] <span style="color:#f92672">+</span> i <span style="color:#f92672">+</span> password[cur_pos<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>:] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; | ./pin-3.18-98332-gaebd7b1e6-gcc-linux/pin -t ./pin-3.18-98332-gaebd7b1e6-gcc-linux/source/tools/ManualExamples/obj-ia32/inscount0.so -- ./superflat; cat inscount.out&#34;</span>
</span></span><span style="display:flex;"><span>        output <span style="color:#f92672">=</span> subprocess<span style="color:#f92672">.</span>check_output(command, shell<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, stderr<span style="color:#f92672">=</span>subprocess<span style="color:#f92672">.</span>PIPE)
</span></span><span style="display:flex;"><span>        count <span style="color:#f92672">=</span> int(output<span style="color:#f92672">.</span>split(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>split()[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>decode())
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> count <span style="color:#f92672">-</span> last_count <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            print (i)
</span></span><span style="display:flex;"><span>            password <span style="color:#f92672">=</span> password[:cur_pos] <span style="color:#f92672">+</span> i <span style="color:#f92672">+</span> password[cur_pos <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>:]
</span></span><span style="display:flex;"><span>            cur_pos <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            last_count <span style="color:#f92672">=</span> count
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">error:&#34;</span>, cur_pos)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># flag{d06f0bcc-93e0-9c5b-161e-e1464176d395}</span>
</span></span></code></pre></div><p>第一次在比赛中用上 pintool，纪念一下</p>
<h2 id="secconctf-2021dis-me">[SECCONCTF 2021]dis-me</h2>
<p>python 逆向，一上线就被叫来做这题了（属于是把 python 题目包场了）</p>
<p>先自己看了眼字节码，然后判断了一下，删了一些东西，再 pycdc 反编译，同时结合着自己的分析，拿到了反编译结果</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> marshal
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> types
</span></span><span style="display:flex;"><span>f <span style="color:#f92672">=</span> open(__file__, <span style="color:#e6db74">&#39;rb&#39;</span>)
</span></span><span style="display:flex;"><span>f<span style="color:#f92672">.</span>seek(<span style="color:#ae81ff">12</span>)
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> marshal<span style="color:#f92672">.</span>loads(f<span style="color:#f92672">.</span>read())<span style="color:#f92672">.</span>co_code[<span style="color:#ae81ff">4</span>:]
</span></span><span style="display:flex;"><span>types<span style="color:#f92672">.</span>FunctionType(marshal<span style="color:#f92672">.</span>loads(base64<span style="color:#f92672">.</span>b64decode(bytes([((y <span style="color:#f92672">-</span> x <span style="color:#f92672">*</span> <span style="color:#ae81ff">7</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">45</span>) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>) <span style="color:#66d9ef">for</span> x, y <span style="color:#f92672">in</span> enumerate((s[<span style="color:#ae81ff">2</span> : <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> s[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">256</span> <span style="color:#f92672">+</span> s[<span style="color:#ae81ff">1</span>]]))]))), globals())()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">del</span> s
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">del</span> f
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">del</span> marshal
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">del</span> base64
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">del</span> types
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span></code></pre></div><p>读取了自身文件，然后偏移改到了 12，就是跳过了文件头，直接从 <code>E3 00 00 00</code> 开始，是 <code>marshal</code> 的正确格式（但自己写的时候有一些问题，不太懂了）</p>
<p>接下来 <code>.co_code[4:]</code> 猜测是取了代码段，并从下标为 4 的地方开始取</p>
<p><code>s[2 : 2 + s[0] * 256 + s[1]]</code>：接下来根据取出数据的前两位来判断接下来取出数据的总长度，并且跳过了前两位</p>
<p>于是最终取出的数据为 <code>0x2C</code> 开始的数据，一直取到 <code>64 00 64 01</code> 这个正确程序的开头部分</p>
<p>types 那一行里面的 <code>bytes([((y - x * 7 - 45) % 256) for x, y in enumerate((s[2 : 2 + s[0] * 256 + s[1]]))])</code> 一开始并没有分析出来，主要是位置不确定，于是自己拿数据试了试可能的几个方案，发现这样可以得到 base64的结果，就说明是这个了</p>
<p>将 base64 的结果解码到文件，然后补全文件头后 uncompyle6 反编译，得到正确的流程</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>f <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> n: n <span style="color:#66d9ef">if</span> n <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">else</span> (f(n <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span> f(n <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>)) <span style="color:#f92672">%</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> input(<span style="color:#e6db74">&#39;Input the flag &gt; &#39;</span>)
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> flag<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#39;SECCON{&#39;</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> flag<span style="color:#f92672">.</span>endswith(<span style="color:#e6db74">&#39;}&#39;</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(flag) <span style="color:#f92672">==</span> <span style="color:#ae81ff">40</span>:
</span></span><span style="display:flex;"><span>            s <span style="color:#f92672">=</span> sum(abs(ord(c) <span style="color:#f92672">-</span> ord(str(f(i)))) <span style="color:#66d9ef">for</span> i, c <span style="color:#f92672">in</span> enumerate(flag[<span style="color:#ae81ff">7</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]))
</span></span><span style="display:flex;"><span>    s <span style="color:#f92672">or</span> print(<span style="color:#e6db74">&#39;Correct! The flag is&#39;</span>, flag)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;Wrong :(&#39;</span>)
</span></span></code></pre></div><p>直接把 <code>str(f(i))</code> 跑一遍就拿到 flag 了（斐波那契）</p>
<h2 id="secconctf-2021flag">[SECCONCTF 2021]flag</h2>
<p>这道题是个 wasm 逆向，人生第一次做出来，值得纪念</p>
<p>先从网站上把 wasm 文件下载下来</p>
<p>第一步肯定是 wasm2c 一下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>./wasm2c 0001d242.wasm -o out.c
</span></span></code></pre></div><p>接下来进行编译</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>g++ -c out.c -o out.o
</span></span></code></pre></div><p>用 ida 打开，发现一个叫 check 的函数，到网站的 js 里面动调到 check，可以获取加载的数据</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">check</span>(<span style="color:#a6e22e">input</span>, <span style="color:#e6db74">&#34;NekoPunch&#34;</span>, <span style="color:#e6db74">&#34;6dbf84f73cf6a112268b09525ea550a665e21cb2e3e13af7e3ea0ecb52f5b9cda5b6522b1e978734553f1d7956d4af94bfc3f4d68c8fba9eeecf4035550b9106f70d57d1a6cdaf3211eaaa78d71a9038b71be621241e8b608a43b107f8860f543ab0189aa063800de4bae7d0b11045b8&#34;</span>)
</span></span></code></pre></div><p>于是看一下 check 函数就行</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>  v6 <span style="color:#f92672">=</span> w2c_g0;
</span></span><span style="display:flex;"><span>  i32_store(<span style="color:#f92672">&amp;</span>w2c_memory, (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)w2c_g0 <span style="color:#f92672">+</span> <span style="color:#ae81ff">40LL</span>, a1);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 省略
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  v7 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">40LL</span>);
</span></span><span style="display:flex;"><span>  v8 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">40LL</span>);
</span></span><span style="display:flex;"><span>  v9 <span style="color:#f92672">=</span> w2c_f25(v8) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  v52 <span style="color:#f92672">=</span> w2c_f21(v7, v9);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">char</span>)i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v52) <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;}&#39;</span>
</span></span></code></pre></div><p>wasm 是基于堆栈的，这里明显能看到栈的痕迹，上来先把第一个参数（输入字符串的地址）存到了 <code>v6+40</code> 的地方（猜测v6是栈顶）</p>
<p>通过第一条 if 比较，猜测 v52 是输入的最后一位，这样就可以知道 <code>w2c_f25</code> 是计算长度，<code>w2c_f21</code> 相当于 <code>a1[a2]</code></p>
<p>接下来注意到中间有一个非常整齐的循环</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> ( (<span style="color:#66d9ef">int</span>)i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">12LL</span>) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">128</span> )
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        v22 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>        w2c_f23(v22, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">4u</span>, <span style="color:#ae81ff">8u</span>, <span style="color:#ae81ff">0xCu</span>);
</span></span><span style="display:flex;"><span>        v23 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>        w2c_f23(v23, <span style="color:#ae81ff">5u</span>, <span style="color:#ae81ff">9u</span>, <span style="color:#ae81ff">0xDu</span>, <span style="color:#ae81ff">1u</span>);
</span></span><span style="display:flex;"><span>        v24 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>        w2c_f23(v24, <span style="color:#ae81ff">0xAu</span>, <span style="color:#ae81ff">0xEu</span>, <span style="color:#ae81ff">2u</span>, <span style="color:#ae81ff">6u</span>);
</span></span><span style="display:flex;"><span>        v25 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>        w2c_f23(v25, <span style="color:#ae81ff">0xFu</span>, <span style="color:#ae81ff">3u</span>, <span style="color:#ae81ff">7u</span>, <span style="color:#ae81ff">0xBu</span>);
</span></span><span style="display:flex;"><span>        v26 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>        w2c_f23(v26, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1u</span>, <span style="color:#ae81ff">2u</span>, <span style="color:#ae81ff">3u</span>);
</span></span><span style="display:flex;"><span>        v27 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>        w2c_f23(v27, <span style="color:#ae81ff">5u</span>, <span style="color:#ae81ff">6u</span>, <span style="color:#ae81ff">7u</span>, <span style="color:#ae81ff">4u</span>);
</span></span><span style="display:flex;"><span>        v28 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>        w2c_f23(v28, <span style="color:#ae81ff">0xAu</span>, <span style="color:#ae81ff">0xBu</span>, <span style="color:#ae81ff">8u</span>, <span style="color:#ae81ff">9u</span>);
</span></span><span style="display:flex;"><span>        v29 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>        w2c_f23(v29, <span style="color:#ae81ff">0xFu</span>, <span style="color:#ae81ff">0xCu</span>, <span style="color:#ae81ff">0xDu</span>, <span style="color:#ae81ff">0xEu</span>);
</span></span><span style="display:flex;"><span>        v57 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">12LL</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        i32_store(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">12LL</span>, v57);
</span></span><span style="display:flex;"><span>      }
</span></span></code></pre></div><p>显然 <code>v6+12</code> 的地方存的是循环次数，这个格式和前段时间学的 <code>salsa20</code> 很像</p>
<p>查看 <code>w2c_f23</code> 函数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>  i32_store(<span style="color:#f92672">&amp;</span>w2c_memory, (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)(w2c_g0 <span style="color:#f92672">-</span> <span style="color:#ae81ff">32</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>, a1);
</span></span><span style="display:flex;"><span>  i32_store(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">24LL</span>, a2);
</span></span><span style="display:flex;"><span>  i32_store(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">20LL</span>, a3);
</span></span><span style="display:flex;"><span>  i32_store(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">16LL</span>, a4);
</span></span><span style="display:flex;"><span>  i32_store(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">12LL</span>, a5);
</span></span><span style="display:flex;"><span>  v10 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v11 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">24LL</span>) <span style="color:#f92672">+</span> v10;
</span></span><span style="display:flex;"><span>  v12 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v11);
</span></span><span style="display:flex;"><span>  v13 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v14 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">12LL</span>) <span style="color:#f92672">+</span> v13;
</span></span><span style="display:flex;"><span>  v15 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v14);
</span></span><span style="display:flex;"><span>  v16 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v17 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">24LL</span>) <span style="color:#f92672">+</span> v16;
</span></span><span style="display:flex;"><span>  v18 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v17);
</span></span><span style="display:flex;"><span>  v19 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v20 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">12LL</span>) <span style="color:#f92672">+</span> v19;
</span></span><span style="display:flex;"><span>  v21 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v20);
</span></span><span style="display:flex;"><span>  v22 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v23 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">20LL</span>) <span style="color:#f92672">+</span> v22;
</span></span><span style="display:flex;"><span>  v24 <span style="color:#f92672">=</span> (((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)(v21 <span style="color:#f92672">+</span> v18) <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">7</span>) <span style="color:#f92672">|</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)(v15 <span style="color:#f92672">+</span> v12))) <span style="color:#f92672">^</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v23);
</span></span><span style="display:flex;"><span>  i32_store8(<span style="color:#f92672">&amp;</span>w2c_memory, v23, v24);            <span style="color:#75715e">// x[b] ^= ROL((x[d] + x[a]), 1)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  v25 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v26 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">20LL</span>) <span style="color:#f92672">+</span> v25;
</span></span><span style="display:flex;"><span>  v27 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v26);
</span></span><span style="display:flex;"><span>  v28 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v29 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">24LL</span>) <span style="color:#f92672">+</span> v28;
</span></span><span style="display:flex;"><span>  v30 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v29);
</span></span><span style="display:flex;"><span>  v31 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v32 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">20LL</span>) <span style="color:#f92672">+</span> v31;
</span></span><span style="display:flex;"><span>  v33 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v32);
</span></span><span style="display:flex;"><span>  v34 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v35 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">24LL</span>) <span style="color:#f92672">+</span> v34;
</span></span><span style="display:flex;"><span>  v36 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v35);
</span></span><span style="display:flex;"><span>  v37 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v38 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">16LL</span>) <span style="color:#f92672">+</span> v37;
</span></span><span style="display:flex;"><span>  v39 <span style="color:#f92672">=</span> (((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)(v36 <span style="color:#f92672">+</span> v33) <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">6</span>) <span style="color:#f92672">|</span> (<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)(v30 <span style="color:#f92672">+</span> v27))) <span style="color:#f92672">^</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v38);
</span></span><span style="display:flex;"><span>  i32_store8(<span style="color:#f92672">&amp;</span>w2c_memory, v38, v39);            <span style="color:#75715e">// x[c] ^= ROL((x[a] + x[b]), 2)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  v40 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v41 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">16LL</span>) <span style="color:#f92672">+</span> v40;
</span></span><span style="display:flex;"><span>  v42 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v41);
</span></span><span style="display:flex;"><span>  v43 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v44 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">20LL</span>) <span style="color:#f92672">+</span> v43;
</span></span><span style="display:flex;"><span>  v45 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v44);
</span></span><span style="display:flex;"><span>  v46 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v47 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">16LL</span>) <span style="color:#f92672">+</span> v46;
</span></span><span style="display:flex;"><span>  v48 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v47);
</span></span><span style="display:flex;"><span>  v49 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v50 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">20LL</span>) <span style="color:#f92672">+</span> v49;
</span></span><span style="display:flex;"><span>  v51 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v50);
</span></span><span style="display:flex;"><span>  v52 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v53 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">12LL</span>) <span style="color:#f92672">+</span> v52;
</span></span><span style="display:flex;"><span>  v54 <span style="color:#f92672">=</span> (((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)(v51 <span style="color:#f92672">+</span> v48) <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">|</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)(v45 <span style="color:#f92672">+</span> v42))) <span style="color:#f92672">^</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v53);
</span></span><span style="display:flex;"><span>  i32_store8(<span style="color:#f92672">&amp;</span>w2c_memory, v53, v54);            <span style="color:#75715e">// x[d] ^= ROL((x[b] + x[c]), 3)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  v55 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v56 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">12LL</span>) <span style="color:#f92672">+</span> v55;
</span></span><span style="display:flex;"><span>  v57 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v56);
</span></span><span style="display:flex;"><span>  v58 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v59 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">16LL</span>) <span style="color:#f92672">+</span> v58;
</span></span><span style="display:flex;"><span>  v60 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v59);
</span></span><span style="display:flex;"><span>  v61 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v62 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">12LL</span>) <span style="color:#f92672">+</span> v61;
</span></span><span style="display:flex;"><span>  v63 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v62);
</span></span><span style="display:flex;"><span>  v64 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v65 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">16LL</span>) <span style="color:#f92672">+</span> v64;
</span></span><span style="display:flex;"><span>  v66 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v65);
</span></span><span style="display:flex;"><span>  v67 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>  v68 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">24LL</span>) <span style="color:#f92672">+</span> v67;
</span></span><span style="display:flex;"><span>  v69 <span style="color:#f92672">=</span> (((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)(v66 <span style="color:#f92672">+</span> v63) <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">4</span>) <span style="color:#f92672">|</span> (<span style="color:#ae81ff">16</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)(v60 <span style="color:#f92672">+</span> v57))) <span style="color:#f92672">^</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v68);
</span></span><span style="display:flex;"><span>  i32_store8(<span style="color:#f92672">&amp;</span>w2c_memory, v68, v69);            <span style="color:#75715e">// x[a] ^= ROL((x[c] + x[d]), 4)
</span></span></span></code></pre></div><p>这个东西套到 <code>salsa20</code> 的模板里就长这个样子</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">#define QUARTERROUND(x, a, b, c, d) \
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    x[b] ^= ROL(x[a] + x[d], 1); \
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    x[c] ^= ROL(x[b] + x[a], 2); \
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    x[d] ^= ROL(x[c] + x[b], 3); \
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    x[a] ^= ROL(x[d] + x[c], 4);
</span></span></span></code></pre></div><p>于是那个 while 循环就是这个</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">128</span>; i<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>    QUARTERROUND(v6<span style="color:#f92672">+</span><span style="color:#ae81ff">28LL</span>,  <span style="color:#ae81ff">0</span>,  <span style="color:#ae81ff">4</span>,  <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">12</span>);
</span></span><span style="display:flex;"><span>    QUARTERROUND(v6<span style="color:#f92672">+</span><span style="color:#ae81ff">28LL</span>,  <span style="color:#ae81ff">5</span>,  <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">13</span>,  <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    QUARTERROUND(v6<span style="color:#f92672">+</span><span style="color:#ae81ff">28LL</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">14</span>,  <span style="color:#ae81ff">2</span>,  <span style="color:#ae81ff">6</span>);
</span></span><span style="display:flex;"><span>    QUARTERROUND(v6<span style="color:#f92672">+</span><span style="color:#ae81ff">28LL</span>, <span style="color:#ae81ff">15</span>,  <span style="color:#ae81ff">3</span>,  <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">11</span>);
</span></span><span style="display:flex;"><span>    QUARTERROUND(v6<span style="color:#f92672">+</span><span style="color:#ae81ff">28LL</span>,  <span style="color:#ae81ff">0</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">2</span>,  <span style="color:#ae81ff">3</span>);
</span></span><span style="display:flex;"><span>    QUARTERROUND(v6<span style="color:#f92672">+</span><span style="color:#ae81ff">28LL</span>,  <span style="color:#ae81ff">5</span>,  <span style="color:#ae81ff">6</span>,  <span style="color:#ae81ff">7</span>,  <span style="color:#ae81ff">4</span>);
</span></span><span style="display:flex;"><span>    QUARTERROUND(v6<span style="color:#f92672">+</span><span style="color:#ae81ff">28LL</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">11</span>,  <span style="color:#ae81ff">8</span>,  <span style="color:#ae81ff">9</span>);
</span></span><span style="display:flex;"><span>    QUARTERROUND(v6<span style="color:#f92672">+</span><span style="color:#ae81ff">28LL</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">14</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>接下来看一下验证部分</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>      i32_store(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">8LL</span>, <span style="color:#ae81ff">0LL</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> ( (<span style="color:#66d9ef">int</span>)i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">8LL</span>) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">16</span> )
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        v30 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">32LL</span>);
</span></span><span style="display:flex;"><span>        v31 <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">20LL</span>);
</span></span><span style="display:flex;"><span>        v32 <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">8LL</span>) <span style="color:#f92672">+</span> v31;
</span></span><span style="display:flex;"><span>        v33 <span style="color:#f92672">=</span> w2c_f21(v30, v32);
</span></span><span style="display:flex;"><span>        v34 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v33);
</span></span><span style="display:flex;"><span>        v35 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>        v36 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">8LL</span>) <span style="color:#f92672">+</span> v35;
</span></span><span style="display:flex;"><span>        v55 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v36);
</span></span><span style="display:flex;"><span>        v37 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v55 <span style="color:#f92672">/</span> <span style="color:#ae81ff">16</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">3504LL</span>);
</span></span><span style="display:flex;"><span>        v38 <span style="color:#f92672">=</span> (v34 <span style="color:#f92672">!=</span> v37) <span style="color:#f92672">|</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">24LL</span>);
</span></span><span style="display:flex;"><span>        i32_store(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">24LL</span>, v38);
</span></span><span style="display:flex;"><span>        v39 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">32LL</span>);
</span></span><span style="display:flex;"><span>        v40 <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">20LL</span>);
</span></span><span style="display:flex;"><span>        v41 <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">8LL</span>) <span style="color:#f92672">+</span> v40;
</span></span><span style="display:flex;"><span>        v42 <span style="color:#f92672">=</span> w2c_f21(v39, v41 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        v43 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v42);
</span></span><span style="display:flex;"><span>        v44 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>        v45 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">8LL</span>) <span style="color:#f92672">+</span> v44;
</span></span><span style="display:flex;"><span>        v3 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v45) <span style="color:#f92672">%</span> <span style="color:#ae81ff">16</span>;
</span></span><span style="display:flex;"><span>        v46 <span style="color:#f92672">=</span> i32_load8_u(<span style="color:#f92672">&amp;</span>w2c_memory, v3 <span style="color:#f92672">+</span> <span style="color:#ae81ff">3504LL</span>);
</span></span><span style="display:flex;"><span>        v47 <span style="color:#f92672">=</span> (v43 <span style="color:#f92672">!=</span> v46) <span style="color:#f92672">|</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">24LL</span>);
</span></span><span style="display:flex;"><span>        i32_store(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">24LL</span>, v47);
</span></span><span style="display:flex;"><span>        v58 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">8LL</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        i32_store(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">8LL</span>, v58);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      v59 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">20LL</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span>;
</span></span><span style="display:flex;"><span>      i32_store(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">20LL</span>, v59);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    v48 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>);
</span></span><span style="display:flex;"><span>    w2c_free(v48);
</span></span><span style="display:flex;"><span>    v60 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">24LL</span>);
</span></span><span style="display:flex;"><span>    i32_store(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">44LL</span>, v60);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>LABEL_8:
</span></span><span style="display:flex;"><span>    i32_store(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">44LL</span>, <span style="color:#ae81ff">0xFFFFFFFFLL</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  v49 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">44LL</span>);
</span></span><span style="display:flex;"><span>  w2c_g0 <span style="color:#f92672">=</span> v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">48</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">--</span>wasm_rt_call_stack_depth;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> v49;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>很显然 <code>v6+44</code> 和 <code>v6+24</code> 就是判断是否通过验证的，只要每次 <code>(v43 != v46)</code> 和 <code>(v34 != v37)</code> 不成立就行</p>
<p>根据之前的经验，<code>v6+32</code> 是第三个参数（密文字符串地址），<code>v6+20</code> 是最外层循环的索引（每次 +8），<code>v6+8</code> 是这层循环的次数，<code>v6+28</code> 是上一个循环加密后的结果</p>
<p>于是把这个循环简化一下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> len(input); i<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">16</span>; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        v30 <span style="color:#f92672">=</span> a3;
</span></span><span style="display:flex;"><span>        v31 <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> i;
</span></span><span style="display:flex;"><span>        v32 <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> j <span style="color:#f92672">+</span> v31;
</span></span><span style="display:flex;"><span>        v33 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>v30[v32];
</span></span><span style="display:flex;"><span>        v34 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>v33;
</span></span><span style="display:flex;"><span>        v35 <span style="color:#f92672">=</span> cipher;
</span></span><span style="display:flex;"><span>        v36 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>cipher[i];
</span></span><span style="display:flex;"><span>        v55 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>v36;
</span></span><span style="display:flex;"><span>        v37 <span style="color:#f92672">=</span> loc_3504[v55 <span style="color:#f92672">/</span> <span style="color:#ae81ff">16</span>]; <span style="color:#75715e">// 3504 中存的是 0-9a-f
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        res <span style="color:#f92672">|=</span> (v34 <span style="color:#f92672">!=</span> v37);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 后半部分相似
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>再简化一下就是</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> strlen(input); i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">16</span>; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        v34 <span style="color:#f92672">=</span> a3[<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> j];
</span></span><span style="display:flex;"><span>        v37 <span style="color:#f92672">=</span> loc_3504[cipher[i] <span style="color:#f92672">/</span> <span style="color:#ae81ff">16</span>];
</span></span><span style="display:flex;"><span>        v43 <span style="color:#f92672">=</span> a3[<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        v46 <span style="color:#f92672">=</span> loc_3504[cipher[i] <span style="color:#f92672">%</span> <span style="color:#ae81ff">16</span>];
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">|=</span> (v34 <span style="color:#f92672">!=</span> v37) <span style="color:#f92672">|</span> (v43 <span style="color:#f92672">!=</span> v46);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>所以只需要让加密结果转 hex 后等于密文即可</p>
<p>同样的方法，翻译一下第一个 while 循环</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">8</span>; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    cipher[<span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> j] <span style="color:#f92672">=</span> input[i <span style="color:#f92672">+</span> j];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>于是想要找一下前八位是什么，发现</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>    v12 <span style="color:#f92672">=</span> i32_load(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">36LL</span>);
</span></span><span style="display:flex;"><span>    v13 <span style="color:#f92672">=</span> w2c_f20(v12);
</span></span><span style="display:flex;"><span>    i32_store(<span style="color:#f92672">&amp;</span>w2c_memory, v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">28LL</span>, v13);
</span></span></code></pre></div><p>于是猜是把第二个参数的前 8 字节存到了 cipher 的前 8 字节</p>
<p>这样就分析完了整个加密流程，每次取 8 字节明文，使用类似 <code>salsa</code> 加密的核心算法，生成的结果与 hexstring 进行比较</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdint.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define ROL(a,b) (((a) &lt;&lt; (b)) | ((a) &gt;&gt; (8 - (b))))
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define REQUARTERROUND(x, a, b, c, d) \
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    x[a] ^= ROL((x[d] + x[c]) &amp; 0xff, 4); \
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    x[d] ^= ROL((x[c] + x[b]) &amp; 0xff, 3); \
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    x[c] ^= ROL((x[b] + x[a]) &amp; 0xff, 2); \
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    x[b] ^= ROL((x[a] + x[d]) &amp; 0xff, 1); 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">decrypt</span>(<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> in){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">128</span>; i<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>        REQUARTERROUND(in, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">14</span>);
</span></span><span style="display:flex;"><span>        REQUARTERROUND(in, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">11</span>,  <span style="color:#ae81ff">8</span>,  <span style="color:#ae81ff">9</span>);
</span></span><span style="display:flex;"><span>        REQUARTERROUND(in,  <span style="color:#ae81ff">5</span>,  <span style="color:#ae81ff">6</span>,  <span style="color:#ae81ff">7</span>,  <span style="color:#ae81ff">4</span>);
</span></span><span style="display:flex;"><span>        REQUARTERROUND(in,  <span style="color:#ae81ff">0</span>,  <span style="color:#ae81ff">1</span>,  <span style="color:#ae81ff">2</span>,  <span style="color:#ae81ff">3</span>);
</span></span><span style="display:flex;"><span>        REQUARTERROUND(in, <span style="color:#ae81ff">15</span>,  <span style="color:#ae81ff">3</span>,  <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">11</span>);
</span></span><span style="display:flex;"><span>        REQUARTERROUND(in, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">14</span>,  <span style="color:#ae81ff">2</span>,  <span style="color:#ae81ff">6</span>);
</span></span><span style="display:flex;"><span>        REQUARTERROUND(in,  <span style="color:#ae81ff">5</span>,  <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">13</span>,  <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        REQUARTERROUND(in,  <span style="color:#ae81ff">0</span>,  <span style="color:#ae81ff">4</span>,  <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">12</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> enc[] <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">109u</span>, <span style="color:#ae81ff">191u</span>, <span style="color:#ae81ff">132u</span>, <span style="color:#ae81ff">247u</span>,  <span style="color:#ae81ff">60u</span>, <span style="color:#ae81ff">246u</span>, <span style="color:#ae81ff">161u</span>,  <span style="color:#ae81ff">18u</span>, 
</span></span><span style="display:flex;"><span>         <span style="color:#ae81ff">38u</span>, <span style="color:#ae81ff">139u</span>,   <span style="color:#ae81ff">9u</span>,  <span style="color:#ae81ff">82u</span>,  <span style="color:#ae81ff">94u</span>, <span style="color:#ae81ff">165u</span>,  <span style="color:#ae81ff">80u</span>, <span style="color:#ae81ff">166u</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">101u</span>, <span style="color:#ae81ff">226u</span>,  <span style="color:#ae81ff">28u</span>, <span style="color:#ae81ff">178u</span>, <span style="color:#ae81ff">227u</span>, <span style="color:#ae81ff">225u</span>,  <span style="color:#ae81ff">58u</span>, <span style="color:#ae81ff">247u</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">227u</span>, <span style="color:#ae81ff">234u</span>,  <span style="color:#ae81ff">14u</span>, <span style="color:#ae81ff">203u</span>,  <span style="color:#ae81ff">82u</span>, <span style="color:#ae81ff">245u</span>, <span style="color:#ae81ff">185u</span>, <span style="color:#ae81ff">205u</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">165u</span>, <span style="color:#ae81ff">182u</span>,  <span style="color:#ae81ff">82u</span>,  <span style="color:#ae81ff">43u</span>,  <span style="color:#ae81ff">30u</span>, <span style="color:#ae81ff">151u</span>, <span style="color:#ae81ff">135u</span>,  <span style="color:#ae81ff">52u</span>, 
</span></span><span style="display:flex;"><span>         <span style="color:#ae81ff">85u</span>,  <span style="color:#ae81ff">63u</span>,  <span style="color:#ae81ff">29u</span>, <span style="color:#ae81ff">121u</span>,  <span style="color:#ae81ff">86u</span>, <span style="color:#ae81ff">212u</span>, <span style="color:#ae81ff">175u</span>, <span style="color:#ae81ff">148u</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">191u</span>, <span style="color:#ae81ff">195u</span>, <span style="color:#ae81ff">244u</span>, <span style="color:#ae81ff">214u</span>, <span style="color:#ae81ff">140u</span>, <span style="color:#ae81ff">143u</span>, <span style="color:#ae81ff">186u</span>, <span style="color:#ae81ff">158u</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">238u</span>, <span style="color:#ae81ff">207u</span>,  <span style="color:#ae81ff">64u</span>,  <span style="color:#ae81ff">53u</span>,  <span style="color:#ae81ff">85u</span>,  <span style="color:#ae81ff">11u</span>, <span style="color:#ae81ff">145u</span>,   <span style="color:#ae81ff">6u</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">247u</span>,  <span style="color:#ae81ff">13u</span>,  <span style="color:#ae81ff">87u</span>, <span style="color:#ae81ff">209u</span>, <span style="color:#ae81ff">166u</span>, <span style="color:#ae81ff">205u</span>, <span style="color:#ae81ff">175u</span>,  <span style="color:#ae81ff">50u</span>, 
</span></span><span style="display:flex;"><span>         <span style="color:#ae81ff">17u</span>, <span style="color:#ae81ff">234u</span>, <span style="color:#ae81ff">170u</span>, <span style="color:#ae81ff">120u</span>, <span style="color:#ae81ff">215u</span>,  <span style="color:#ae81ff">26u</span>, <span style="color:#ae81ff">144u</span>,  <span style="color:#ae81ff">56u</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">183u</span>,  <span style="color:#ae81ff">27u</span>, <span style="color:#ae81ff">230u</span>,  <span style="color:#ae81ff">33u</span>,  <span style="color:#ae81ff">36u</span>,  <span style="color:#ae81ff">30u</span>, <span style="color:#ae81ff">139u</span>,  <span style="color:#ae81ff">96u</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">138u</span>,  <span style="color:#ae81ff">67u</span>, <span style="color:#ae81ff">177u</span>,   <span style="color:#ae81ff">7u</span>, <span style="color:#ae81ff">248u</span>, <span style="color:#ae81ff">134u</span>,  <span style="color:#ae81ff">15u</span>,  <span style="color:#ae81ff">84u</span>, 
</span></span><span style="display:flex;"><span>         <span style="color:#ae81ff">58u</span>, <span style="color:#ae81ff">176u</span>,  <span style="color:#ae81ff">24u</span>, <span style="color:#ae81ff">154u</span>, <span style="color:#ae81ff">160u</span>,  <span style="color:#ae81ff">99u</span>, <span style="color:#ae81ff">128u</span>,  <span style="color:#ae81ff">13u</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">228u</span>, <span style="color:#ae81ff">186u</span>, <span style="color:#ae81ff">231u</span>, <span style="color:#ae81ff">208u</span>, <span style="color:#ae81ff">177u</span>,  <span style="color:#ae81ff">16u</span>,  <span style="color:#ae81ff">69u</span>, <span style="color:#ae81ff">184u</span>
</span></span><span style="display:flex;"><span>    }; <span style="color:#75715e">// 先用 python 把 hexstring 转换回来
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">7</span>; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        decrypt(enc <span style="color:#f92672">+</span> i <span style="color:#f92672">*</span> <span style="color:#ae81ff">16</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">7</span>; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>; j <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">16</span>; j<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            printf(<span style="color:#e6db74">&#34;%c&#34;</span>, enc[<span style="color:#ae81ff">16</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> j]);
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="secconctf-2021qchecker">[SECCONCTF 2021]qchecker</h2>
<p>这道题是 ruby 混淆</p>
<p>程序的空格会拼成 SECCON 的字样</p>
<p>测试后发现错误的输入会让程序拼成 WRONG. 的字样</p>
<p>整理一下格式，理解程序</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>eval$uate<span style="color:#f92672">=</span><span style="color:#e6db74">%w(
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    a=%(eval$uate=%w(#{$uate})*&#34;&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Bftjarzs=b=-&gt;a{a.split(?+).map{|b|b.to_i(36)}};
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    c=b[&#34;awyiv4fjfkuu2pkv+awyiv4fvut716g3j+axce5e4pxrogszr3+5i0omfd5dm9xf9q7+axce5e4khrz21ypr+5htqqi9iasvmjri7+axcc76i03zrn7gu7+cbt4m8xybr3cb27+1ge6snjex10w3si9+1k8vdb4fzcys2yo0&#34;];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    d,e,f,g,h,i=b[&#34;0+0+zeexaxq012eg+k2htkr1olaj6+3cbp5mnkzllt3+2qpvamo605t7j&#34;];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    (j=eval(?A&lt;&lt;82&lt;&lt;71&lt;&lt;86)[0])
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &amp;&amp; d==0 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &amp;&amp; (
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        e+=1;k=2**64;l=-&gt;(a,b){(a-j.ord)*256.pow(b-2,b)%b};
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        f=l[f,k+13];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        g=l[g,k+37];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        h=l[h,k+51];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        i=l[i,k+81];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        j==?}&amp;&amp;(d=e==32&amp;&amp;f+g+h+i==0?2:1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        a.sub!(/&#34;0.*?&#34;/,&#39;&#34;0&#39;+[d,e,f,g,h,i].map{|x|x.to_s(36)}*?+&lt;&lt;34)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    );
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    srand(f);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    k=b[&#34;7acw+jsjm+46d84&#34;];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    l=d==2?7:6;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    m=[?#*(l*20)&lt;&lt;10]*11*&#34;&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    l.times{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        |a|b=d==0&amp;&amp;e!=0?rand(4):0;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        9.times{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            |e|9.times{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                |f|(c[k[d]/10**a%10]&gt;&gt;(e*9+f)&amp;1)!=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &amp;&amp;(
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    g=f;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    h=e;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    b.times{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        g,h=h,8-g
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    };
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    t=(h*l+l+a)*20+h+g*2+2;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    m[t]=m[t+1]=&#34;&#34;&lt;&lt;32
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                )
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    };
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    a.sub!(/B.*?=/,&#34;B=&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    n=m.count(?#)-a.length;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    a.sub!(&#34;B=&#34;,&#34;B#{(1..n).map{(rand(26)+97).chr}*&#34;&#34;}=&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    o=0;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    m.length.times{|b|m[b]==?#&amp;&amp;o&lt;a.length&amp;&amp;(m[b]=a[o];o+=1)};
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    puts(m)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">)</span> <span style="color:#f92672">*</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span></code></pre></div><p>先运行了几份代码做对比，发现区别仅在于 <code>d,e,f,g,h,i=b[];</code> 这一行，而且只有拼成 WRONG 的时候，d 才是 1，e 则不断自增，其余部分的程序完全一样，根据 <code>d==2?7:6;</code> 猜测，当 d 为 2 的时候正确，因为 SECCON 和 WRONG. 都是 6 个字符，完全符合 d 不为 2 的情况</p>
<p>根据这个猜测，<code>srand(f);</code> 以下的代码是负责控制空格样式的，和验证没有关系，不许管</p>
<p>我们需要关注的只有如下函数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>    d,e,f,g,h,i<span style="color:#f92672">=</span>b<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;0+0+zeexaxq012eg+k2htkr1olaj6+3cbp5mnkzllt3+2qpvamo605t7j&#34;</span><span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>    (j<span style="color:#f92672">=</span>eval(<span style="color:#e6db74">?A</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">82</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">71</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">86</span>)<span style="color:#f92672">[</span><span style="color:#ae81ff">0</span><span style="color:#f92672">]</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&amp;&amp;</span> d<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&amp;&amp;</span> (
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">+=</span><span style="color:#ae81ff">1</span>;k<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">64</span>;l<span style="color:#f92672">=-&gt;</span>(a,b){(a<span style="color:#f92672">-</span>j<span style="color:#f92672">.</span>ord)<span style="color:#f92672">*</span><span style="color:#ae81ff">256</span><span style="color:#f92672">.</span>pow(b<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>,b)<span style="color:#f92672">%</span>b};
</span></span><span style="display:flex;"><span>        f<span style="color:#f92672">=</span>l<span style="color:#f92672">[</span>f,k<span style="color:#f92672">+</span><span style="color:#ae81ff">13</span><span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>        g<span style="color:#f92672">=</span>l<span style="color:#f92672">[</span>g,k<span style="color:#f92672">+</span><span style="color:#ae81ff">37</span><span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>        h<span style="color:#f92672">=</span>l<span style="color:#f92672">[</span>h,k<span style="color:#f92672">+</span><span style="color:#ae81ff">51</span><span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>        i<span style="color:#f92672">=</span>l<span style="color:#f92672">[</span>i,k<span style="color:#f92672">+</span><span style="color:#ae81ff">81</span><span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>        j<span style="color:#f92672">==</span><span style="color:#e6db74">?}</span><span style="color:#f92672">&amp;&amp;</span>(d<span style="color:#f92672">=</span>e<span style="color:#f92672">==</span><span style="color:#ae81ff">32</span><span style="color:#f92672">&amp;&amp;</span>f<span style="color:#f92672">+</span>g<span style="color:#f92672">+</span>h<span style="color:#f92672">+</span>i<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span><span style="color:#f92672">?</span><span style="color:#ae81ff">2</span>:<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        a<span style="color:#f92672">.</span>sub!(<span style="color:#e6db74">/&#34;0.*?&#34;/</span>,<span style="color:#e6db74">&#39;&#34;0&#39;</span><span style="color:#f92672">+[</span>d,e,f,g,h,i<span style="color:#f92672">].</span>map{<span style="color:#f92672">|</span>x<span style="color:#f92672">|</span>x<span style="color:#f92672">.</span>to_s(<span style="color:#ae81ff">36</span>)}<span style="color:#f92672">*</span><span style="color:#e6db74">?+</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">34</span>)
</span></span><span style="display:flex;"><span>    );
</span></span></code></pre></div><p>根据测试 <code>j=eval(?A&lt;&lt;82&lt;&lt;71&lt;&lt;86)[0]</code> 是获取命令行参数，也就是当前传入的字符</p>
<p><code>l</code> 函数就是 <code>(a - ord(j)) * invmod(256) % b</code></p>
<p>把这个程序倒过来就是 <code>(a * 256 + ord(j)) % b</code></p>
<p>如果不考虑 <code>% b</code>，最后得到的就是类似 <code>n2s(flag[::-1])</code> 的效果</p>
<p>所以 <code>f, g, h, i</code> 的初值就是 <code>n2s(flag[::-1]) % (k+?)</code>，标准的中国剩余定理</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>a <span style="color:#f92672">=</span> [<span style="color:#ae81ff">4659461645708163688</span>, <span style="color:#ae81ff">2641556351334323346</span>, <span style="color:#ae81ff">15837377083725718695</span>, <span style="color:#ae81ff">12993509283917003551</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> [(<span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">64</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">13</span>) , (<span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">64</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">37</span>), (<span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">64</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">51</span>), (<span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">64</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">81</span>) ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gcd</span>(x, y):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> y <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        x, y <span style="color:#f92672">=</span> y, x <span style="color:#f92672">%</span> y
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> abs(x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ex_gcd</span>(x, y):
</span></span><span style="display:flex;"><span>    list_x <span style="color:#f92672">=</span> [x, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    list_y <span style="color:#f92672">=</span> [y, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> list_y[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        r <span style="color:#f92672">=</span> list_x[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">//</span> list_y[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">3</span>):
</span></span><span style="display:flex;"><span>            list_x[i] <span style="color:#f92672">-=</span> r <span style="color:#f92672">*</span> list_y[i]
</span></span><span style="display:flex;"><span>        list_x, list_y <span style="color:#f92672">=</span> list_y, list_x
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> list_x[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        list_x[<span style="color:#ae81ff">0</span>], list_x[<span style="color:#ae81ff">1</span>], list_x[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>list_x[<span style="color:#ae81ff">0</span>], <span style="color:#f92672">-</span>list_x[<span style="color:#ae81ff">1</span>], <span style="color:#f92672">-</span>list_x[<span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> list_x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">inverse</span>(a, n):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> n <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#34;n &lt; 2, error&#34;</span>)
</span></span><span style="display:flex;"><span>    g, x, y <span style="color:#f92672">=</span> ex_gcd(a, n)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> g <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;gcd(a, n) != 1, no inverse modular&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x <span style="color:#f92672">%</span> n
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ex_crt</span>(a, m, k):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, k):
</span></span><span style="display:flex;"><span>        t <span style="color:#f92672">=</span> gcd(m[i], m[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (a[i] <span style="color:#f92672">-</span> a[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]) <span style="color:#f92672">%</span> t <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        a[i] <span style="color:#f92672">=</span> (inverse(m[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">//</span> t, m[i] <span style="color:#f92672">//</span> t) <span style="color:#f92672">*</span> (a[i] <span style="color:#f92672">-</span> a[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]) <span style="color:#f92672">//</span> t) <span style="color:#f92672">%</span> (m[i] <span style="color:#f92672">//</span> t) <span style="color:#f92672">*</span> m[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> a[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        m[i] <span style="color:#f92672">=</span> m[i] <span style="color:#f92672">//</span> t <span style="color:#f92672">*</span> m[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        a[i] <span style="color:#f92672">=</span> (a[i] <span style="color:#f92672">%</span> m[i] <span style="color:#f92672">+</span> m[i]) <span style="color:#f92672">%</span> m[i]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> a[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> libnum <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>n2s(ex_crt(a, m, <span style="color:#ae81ff">4</span>))[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># b&#39;SECCON{L3t5_wr1t3_y0ur_Qu1n3!!!}&#39;</span>
</span></span></code></pre></div><h2 id="idekreverseme">[idek]reverseme</h2>
<p>源程序是</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;math.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span><span style="color:#f92672">**</span> argv) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(argc <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span>){
</span></span><span style="display:flex;"><span>        printf(<span style="color:#e6db74">&#34;Usage: ./reverseme password</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(strlen(argv[<span style="color:#ae81ff">1</span>])<span style="color:#f92672">!=</span><span style="color:#ae81ff">14</span>){
</span></span><span style="display:flex;"><span>        printf(<span style="color:#e6db74">&#34;Incorrect Length</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">*</span>argv[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">!=</span> <span style="color:#ae81ff">112</span>){<span style="color:#75715e">//Not enough precision
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        printf(<span style="color:#e6db74">&#34;Password Incorrect</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> magic_numbers[<span style="color:#ae81ff">7</span>] <span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">-</span><span style="color:#ae81ff">68822144.50341525673866271972656250000000000000000000000000</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">56777293.39031631499528884887695312500000000000000000000000</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">-</span><span style="color:#ae81ff">3274524.75536667229607701301574707031250000000000000000000</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">-</span><span style="color:#ae81ff">85761.51255339206545613706111907958984375000000000000000</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">8443.33244327564352715853601694107055664062500000000000</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">-</span><span style="color:#ae81ff">166.67369627952575683593750000000000000000000000000000</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">1.00000000000000000000000000000000000000000000000000</span>, 
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">6</span>;i<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> foo<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0</span>,bar<span style="color:#f92672">=</span><span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> j<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;j<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">7</span>;j<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>            bar <span style="color:#f92672">+=</span> magic_numbers[j] <span style="color:#f92672">*</span> foo;
</span></span><span style="display:flex;"><span>            foo <span style="color:#f92672">*=</span> (<span style="color:#66d9ef">float</span>)log(<span style="color:#f92672">*</span>(<span style="color:#66d9ef">float</span><span style="color:#f92672">*</span>)((<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span>)argv[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>i));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#ae81ff">100000</span><span style="color:#f92672">*</span>bar) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>){
</span></span><span style="display:flex;"><span>            printf(<span style="color:#e6db74">&#34;Password Incorrect</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;Password Correct</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>相同的六次方程，分别带入 <code>flag[0:4], flag[2:6], flag[4:8]...</code>，知道第一位，于是考虑直接爆破</p>
<p>先修改一下源代码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;math.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span><span style="color:#f92672">**</span> argv) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(argc <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span>){
</span></span><span style="display:flex;"><span>        printf(<span style="color:#e6db74">&#34;Usage: ./reverseme password</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// if(strlen(argv[1])!=14){
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//     printf(&#34;Incorrect Length\n&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//     return 1;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// if(*argv[1] != 112){//Not enough precision
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//     printf(&#34;Password Incorrect\n&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//     return 1;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">double</span> magic_numbers[<span style="color:#ae81ff">7</span>] <span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">-</span><span style="color:#ae81ff">68822144.50341525673866271972656250000000000000000000000000</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">56777293.39031631499528884887695312500000000000000000000000</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">-</span><span style="color:#ae81ff">3274524.75536667229607701301574707031250000000000000000000</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">-</span><span style="color:#ae81ff">85761.51255339206545613706111907958984375000000000000000</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">8443.33244327564352715853601694107055664062500000000000</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">-</span><span style="color:#ae81ff">166.67369627952575683593750000000000000000000000000000</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">1.00000000000000000000000000000000000000000000000000</span>, 
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// for(int i = 0; i &lt; 6;i++){
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> foo<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0</span>,bar<span style="color:#f92672">=</span><span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> j<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;j<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">7</span>;j<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>            bar <span style="color:#f92672">+=</span> magic_numbers[j] <span style="color:#f92672">*</span> foo;
</span></span><span style="display:flex;"><span>            foo <span style="color:#f92672">*=</span> (<span style="color:#66d9ef">float</span>)log(<span style="color:#f92672">*</span>(<span style="color:#66d9ef">float</span><span style="color:#f92672">*</span>)((<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span>)argv[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>i));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#ae81ff">100000</span><span style="color:#f92672">*</span>bar) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>){
</span></span><span style="display:flex;"><span>            printf(<span style="color:#e6db74">&#34;Password Incorrect</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    printf(<span style="color:#e6db74">&#34;Password Correct</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>然后 python 脚本进行爆破</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> string
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> subprocess
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>charset <span style="color:#f92672">=</span> string<span style="color:#f92672">.</span>ascii_letters <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>digits <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;!@#$%^_&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pre = &#39;p&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># for a in charset:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     for b in charset:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         for c in charset:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             command = &#34;./reverseme_1 p&#34; + a + b + c</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             output = subprocess.check_output(command, shell=True, stderr=subprocess.PIPE)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             if b&#34;Correct&#34; in output:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#                 print (&#34;p&#34; + a + b + c)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pre <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;zf&#34;</span>  <span style="color:#75715e"># 每次修改一下 pre 就可以进行爆破了</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pfTw</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pLzf zfTw</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># p0%Y %Yn@ n@M1 M1aL aLzf zfTw</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># p@M1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> a <span style="color:#f92672">in</span> charset:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> b <span style="color:#f92672">in</span> charset:
</span></span><span style="display:flex;"><span>        command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./reverseme_1 &#34;</span> <span style="color:#f92672">+</span> pre <span style="color:#f92672">+</span> a <span style="color:#f92672">+</span> b
</span></span><span style="display:flex;"><span>        output <span style="color:#f92672">=</span> subprocess<span style="color:#f92672">.</span>check_output(command, shell<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, stderr<span style="color:#f92672">=</span>subprocess<span style="color:#f92672">.</span>PIPE)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Correct&#34;</span> <span style="color:#f92672">in</span> output:
</span></span><span style="display:flex;"><span>            print (pre <span style="color:#f92672">+</span> a <span style="color:#f92672">+</span> b)
</span></span></code></pre></div><p>上面用来爆破 <code>p</code> 开头的，共有四种可能，依次爆破就行</p>
<p>最后得到 flag: <code>p0%Yn@M1aLzfTw</code></p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/ctf/">CTF</a>
        
            <a href="/tags/reverse/">Reverse</a>
        
            <a href="/tags/writeup/">Writeup</a>
        
            <a href="/tags/mtctf/">MTCTF</a>
        
            <a href="/tags/secconctf/">SECCONCTF</a>
        
            <a href="/tags/idek/">idek</a>
        
            <a href="/tags/wasm/">wasm</a>
        
            <a href="/tags/pintool/">Pintool</a>
        
            <a href="/tags/heavensgate/">HeavensGate</a>
        
            <a href="/tags/movfuscator/">movfuscator</a>
        
            <a href="/tags/python/">Python</a>
        
    </section>


    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css"integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8"crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"integrity="sha384-vZTG03m&#43;2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"crossorigin="anonymous"
                defer="true"
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">Related contents</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="">
    <a href="/post/learn-basic-signal-from-dnuictf-easyre/">
        
        

        <div class="article-details">
            <h2 class="article-title">Learn Basic Signal from DNUICTF easyre</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/post/tsgctf2021-and-pbctf2021-re-writeups/">
        
        
            <div class="article-image">
                <img src="/post/tsgctf2021-and-pbctf2021-re-writeups/cover.c7c17abeb45c9112c1241b6b02c9d70b_hu1d6e6a8c7a63b9144fd12b4cc4fa1275_1804782_250x150_fill_q75_box_smart1.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post TSGCTF2021 and pbctf2021 RE writeups"
                        
                        data-hash="md5-x8F6vrRckRLBJBtrAsnXCw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">TSGCTF2021 and pbctf2021 RE writeups</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/post/dragonctf-runofthemill-writeup/">
        
        

        <div class="article-details">
            <h2 class="article-title">DragonCTF Runofthemill Writeup</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/post/resent-re-challenge/">
        
        

        <div class="article-details">
            <h2 class="article-title">Resent RE Challenge</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/post/dasctf-2021-09-writeup/">
        
        

        <div class="article-details">
            <h2 class="article-title">DASCTF 2021-09 Writeup</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy;
        
        2024 s0uthwood&#39;s Blog
    
        
            <br />
            已运行 <i class="fas fa-bell"></i> <a id="days">0</a> 天
        
    
        
            &nbsp;&nbsp;
            
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
            
            ⌨&nbsp;
            86.36k&nbsp;
            字
            &nbsp;&nbsp;
            🧠&nbsp;
            38&nbsp;
            篇文章
        
    </section>

    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.5.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>

    
        <script>
            var s1 = "2020-11-15";
            s1 = new Date(s1.replace(/-/g, "/"));
            s2 = new Date();
            var days = s2.getTime() - s1.getTime();
            var number_of_days = parseInt(days / (1000 * 60 * 60 * 24));
            document.getElementById('days').innerHTML = number_of_days;
        </script>
    
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">Table of contents</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#mtctf-4thwow">[MTCTF 4th]wow</a></li>
    <li><a href="#mtctf-4thsuperflat">[MTCTF 4th]Superflat</a></li>
    <li><a href="#secconctf-2021dis-me">[SECCONCTF 2021]dis-me</a></li>
    <li><a href="#secconctf-2021flag">[SECCONCTF 2021]flag</a></li>
    <li><a href="#secconctf-2021qchecker">[SECCONCTF 2021]qchecker</a></li>
    <li><a href="#idekreverseme">[idek]reverseme</a></li>
  </ul>
</nav>
                </div>
            </section>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
