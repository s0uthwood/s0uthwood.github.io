<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='Quiz from bzb å‰è¨€&amp;amp;é¢˜ç›® å‰æ®µæ—¶é—´å­¦ä¹ ä¿¡å®‰æ•°åŸºï¼ŒåŠ©æ•™å­¦é•¿å°±é…å¥—å‡ºäº†é“Quizï¼Œæ¥ç»™æˆ‘ä»¬ç»ƒæ‰‹ã€‚
å…ˆä¸Šé¢˜ç›®
import math from AITMCLab.Crypto.Util.number import long_to_bytes from AITMCLab.Crypto.Util.number import bytes_to_long from AITMCLab.Crypto.Util.number import getRandomNBitInteger from AITMCLab.Crypto.Util.number import getPrime from AITMCLab.Crypto.Util.number import isPrime from AITMCLab.Crypto.Util.number import inverse from secret import flag def nextPrime(n): n &#43;= 2 if n &amp;amp; 1 else 1 while not isPrime(n): n &#43;= 2 return n def init(S, K): j = 0 k = [] K = list(K) for i in range(len(K)): K[i] = ord(K[i]) for i in range(256): S.'><title>AITMC-challenge</title>

<link rel='canonical' href='/post/aitmc-challenge/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='AITMC-challenge'>
<meta property='og:description' content='Quiz from bzb å‰è¨€&amp;amp;é¢˜ç›® å‰æ®µæ—¶é—´å­¦ä¹ ä¿¡å®‰æ•°åŸºï¼ŒåŠ©æ•™å­¦é•¿å°±é…å¥—å‡ºäº†é“Quizï¼Œæ¥ç»™æˆ‘ä»¬ç»ƒæ‰‹ã€‚
å…ˆä¸Šé¢˜ç›®
import math from AITMCLab.Crypto.Util.number import long_to_bytes from AITMCLab.Crypto.Util.number import bytes_to_long from AITMCLab.Crypto.Util.number import getRandomNBitInteger from AITMCLab.Crypto.Util.number import getPrime from AITMCLab.Crypto.Util.number import isPrime from AITMCLab.Crypto.Util.number import inverse from secret import flag def nextPrime(n): n &#43;= 2 if n &amp;amp; 1 else 1 while not isPrime(n): n &#43;= 2 return n def init(S, K): j = 0 k = [] K = list(K) for i in range(len(K)): K[i] = ord(K[i]) for i in range(256): S.'>
<meta property='og:url' content='/post/aitmc-challenge/'>
<meta property='og:site_name' content='s0uthwood&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Crypto' /><meta property='article:tag' content='Labs' /><meta property='article:published_time' content='2020-12-09T23:27:25&#43;00:00'/><meta property='article:modified_time' content='2020-12-09T23:27:25&#43;00:00'/>
<meta name="twitter:title" content="AITMC-challenge">
<meta name="twitter:description" content="Quiz from bzb å‰è¨€&amp;amp;é¢˜ç›® å‰æ®µæ—¶é—´å­¦ä¹ ä¿¡å®‰æ•°åŸºï¼ŒåŠ©æ•™å­¦é•¿å°±é…å¥—å‡ºäº†é“Quizï¼Œæ¥ç»™æˆ‘ä»¬ç»ƒæ‰‹ã€‚
å…ˆä¸Šé¢˜ç›®
import math from AITMCLab.Crypto.Util.number import long_to_bytes from AITMCLab.Crypto.Util.number import bytes_to_long from AITMCLab.Crypto.Util.number import getRandomNBitInteger from AITMCLab.Crypto.Util.number import getPrime from AITMCLab.Crypto.Util.number import isPrime from AITMCLab.Crypto.Util.number import inverse from secret import flag def nextPrime(n): n &#43;= 2 if n &amp;amp; 1 else 1 while not isPrime(n): n &#43;= 2 return n def init(S, K): j = 0 k = [] K = list(K) for i in range(len(K)): K[i] = ord(K[i]) for i in range(256): S.">
    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="/" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>Back</span>
            </a>
        </div>
    
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/labs/" >
                Labs
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/post/aitmc-challenge/">AITMC-challenge</a>
    </h2>

    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Dec 09, 2020</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-pencil" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#9e9e9e" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <path d="M4 20h4L18.5 9.5a1.5 1.5.0 00-4-4L4 16v4"></path>
    <line x1="13.5" y1="6.5" x2="17.5" y2="10.5"></line>
</svg>
                <time class="article-words">
                    1070 words
                </time>
            </div>
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    6 minute read
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <h2 id="quiz-from-bzb">Quiz from bzb</h2>
<h3 id="å‰è¨€é¢˜ç›®">å‰è¨€&amp;é¢˜ç›®</h3>
<p>å‰æ®µæ—¶é—´å­¦ä¹ ä¿¡å®‰æ•°åŸºï¼ŒåŠ©æ•™å­¦é•¿å°±é…å¥—å‡ºäº†é“Quizï¼Œæ¥ç»™æˆ‘ä»¬ç»ƒæ‰‹ã€‚</p>
<p>å…ˆä¸Šé¢˜ç›®</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> math
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> AITMCLab.Crypto.Util.number <span style="color:#f92672">import</span> long_to_bytes
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> AITMCLab.Crypto.Util.number <span style="color:#f92672">import</span> bytes_to_long
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> AITMCLab.Crypto.Util.number <span style="color:#f92672">import</span> getRandomNBitInteger
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> AITMCLab.Crypto.Util.number <span style="color:#f92672">import</span> getPrime
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> AITMCLab.Crypto.Util.number <span style="color:#f92672">import</span> isPrime
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> AITMCLab.Crypto.Util.number <span style="color:#f92672">import</span> inverse
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> secret <span style="color:#f92672">import</span> flag
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">nextPrime</span>(n):
</span></span><span style="display:flex;"><span>    n <span style="color:#f92672">+=</span> <span style="color:#ae81ff">2</span> <span style="color:#66d9ef">if</span> n <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#f92672">not</span> isPrime(n):
</span></span><span style="display:flex;"><span>        n <span style="color:#f92672">+=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> n
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">init</span>(S, K):
</span></span><span style="display:flex;"><span>    j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    k <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    K <span style="color:#f92672">=</span> list(K)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(K)):
</span></span><span style="display:flex;"><span>        K[i] <span style="color:#f92672">=</span> ord(K[i])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">256</span>):
</span></span><span style="display:flex;"><span>        S<span style="color:#f92672">.</span>append(i)
</span></span><span style="display:flex;"><span>        k<span style="color:#f92672">.</span>append(K[i <span style="color:#f92672">%</span> len(K)])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">256</span>):
</span></span><span style="display:flex;"><span>        j <span style="color:#f92672">=</span> (j <span style="color:#f92672">+</span> S[i] <span style="color:#f92672">+</span> k[i]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>        S[i], S[j] <span style="color:#f92672">=</span> S[j], S[i]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">Encrypt</span>(key, D):
</span></span><span style="display:flex;"><span>    S<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>    init(S, key)
</span></span><span style="display:flex;"><span>    i <span style="color:#f92672">=</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> a <span style="color:#f92672">in</span> D:
</span></span><span style="display:flex;"><span>        a <span style="color:#f92672">=</span> ord(a)
</span></span><span style="display:flex;"><span>        i <span style="color:#f92672">=</span> (i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>        j <span style="color:#f92672">=</span> (j <span style="color:#f92672">+</span> S[i]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>        S[i], S[j] <span style="color:#f92672">=</span> S[j], S[i]
</span></span><span style="display:flex;"><span>        k <span style="color:#f92672">=</span> chr(a <span style="color:#f92672">^</span> S[(S[i] <span style="color:#f92672">+</span> S[j]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>])
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">+=</span> k
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> result
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">Decrypt</span>(key, D):
</span></span><span style="display:flex;"><span>    S <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    init(S, key)
</span></span><span style="display:flex;"><span>    i <span style="color:#f92672">=</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> a <span style="color:#f92672">in</span> D:
</span></span><span style="display:flex;"><span>        a <span style="color:#f92672">=</span> ord(a)
</span></span><span style="display:flex;"><span>        i <span style="color:#f92672">=</span> (i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>        j <span style="color:#f92672">=</span> (j <span style="color:#f92672">+</span> S[i]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>        S[i], S[j] <span style="color:#f92672">=</span> S[j], S[i]
</span></span><span style="display:flex;"><span>        k <span style="color:#f92672">=</span> chr(a <span style="color:#f92672">^</span> S[(S[i] <span style="color:#f92672">+</span> S[j]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>])
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">+=</span> k
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> result
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    key <span style="color:#f92672">=</span> long_to_bytes(getRandomNBitInteger(<span style="color:#ae81ff">100</span>))
</span></span><span style="display:flex;"><span>    print <span style="color:#e6db74">&#39;key =&#39;</span>, bytes_to_long(key)
</span></span><span style="display:flex;"><span>    e <span style="color:#f92672">=</span> getPrime(<span style="color:#ae81ff">512</span>)
</span></span><span style="display:flex;"><span>    print <span style="color:#e6db74">&#39;e =&#39;</span>, e
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    E <span style="color:#f92672">=</span> nextPrime(e)
</span></span><span style="display:flex;"><span>    f <span style="color:#f92672">=</span> math<span style="color:#f92672">.</span>factorial(e) <span style="color:#f92672">%</span> E
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    d <span style="color:#f92672">=</span> long_to_bytes(f)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    c1 <span style="color:#f92672">=</span> bytes_to_long(Encrypt(key, d))
</span></span><span style="display:flex;"><span>    print <span style="color:#e6db74">&#39;c1 =&#39;</span>, c1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    c2 <span style="color:#f92672">=</span> bytes_to_long(Encrypt(key, flag))
</span></span><span style="display:flex;"><span>    print <span style="color:#e6db74">&#39;c2 =&#39;</span>, c2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># e = 11248112333656902878308992204660514716130692202019193081806766887380465145401754698746718075268681481388695805324253817155823465013590321091178897918430457</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># c1 = 11792816667683654209610238149228683194178884298019505853565076663183883681365400495420305428570416004628438524072440231323696408946395141935772862600031614</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># c2 = 81946333492800053045881242964212560642046177081574600318494251620269838444004879162713842</span>
</span></span></code></pre></div><h3 id="æ€è·¯">æ€è·¯</h3>
<p>é¦–å…ˆé˜…è¯»ä¸»å‡½æ•°éƒ¨åˆ†ï¼Œæ˜¾ç„¶è¿™é“é¢˜éœ€è¦å…ˆé€šè¿‡e, Eæ±‚è§£fï¼Œä»¥æ­¤å¾—åˆ°dï¼Œéšåå†åˆ©ç”¨d, c1, c2æ¥æ±‚è§£flagã€‚</p>
<h4 id="æ±‚è§£f">æ±‚è§£f</h4>
<p>é¢˜ç›®ä¸­çš„ $f=e!\mathrm{mod} E$ ï¼Œä½†ç”±äº e è¿‡å¤§ï¼Œæ˜¾ç„¶æ— æ³•ç›´æ¥è®¡ç®—å¾—åˆ°ã€‚è§‚å¯Ÿå‘ç°ï¼Œ$e!$ å½“ä¸­çš„ç»å¤§å¤šæ•°éƒ¨åˆ†å¯ä»¥ä¸¤ä¸¤é…å¯¹ç»„æˆæ¨¡ $E$ çš„é€†å…ƒï¼Œå› æ­¤çŒœæµ‹å¯èƒ½å­˜åœ¨ç±»ä¼¼äº $(E-1)!\equiv 1\ (\mathrm{mod}\ E)$ çš„è§„å¾‹ï¼Œå¦‚æœæ»¡è¶³è¿™ä¸ªè§„å¾‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è®¡ç®— $\prod\limits_{i=e+1}^{E-1}i\ (\mathrm{mod}\ E)$ çš„é€†å…ƒå¾—åˆ°fã€‚</p>
<p>ç»è¿‡å‡ æ¬¡ç®€å•çš„æ£€éªŒï¼ŒçŒœæµ‹è§„å¾‹ä¸º $(E-2)!\equiv 1\ (\mathrm{mod}\ E)$ ï¼ˆåå¾—çŸ¥ä¸ºWilsonå®šç†ï¼Œå½“æ—¶è¿˜æ²¡å­¦&hellip;ï¼‰ï¼Œå› æ­¤åªéœ€è¦è®¡ç®—$tmp\equiv \prod\limits_{i=e+1}^{E-2}i\ (\mathrm{mod}\ E),\ f\cdot tmp\equiv 1\ (\mathrm{mod}\ E)$ å³å¯å¾—åˆ° $f$ã€‚</p>
<h4 id="æ±‚è§£flag">æ±‚è§£flag</h4>
<p>å¾—åˆ°äº† f åï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨ <code>long_to_bytes(f)</code> æ¥å¾—åˆ° d ã€‚ä¸ºæ±‚è§£ flagï¼Œåˆæ­¥è®¾æƒ³ä¸ºåˆ©ç”¨åŠ å¯†å‡½æ•°æ±‚è§£ keyï¼Œéšåç›´æ¥åˆ©ç”¨è§£å¯†å‡½æ•°æ±‚è§£ flagã€‚é˜…è¯» <code>Encrypt</code> å‡½æ•°å’Œ <code>Decrypt</code> å‡½æ•°åå‘ç°åŠ è§£å¯†å‡½æ•°å®Œå…¨ä¸€è‡´ï¼Œä¸”å®é™…çš„åŠ è§£å¯†è¿‡ç¨‹åªæœ‰å¼‚æˆ–è¿ç®—ï¼Œè¯´æ˜ d åˆ° c1 çš„è¿ç®—æ­¥éª¤ä¸ flag åˆ° c2 çš„è¿ç®—æ­¥éª¤å®Œå…¨ç›¸åŒä¸”å¯é€†ï¼Œå› æ­¤æ±‚è§£æ—¶æ²¡å¿…è¦æ±‚å‡º keyã€‚è¿›ä¸€æ­¥åˆ†æåå‘ç°åŠ å¯†ç®—æ³•å¤§è‡´æ˜¯å°† key è½¬åŒ–æˆæŸä¸ªå›ºå®šçš„æ•°ç»„ï¼Œå¹¶ä¸æ˜æ–‡ä¾æ¬¡è¿›è¡Œå¼‚æˆ–è¿ç®—å¾—åˆ°å¯†æ–‡ï¼Œä¹Ÿå°±æ˜¯è¯´ç»è¿‡äº† init å‡½æ•°å’Œå¤šæ¬¡äº¤æ¢ä½ç½®ï¼ˆäº¤æ¢çš„æ¬¡åºä¹Ÿæ˜¯å›ºå®šçš„ï¼‰åçš„æ•°åˆ—æ‰æ˜¯çœŸæ­£çš„å¯†é’¥ã€‚</p>
<p>å› æ­¤ï¼Œåªéœ€è¦å°† c1, c2 å’Œ d è½¬æ¢æˆ bytesï¼Œç„¶åå¯¹æ¯ä¸€ä½å– <code>ord</code> åè¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œç»„æˆçš„æ•°å­—å– <code>chr</code> ååŠ åˆ°ç­”æ¡ˆå­—ç¬¦ä¸²åé¢ï¼Œå³å¯å¾—åˆ° flagã€‚</p>
<h3 id="exp">exp</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> math
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> AITMCLab.libnum.modular <span style="color:#f92672">import</span> invmod
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> AITMCLab.Crypto.Util.number <span style="color:#f92672">import</span> long_to_bytes
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> AITMCLab.Crypto.Util.number <span style="color:#f92672">import</span> bytes_to_long
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> AITMCLab.Crypto.Util.number <span style="color:#f92672">import</span> isPrime
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">nextPrime</span>(n):
</span></span><span style="display:flex;"><span>    n <span style="color:#f92672">+=</span> <span style="color:#ae81ff">2</span> <span style="color:#66d9ef">if</span> n <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#f92672">not</span> isPrime(n):
</span></span><span style="display:flex;"><span>        n <span style="color:#f92672">+=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> n
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    e <span style="color:#f92672">=</span> <span style="color:#ae81ff">11248112333656902878308992204660514716130692202019193081806766887380465145401754698746718075268681481388695805324253817155823465013590321091178897918430457</span>
</span></span><span style="display:flex;"><span>    c1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">5120829596353532760839054347975234579355835073413768618360492980516438193909447500996222328143719619379838946544412967584025416378147246422705451415437468</span>
</span></span><span style="display:flex;"><span>    c2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">17985907282297772406857113433926323639543183645704827789984971602150950301590677893419082</span>
</span></span><span style="display:flex;"><span>    E <span style="color:#f92672">=</span> nextPrime(e)
</span></span><span style="display:flex;"><span>    f_1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    i <span style="color:#f92672">=</span> e <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> i <span style="color:#f92672">&lt;</span> E <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        f_1 <span style="color:#f92672">*=</span> i
</span></span><span style="display:flex;"><span>        f_1 <span style="color:#f92672">%=</span> E
</span></span><span style="display:flex;"><span>        i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    f <span style="color:#f92672">=</span> invmod(f_1, E)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ä»¥ä¸Šä¸ºæ±‚è§£fçš„è¿‡ç¨‹</span>
</span></span><span style="display:flex;"><span>    d <span style="color:#f92672">=</span> long_to_bytes(f)
</span></span><span style="display:flex;"><span>    c1_bytes <span style="color:#f92672">=</span> long_to_bytes(c1)
</span></span><span style="display:flex;"><span>    c2_bytes <span style="color:#f92672">=</span> lone_to_bytes(c2)
</span></span><span style="display:flex;"><span>    flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(c2_bytes)):
</span></span><span style="display:flex;"><span>        flag <span style="color:#f92672">+=</span> chr(ord(c2_bytes[i]) <span style="color:#f92672">^</span> ord(c1_bytes[i]) <span style="color:#f92672">^</span> ord(d[i]))
</span></span><span style="display:flex;"><span>    print flag
</span></span><span style="display:flex;"><span><span style="color:#75715e"># flag{Congratulation!_quiz1_passed!!!}</span>
</span></span></code></pre></div><h2 id="das2020-aprilnot-rsa">[DAS2020 April]not RSA</h2>
<h3 id="é¢˜ç›®">é¢˜ç›®</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> AITMCLab.libnum <span style="color:#f92672">import</span> gcd, invmod, s2n
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> isPrime
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> secret <span style="color:#f92672">import</span> flag
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">104879397075344024438671231239628115011303349344697797964879592144922079000957</span> 
</span></span><span style="display:flex;"><span>q <span style="color:#f92672">=</span> <span style="color:#ae81ff">104879397075344024438671231239628115011303349344697797964879592144922079001013</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">assert</span> isPrime(p) <span style="color:#f92672">and</span> isPrime(q)
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> p <span style="color:#f92672">*</span> q
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> s2n(flag)
</span></span><span style="display:flex;"><span>r <span style="color:#f92672">=</span> randint(<span style="color:#ae81ff">1</span>, n)
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> (pow(n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, flag, n <span style="color:#f92672">*</span> n) <span style="color:#f92672">*</span> pow(r, n, n <span style="color:#f92672">*</span> n)) <span style="color:#f92672">%</span> (n <span style="color:#f92672">*</span> n)
</span></span><span style="display:flex;"><span>print c
</span></span><span style="display:flex;"><span><span style="color:#75715e"># c = 13134489820394613222282607681686272081419875146946401883172682167011759113388373349180457979897848113275982219264879081189886853062717764580364698888338032141434053832247476010400449272010082460437747190468766740274587999336359171283098137261396013153130265440425676242061845667887640808895666325466803989428</span>
</span></span></code></pre></div><h3 id="æ€è·¯-1">æ€è·¯</h3>
<p>ä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯é“çº¯æ•°å­¦é¢˜</p>
<p>ç”±æºç ï¼š</p>
<p>$c\equiv (n+1)^f\cdot r^n\ (\mathrm{mod}\ n^2)$</p>
<p>æ ¹æ®äºŒé¡¹å¼å®šç†ï¼š</p>
<p>$c\equiv (fn+1)\cdot r^n\ (mod\ n^2)$</p>
<p>å·¦å³ä¸¤å¼åŒä¹˜ $\varphi(n)$ æ¬¡æ–¹ï¼Œå¾— $c^{\varphi(n)}\equiv (fn+1)^{\varphi(n)}\cdot r^{n\varphi(n)}\ (mod\ n^2)$</p>
<p>ç”± $\varphi(n^2)=n\cdot \varphi(n)$ ä¸”å½“ $r\neq p$ æˆ– $r\neq q$ æ—¶æœ‰ï¼Œ$gcd(r,n)=1$ å¯çŸ¥ï¼Œ$r^{n\varphi(n)}\equiv 1\ (mod\ n^2)$ï¼Œå¯å¾—ï¼š</p>
<p>$c^{\varphi(n)}\equiv (fn+1)^{\varphi(n)}\ (mod\ n^2)$</p>
<p>å› ä¸º r ä¸ºéšæœºæ•°ï¼Œæ‰€ä»¥ $r\neq p,q$ çš„æ¦‚ç‡ä¸º $\dfrac{2}{n}$ï¼Œå¯è®¤ä¸º $gcd(r,n)=1$ æˆç«‹ã€‚</p>
<p>å†æ¬¡ä½¿ç”¨äºŒæ¬¡é¡¹å®šç†ï¼Œå¯å¾— $c^{\varphi(n)}\equiv fn\varphi(n)+1\ (mod\ n^2)$</p>
<p>ç”±è´¹æ›¼å°å®šç†å¯çŸ¥ $c^{\varphi(n)}\equiv 1\ (mod\ n)$ï¼Œå³ $n|c^{\varphi(n)}-1$ï¼Œå› æ­¤å°†1ç§»åˆ°åŒä½™å¼å·¦è¾¹å¹¶å¯¹åŒä½™å¼åŒé™¤nï¼Œå¾—ï¼š</p>
<p>$\dfrac{c^{\varphi(n)}-1}{n}\equiv f\varphi(n)\ (mod\ n)$</p>
<p>å¯¹äºå·¦å¼ï¼Œè®¾ $\dfrac{c^{\varphi(n)}-1}{n}=kn+r'$</p>
<p>$c^{\varphi(n)}=kn^2+rn+1$</p>
<p>åªéœ€æ±‚è§£å‡º $rn+1$ å³å¯ï¼Œå› æ­¤å¯ä»¥å¯¹ $c^{\varphi(n)}$ è¿›è¡Œæ¨¡ $n^2$ï¼Œå®ç°æ—¶å¯ç›´æ¥ä½¿ç”¨ python ä¸­çš„ pow å‡½æ•°ã€‚</p>
<p>å°†å·¦å¼æ±‚è§£åï¼ŒåŒ–ä¸ºæ±‚è§£ $\varphi(n)\cdot f\equiv r&rsquo;\ (mod\ n)$ï¼Œå³ $f\equiv \varphi(n)^{-1}\cdot r&rsquo;\ (mod\ n)$</p>
<h3 id="ä»£ç ">ä»£ç </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> AITMCLab.libnum <span style="color:#f92672">import</span> s2n, invmod, n2s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">131344898203946132222826076816862720814198751469464018831726821670</span> <span style="color:#ae81ff">117591133883733491804579798978481132759822192648790811898868530627</span> <span style="color:#ae81ff">177645803646988883380321414340538322474760104004492720100824604377</span> <span style="color:#ae81ff">471904687667402745879993363591712830981372613960131531302654404256</span> <span style="color:#ae81ff">76242061845667887640808895666325466803989428</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">104879397075344024438671231239628115011303349344697797964879592144</span> <span style="color:#ae81ff">922079000957</span> 
</span></span><span style="display:flex;"><span>q <span style="color:#f92672">=</span> <span style="color:#ae81ff">104879397075344024438671231239628115011303349344697797964879592144</span> <span style="color:#ae81ff">922079001013</span>
</span></span><span style="display:flex;"><span>phi_n <span style="color:#f92672">=</span> (p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (q <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> p <span style="color:#f92672">*</span> q
</span></span><span style="display:flex;"><span>r <span style="color:#f92672">=</span> (pow(c, phi_n, n <span style="color:#f92672">*</span> n) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> n
</span></span><span style="display:flex;"><span>print n2s(r <span style="color:#f92672">*</span> invmod(phi_n, n) <span style="color:#f92672">%</span> n)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># flag{can_you_find_me??}</span>
</span></span></code></pre></div><h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>çº¯æ•°å­¦é¢˜</p>
<p>å­¦é•¿å¸¦ç€æ¨äº†ä¸€éã€‚ã€‚ã€‚è¿™ä¹Ÿå¤ªéš¾äº†ã€‚ã€‚ã€‚</p>
<p>å¬è¯´æ˜¯ paillier åŠ å¯†ï¼Œæœç„¶æ˜¯ not RSA</p>
<h2 id="n1ctf2019babyrsa">[N1CTF2019]BabyRSA</h2>
<h3 id="é¢˜ç›®-1">é¢˜ç›®</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util <span style="color:#f92672">import</span> number
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> secret <span style="color:#f92672">import</span> flag
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">23981306327188221819291352455300124608114670714977979223022816906368788909398653961976023086718129607035805397846230124785550919468973090809881210560931396002918119995710297723411794214888622784232065592366390586879306041418300835178522354945438521139847806375923379136235993890801176301812907708937658277646761892297209069757559519399120988948212988924583632878840216559421398253025960456164998680766732013248599742397199862820924441357624187811402515396393385081892966284318521068948266144251848088067639941653475035145362236917008153460707675427945577597137822575880268720238301307972813226576071488632898694390629</span>
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x10001</span>
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> number<span style="color:#f92672">.</span>bytes_to_long(flag)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;flag.enc&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> m:
</span></span><span style="display:flex;"><span>        padding <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">1000</span>) <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        message <span style="color:#f92672">=</span> padding <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> m <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        cipher <span style="color:#f92672">=</span> pow(message, e, N)
</span></span><span style="display:flex;"><span>        f<span style="color:#f92672">.</span>write(hex(cipher)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;n&#39;</span>)
</span></span><span style="display:flex;"><span>        m <span style="color:#f92672">/=</span> <span style="color:#ae81ff">2</span>
</span></span></code></pre></div><h3 id="æ€è·¯-2">æ€è·¯</h3>
<p>é¦–å…ˆé˜…è¯»ä»£ç ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">while</span> m:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># several operations</span>
</span></span><span style="display:flex;"><span>    m <span style="color:#f92672">/=</span> <span style="color:#ae81ff">2</span>
</span></span></code></pre></div><p>ç”±ä¸Šè¿°ä»£ç éƒ¨åˆ†ä»¥åŠè¿‡ç¨‹ä¸­å‡ºç°äº† <code>m % 2</code> æ“ä½œå¯çŸ¥ï¼Œflag çš„äºŒè¿›åˆ¶æ•°æ®æ¯ä¸€ä½è¢«å­˜è¿›äº† <code>key.enc</code> æ–‡ä»¶çš„æ¯è¡Œæ•°æ®ä¸­ï¼Œå› æ­¤å¯¹ <code>key.enc</code> æ–‡ä»¶çš„æ¯ä¸€è¡Œè¿›è¡Œè¯»å–ï¼Œåªè¦èƒ½å¤Ÿåˆ¤æ–­è¯¥ä½ä¸º0è¿˜æ˜¯1ï¼Œå³å¯å®Œæˆè§£å¯†ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>padding <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">1000</span>) <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>message <span style="color:#f92672">=</span> padding <span style="color:#f92672">&lt;&lt;</span> pow(m, p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>, p) <span style="color:#f92672">+</span> m <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>cipher <span style="color:#f92672">=</span> pow(message, e, N)
</span></span></code></pre></div><p>ç”±ä¸Šè¿°ä»£ç å¯çŸ¥ï¼Œ$c\equiv m^e\ (\mathrm{mod}\ N), m = r^2\cdot 2^{1+flag%2}$ ï¼ˆrä¸ºrandomç»“æœï¼‰ï¼Œå› æ­¤ <code>m % 2 = 1</code> æ—¶ï¼Œæœ‰$c\equiv r^2\cdot 2^2\equiv (2^er^e)^2\ (\mathrm{mod}\ N)$ï¼Œè€Œ <code>m % 2 = 0</code> æ—¶ï¼Œæœ‰$c\equiv 2^e\cdot r^{2^e}$ã€‚</p>
<p>é¦–å…ˆçŒœæµ‹å¯ä»¥é€šè¿‡ç ´è§£RSAå¯†ç ï¼Œå°†åŠ å¯†ä¿¡æ¯è¿˜åŸä¸ºæ˜æ–‡ä¿¡æ¯ï¼Œåˆ¤æ–­è¯¥æ•°æ•´é™¤ 2 çš„å¥‡æ•°æ¬¡æ–¹è¿˜æ˜¯å¶æ•°æ¬¡æ–¹å³å¯å¾—çŸ¥è¯¥ä½çš„äºŒè¿›åˆ¶æ•°ã€‚ä½¿ç”¨ factordb ç½‘ç«™å¤±è´¥åè´¼å¿ƒä¸æ­»ï¼Œåˆå°è¯•äº†ç½‘ä¸Šæ‰¾çš„å¤šç§æ”»å‡»è„šæœ¬ï¼Œå‘ç°å‡æ— æ³•åˆ†è§£ï¼Œäºæ˜¯å¯»æ‰¾å…¶å®ƒæ–¹æ³•ã€‚</p>
<p>è§‚å¯Ÿ<del>README.md</del>å‘ç°ï¼Œæœ¬é¢˜å¯ä»¥å°è¯•ç”¨äºŒæ¬¡å‰©ä½™æ±‚è§£ã€‚<code>m % 2 = 1</code> æ—¶ï¼Œæœ‰ $c\equiv (2^er^e)^2\ (\mathrm{mod}\ N)$ï¼Œ<code>m%  2 = 0</code> æ—¶ï¼Œæœ‰ $c\equiv (2\cdot r^2)^e\ (\mathrm{mod}\ N)$ï¼Œå› æ­¤ï¼Œå½“ c ä¸º N çš„äºŒæ¬¡å‰©ä½™æ—¶ï¼Œå¯¹åº”<code>m % 2 = 1</code>ï¼Œc ä¸º N çš„äºŒæ¬¡éå‰©ä½™æ—¶ï¼Œå¯¹åº” <code>m % 2 = 0</code>ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ Jacobi åˆ¤æ–­æ˜¯å¦ä¸ºäºŒæ¬¡å‰©ä½™ã€‚åªéœ€æ»¡è¶³ $\left(\dfrac{2^e\cdot r^{2^e}}{N}\right)=-1$ å³å¯æ±‚è§£ã€‚ç”±äº $\left(\dfrac{2^e\cdot r^{2^e}}{N}\right)=\left(\dfrac{2}{p}\right)\left(\dfrac{2}{q}\right)$ï¼Œæ‰€ä»¥å½“ <code>m % 2 = 0</code> æ—¶ï¼ŒJacobi è®¡ç®—ç»“æœä»…å–å†³äº p å’Œ qï¼Œä¸”åœ¨å®é™…è®¡ç®—ä¸­å‘ç°å­˜åœ¨ Jacobi è®¡ç®—ç»“æœä¸º -1 çš„æƒ…å†µï¼Œåˆå› ä¸º <code>m % 2 = 1</code> æ—¶ Jacobi è®¡ç®—ç»“æœå¿…ç„¶ä¸º 1ï¼Œè¯´æ˜æœ¬é¢˜ä¸­ 2 åˆ†åˆ«æ˜¯ p å’Œ q çš„äºŒæ¬¡å‰©ä½™å’ŒäºŒæ¬¡éå‰©ä½™ï¼Œå¯å¾—</p>
<p>å½“ $m\equiv 0\pmod 2$ï¼Œ$\left(\dfrac{c}{N}\right)= \left(\dfrac{2}{p}\right)\left(\dfrac{2}{q}\right)=-1$</p>
<p>å½“ $m\equiv 1\pmod 2$ï¼Œ$\left(\dfrac{c}{N}\right)= 1$</p>
<p>å› æ­¤å¯ä»¥ç”¨ Jacobi æ¥è®¡ç®— flag çš„äºŒè¿›åˆ¶ç»“æœã€‚</p>
<h3 id="exp-1">exp</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> AITMCLab.Crypto.Util.number <span style="color:#f92672">import</span> long_to_bytes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">jacobi</span>(a, b):
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> a <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">**</span> ((b <span style="color:#f92672">*</span> b <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">8</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> a <span style="color:#f92672">==</span> b <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">**</span> ((b <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> a <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> a <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">*=</span> jacobi(<span style="color:#ae81ff">2</span>, b)
</span></span><span style="display:flex;"><span>        a <span style="color:#f92672">/=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">*=</span> (<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">**</span>((a <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (b <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">4</span>) <span style="color:#f92672">*</span> jacobi(b <span style="color:#f92672">%</span> a, a)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">23981306327188221819291352455300124608114670714977979223022816906368788909398653961976023086718129607035805397846230124785550919468973090809881210560931396002918119995710297723411794214888622784232065592366390586879306041418300835178522354945438521139847806375923379136235993890801176301812907708937658277646761892297209069757559519399120988948212988924583632878840216559421398253025960456164998680766732013248599742397199862820924441357624187811402515396393385081892966284318521068948266144251848088067639941653475035145362236917008153460707675427945577597137822575880268720238301307972813226576071488632898694390629</span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;key.enc&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> f:
</span></span><span style="display:flex;"><span>        line <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>strip(<span style="color:#e6db74">&#34;L</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)    <span style="color:#75715e"># Filter out &#34;L\n&#34; at the end of line</span>
</span></span><span style="display:flex;"><span>        cur <span style="color:#f92672">=</span> int(line, <span style="color:#ae81ff">16</span>)         <span style="color:#75715e"># Convert hax string to number</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (jacobi(cur, n) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>            flag <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> i
</span></span><span style="display:flex;"><span>        i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        print flag
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print flag
</span></span><span style="display:flex;"><span>print long_to_bytes(flag)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># N1CTF{You_can_leak_the_jacobi_symbol_from_RSA}</span>
</span></span></code></pre></div><p>é¦–å…ˆä»<code>key.enc</code>ä¸­é€è¡Œè¯»å–ï¼Œå¹¶å¯¹æ¯ä¸€è¡Œç»“å°¾çš„&rsquo;L\n&rsquo;è¿›è¡Œè¿‡æ»¤ï¼Œå°†å…¶è½¬æ¢ä¸ºæ•´æ•°curåï¼Œè®¡ç®—Jacobiç¬¦å·$J\left( cur, N\right)$ã€‚è®¡ç®—Jacobiç¬¦å·æ—¶ä¸»è¦ä½¿ç”¨äºŒæ¬¡äº’åå¾‹è¿›è¡Œè®¡ç®—ï¼ˆå¯ä»¥å†ä½¿ç”¨å…¶å®ƒå®šå¾‹è¿›è¡ŒåŠ é€Ÿï¼Œä½†æ²¡å¿…è¦ï¼‰ã€‚</p>
<p>ç”±äºç¬¬ä¸€è¡Œå‚¨å­˜çš„ä¸ºflagçš„æœ€åä¸€ä½ï¼ˆå³ä»åå¾€å‰å‚¨å­˜ï¼‰ï¼Œå› æ­¤è¿›è¡Œ<code>flag += 1 &lt;&lt; i</code>å³å¯å°†ç›¸åº”ä½ç½®çš„äºŒè¿›åˆ¶ç»“æœè¿˜åŸã€‚</p>
<h3 id="æ€»ç»“-1">æ€»ç»“</h3>
<p>è¿™é“é¢˜åœ¨ä»£ç é˜…è¯»ä¸Šéš¾åº¦è¾ƒä½ï¼Œå”¯ä¸€éœ€è¦ç•™æ„çš„åœ°æ–¹å°±æ˜¯<code>padding &lt;&lt; pow(m, p - 1, p) + m % 2</code>è¿™ä¸ªè¿ç®—çš„ä¼˜å…ˆçº§é—®é¢˜ï¼ˆæ„Ÿè°¢bgçš„æ³¨é‡Šæç¤ºï¼‰ã€‚æŠŠä»£ç è½¬æ¢æˆæ•°å­¦å…¬å¼åï¼ŒäºŒæ¬¡å‰©ä½™çš„æ–¹æ³•å°±æ¯”è¾ƒæ˜æ˜¾äº†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯<code>Jacobi</code>ç¬¦å·æ— æ³•å‡†ç¡®åˆ¤æ–­äºŒæ¬¡å‰©ä½™ä¸äºŒæ¬¡éå‰©ä½™ï¼ˆæ„Ÿè°¢bgæŒ‡å‡ºäº†è¿™ä¸ªé—®é¢˜ï¼‰ï¼Œç®€å•æ¨å¯¼åå‘ç°è¿™ä¸ªæ–¹æ³•æœ‰ä¸€å®šçš„ä½¿ç”¨æ¡ä»¶ï¼Œå¦‚æœé¢˜ç›®ä¸­çš„på’Œqä¸æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ— æ³•æ­£ç¡®åŒºåˆ†0å’Œ1ã€‚</p>
<blockquote>
<p>åç» ssgss å¸ˆå‚…æé†’å‘ç°è¿™é“é¢˜ç”¨çš„æ˜¯ Goldwasser-Micali å¯†ç ï¼ˆä¸Šè¯¾èµ°ç¥å®é”¤äº†ï¼‰ã€‚ç®€å•å¯¹æ¯”å‘ç°ï¼Œå½“GMå¯†ç é€‰å–çš„xæ»¡è¶³ <code>J(x, p) = 1</code> ä¸” <code>J(x, q) = -1</code> æ—¶ï¼Œå¯èƒ½èƒ½å¤Ÿåˆ©ç”¨æœ¬é¢˜çš„æ–¹æ³•è¿›è¡Œç ´è§£ã€‚å› æ­¤é€‰å–çš„ x ä¸èƒ½ä»…æ»¡è¶³æ˜¯ n çš„äºŒæ¬¡éå‰©ä½™ï¼Œéœ€è¦åŒæ—¶æ˜¯ p å’Œ q çš„äºŒæ¬¡éå‰©ä½™ã€‚</p>
</blockquote>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/crypto/">Crypto</a>
        
            <a href="/tags/labs/">Labs</a>
        
    </section>


    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css"integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8"crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"integrity="sha384-vZTG03m&#43;2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"crossorigin="anonymous"
                defer="true"
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    <aside class="related-contents--wrapper">
    
    
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy;
        
        2023 s0uthwood&#39;s Blog
    
        
            <br />
            å·²è¿è¡Œ <i class="fas fa-bell"></i> <a id="days">0</a> å¤©
        
    
        
            &nbsp;&nbsp;
            
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
            
            âŒ¨&nbsp;
            104.58k&nbsp;
            å­—
            &nbsp;&nbsp;
            ğŸ§ &nbsp;
            42&nbsp;
            ç¯‡æ–‡ç« 
        
    </section>

    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.5.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>

    
        <script>
            var s1 = "2020-11-15";
            s1 = new Date(s1.replace(/-/g, "/"));
            s2 = new Date();
            var days = s2.getTime() - s1.getTime();
            var number_of_days = parseInt(days / (1000 * 60 * 60 * 24));
            document.getElementById('days').innerHTML = number_of_days;
        </script>
    
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">Table of contents</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#quiz-from-bzb">Quiz from bzb</a>
      <ul>
        <li><a href="#å‰è¨€é¢˜ç›®">å‰è¨€&amp;é¢˜ç›®</a></li>
        <li><a href="#æ€è·¯">æ€è·¯</a></li>
        <li><a href="#exp">exp</a></li>
      </ul>
    </li>
    <li><a href="#das2020-aprilnot-rsa">[DAS2020 April]not RSA</a>
      <ul>
        <li><a href="#é¢˜ç›®">é¢˜ç›®</a></li>
        <li><a href="#æ€è·¯-1">æ€è·¯</a></li>
        <li><a href="#ä»£ç ">ä»£ç </a></li>
        <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
      </ul>
    </li>
    <li><a href="#n1ctf2019babyrsa">[N1CTF2019]BabyRSA</a>
      <ul>
        <li><a href="#é¢˜ç›®-1">é¢˜ç›®</a></li>
        <li><a href="#æ€è·¯-2">æ€è·¯</a></li>
        <li><a href="#exp-1">exp</a></li>
        <li><a href="#æ€»ç»“-1">æ€»ç»“</a></li>
      </ul>
    </li>
  </ul>
</nav>
                </div>
            </section>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
